import{l as C}from"./lodash-Dj6doGg4.js";import{E as q,b as T,M as te,w as I,N as Xe,h as R,A as ke,_ as J,H as Ut,L as zt,Q as et,c as be,d as qt,e as Kt,F as ye,G as Yt,D as tt,k as He,g as Gt,m as Wt,i as Jt,f as Ue,u as pe,l as Qt,j as ze,R as qe,n as Zt,V as Ke,I as Ye,Y as Ge,o as Xt,q as ea,J as ta}from"./okiss-utils-BRUUlOco.js";import{D as aa,F as la,G as z,H as Y,I as at,J as lt,K as G,L as oa,M as ot,N as se,O as st,P as nt,Q as Ve,R as sa,S as Q,T as ne,U as Ce,V as Se,W as _e,X as na,Y as ia,Z as ra,_ as it,$ as ua,a0 as da,a1 as pa,a2 as $e,a3 as ca,a4 as ha,a5 as xe,a6 as rt,a7 as ma,a8 as fa,a9 as ba,aa as ya,ab as ut,ac as dt,ad as pt,ae as ga,af as Oe,ag as va,ah as wa,ai as ka,aj as Va}from"./element-plus-Zm8lZR6G.js";import"./vue-D1V_xUgO.js";import{Q as ct,l as Ca,o as Sa,B as Ae,A as ht,R as _a,_ as mt,k as $a}from"./element-plus-icons-vue-DO5OFFCq.js";import{J as xa}from"./inputmask-DJ22HsU8.js";import{Q as Oa}from"./vuedraggable-DyZAIVuD.js";import{g as Aa}from"./dayjs-DZPVkzsk.js";import{F as Ba}from"./file-saver-DoQsME2d.js";import{u as ve,w as Da,S as ja}from"./xlsx-BzlZxw4L.js";import{S as Ea}from"./sortablejs-DDctPen1.js";import{h as B,o as Be,c as U,j as u,n as c,q as p,k as y,I as N,x,F as E,y as b,v as V,f as he,m as M,L as D,d as Ta,l as _,g as ie,P as ft,s as W,e as Ia,z as bt,U as X,J as me,a as De,t as K,r as Z,N as yt,R as je,S as Ee}from"./vue-runtime-core-PAxl9zI8.js";import{r as $,u as F,i as re,b as Pa,m as We,e as Fa,s as La}from"./vue-reactivity-D0wsZnqi.js";import{t as A,j as ce,f as Te,n as H}from"./vue-shared-vVMwlSE8.js";import{e as Je,v as gt,b as Ma}from"./vue-runtime-dom-B3ryxYgL.js";var Na=Object.defineProperty,Ra=(e,t,a)=>t in e?Na(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,Qe=(e,t,a)=>Ra(e,typeof t!="symbol"?t+"":t,a);const Ha=B({name:"VSelect",inject:["formData","rootData"],props:{options:{type:[Array,Function,Object],default:()=>[]},modelValue:{type:[Array,String,Number],default:void 0},disabled:{type:Boolean,default:!1},placeholder:{type:String,default:"请选择"},selectApi:{type:[String,Function],default:""},multiple:{type:Boolean,default:!1},multipleLimit:{type:Number,default:0},allowCreate:{type:Boolean,default:!1},filterable:{type:Boolean,default:!1},valueKey:{type:String,default:"value"},labelKey:{type:String,default:"label"},tpl:{type:String,default:""},fullWidth:{type:Boolean,default:!1},effectData:{type:[Object,String],default:()=>{}},immediate:{type:Boolean,default:!1},watch:{type:String,default:""}},emits:["update:modelValue"],data(){return this.$props.watch&&this.$watch(`formData.${this.$props.watch}`,this.onWatch,{deep:!0,immediate:!0}),{loading:!1,localValue:this.$props.modelValue,localOptions:[]}},computed:{filteredOptions(){var e;return(e=this.localOptions)==null?void 0:e.filter(t=>t.when===void 0?!0:te(this.formData,t.when))},remote(){return!!this.$props.selectApi},localFilterable(){return this.$props.selectApi?!0:this.$props.filterable},getEffectData(){if(Object.keys(this.effectData||{}).length===0)return{};const e=C.find(this.localOptions,a=>a[this.valueKey]===this.localValue);if(!e)return{};if(this.effectData==="*")return e;const t={};return Object.keys(this.effectData).forEach(a=>{e[a]!==void 0&&(t[a]=e[a])}),t}},beforeMount(){if(this.$props.modelValue&&this.$props.selectApi&&this.search(this.$props.modelValue),this.$props.immediate&&this.$props.selectApi&&this.search(this.$props.modelValue),T(this.$props.options))this.localOptions=this.$props.options;else if(R(this.$props.options)){const e=this.$props.options,t=e();t.then!==void 0?t.then(a=>{this.localOptions=a}):this.localOptions=t}else this.$props.options.then!==void 0&&this.$props.options.then(e=>{this.localOptions=e})},methods:{onWatch(){this.$props.immediate&&this.$props.selectApi&&this.search(this.$props.modelValue)},onchange(){this.$emit("update:modelValue",this.localValue,this.getEffectData)},search(e){const t=R(this.$props.selectApi)?this.$props.selectApi(e,this.formData):this.$props.selectApi,a=I(t,{...this.formData,$:this.rootData()});this.loading=!0,T(e)&&(e=e.join(",")),C.debounce(()=>{this.$http.request({method:"GET",url:a,params:{kw:e}}).then(({data:l})=>{if(!l)return;this.loading=!1;const o=l.list||l;T(o)&&(this.localOptions=o,l.length>2e3&&this.$message.warning("搜索结果的条目过多, 可能会造成页面卡顿, 请优化"))})},200)()},getLabel(e){return this.tpl===""?e[this.labelKey]:I(this.tpl,e)},viewLabel(e){var t;let a=e;return(t=this.localOptions)==null||t.forEach(l=>{l[this.valueKey]===e&&(a=this.getLabel(l))}),a},isArray(e){return T(e)}}}),j=(e,t)=>{const a=e.__vccOpts||e;for(const[l,o]of t)a[l]=o;return a},Ua={key:0},za={style:{display:"inline-block",width:"100%"}},qa={key:1};function Ka(e,t,a,l,o,s){const n=Ve,r=ne,i=Ce,d=Se;return e.disabled?(u(),y("span",Ua,[e.isArray(e.localValue)?(u(!0),y(E,{key:0},N(e.localValue,(f,h)=>(u(),c(n,{key:h,class:"select-view"},{default:p(()=>[x(A(e.viewLabel(f)),1)]),_:2},1024))),128)):(u(),c(n,{key:1,class:"select-view"},{default:p(()=>[x(A(e.viewLabel(e.localValue)),1)]),_:1}))])):(u(),c(d,{key:1,ref:"select",modelValue:e.localValue,"onUpdate:modelValue":t[0]||(t[0]=f=>e.localValue=f),placeholder:e.placeholder,loading:e.loading,multiple:e.multiple,filterable:e.localFilterable,"multiple-limit":e.multipleLimit,"allow-create":e.allowCreate,remote:e.remote,"remote-method":f=>f&&e.search(f),style:Te(e.fullWidth?"width:100%":""),onChange:e.onchange},{default:p(()=>[(u(!0),y(E,null,N(e.filteredOptions,f=>(u(),c(i,{key:f[e.valueKey],label:e.getLabel(f),value:f[e.valueKey]},{default:p(()=>[f.previewHtml?(u(),c(r,{key:0,"raw-content":"",effect:"light",content:f.previewHtml,placement:"right"},{default:p(()=>[_("span",za,A(e.getLabel(f)),1)]),_:2},1032,["content"])):(u(),y("span",qa,A(e.getLabel(f)),1))]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","loading","multiple","filterable","multiple-limit","allow-create","remote","remote-method","style","onChange"]))}const vt=j(Ha,[["render",Ka]]),Ya=B({__name:"VRadio",props:{modelValue:{type:[Number,String,Boolean],required:!0,default:0},options:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,l=t,o=$(a.modelValue),s=()=>{l("update:modelValue",o.value)};return(n,r)=>{const i=aa,d=la;return u(),c(d,{modelValue:F(o),"onUpdate:modelValue":r[0]||(r[0]=f=>re(o)?o.value=f:null),disabled:e.disabled,onChange:s},{default:p(()=>[(u(!0),y(E,null,N(e.options,(f,h)=>(u(),c(i,{key:h+"-radio",label:f.value,disabled:!!f.disabled},{default:p(()=>[x(A(f.label),1)]),_:2},1032,["label","disabled"]))),128))]),_:1},8,["modelValue","disabled"])}}});function Ie(){return ie().appContext.config.globalProperties}const Ga=B({__name:"VChecbox",props:{options:{type:Array,default:()=>[]},modelValue:{type:[Array,void 0],default:()=>[]},disabled:{type:Boolean,default:!1},min:{type:Number,default:void 0},max:{type:Number,default:void 0},optionsApi:{type:String,default:""},valueKey:{type:String,default:"value"},labelKey:{type:String,default:"label"},ctrl:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,l=$(a.modelValue??[]),o=$(a.options??[]),s=t,n=()=>{s("update:modelValue",l.value)},r=Ie().$http;a.optionsApi!==""&&(r==null||r.get(a.optionsApi).then(({data:h})=>{o.value=h||[]}));const i=()=>{const h=[];o.value.forEach(v=>{h.push(v[a.valueKey])}),l.value=h,n()},d=()=>{l.value=[],n()},f=()=>{const h=[];o.value.forEach(v=>{h.push(v[a.valueKey])}),l.value=h.filter(v=>!new Set(l.value).has(v)),n()};return(h,v)=>{const g=z,m=Y,w=at,k=lt,S=G;return u(),c(S,null,{default:p(()=>[e.ctrl?(u(),c(m,{key:0},{default:p(()=>[b(g,{text:"",type:"primary",onClick:i},{default:p(()=>[x("全选")]),_:1}),b(g,{text:"",type:"primary",onClick:d},{default:p(()=>[x("全不选")]),_:1}),b(g,{text:"",type:"primary",onClick:f},{default:p(()=>[x("反选")]),_:1})]),_:1})):V("",!0),b(m,null,{default:p(()=>[b(k,{modelValue:F(l),"onUpdate:modelValue":v[0]||(v[0]=O=>re(l)?l.value=O:null),max:e.max,min:e.min,disabled:e.disabled,onChange:n},{default:p(()=>[(u(!0),y(E,null,N(F(o),(O,P)=>(u(),c(w,{key:P+"-checkbox",label:O[a.valueKey]},{default:p(()=>[x(A(O[a.labelKey]),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue","max","min","disabled"])]),_:1})]),_:1})}}}),Wa={name:"VRangeNumber",props:{modelValue:{type:[Array,String],default:","},disabled:{type:Boolean,default:!1},unit:{type:String,default:""},width:{type:String,default:"350px"}},emits:["update:modelValue"],data(){let e,t;return T(this.$props.modelValue)?[e,t]=this.$props.modelValue.map(a=>Number(a)):[e,t]=this.$props.modelValue.split(","),{localValue:this.arrToNum([e,t]),isFocus:!1}},methods:{active(e){this.isFocus=!!e},varToNum(e){return(e+"").replace(/[^\d.]/g,"").replace(/\.+/,".")},arrToNum(e){return e.map(t=>{if(t==="")return;const a=this.varToNum(t);return Number(a)})},onchange(){this.localValue=this.arrToNum(this.localValue),this.$emit("update:modelValue",this.localValue)}}},Ja=e=>(je("data-v-da091ba3"),e=e(),Ee(),e),Qa=["disabled"],Za=Ja(()=>_("span",{class:"el-range-separator"},"~",-1)),Xa=["disabled"],el={key:0,class:"el-range-separator"};function tl(e,t,a,l,o,s){const n=ft("out-click");return W((u(),y("div",{class:H("el-date-editor el-date-editor--datetimerange el-input__wrapper el-range-editor "+(o.isFocus?" is-active":"")),style:Te({width:a.width})},[W(_("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>o.localValue[0]=r),autocomplete:"off",class:"el-range-input",disabled:a.disabled,onChange:t[1]||(t[1]=(...r)=>s.onchange&&s.onchange(...r)),onFocus:t[2]||(t[2]=r=>s.active(!0))},null,40,Qa),[[Je,o.localValue[0],void 0,{number:!0}]]),x(),Za,x(),W(_("input",{"onUpdate:modelValue":t[3]||(t[3]=r=>o.localValue[1]=r),autocomplete:"off",class:"el-range-input",disabled:a.disabled,onChange:t[4]||(t[4]=(...r)=>s.onchange&&s.onchange(...r)),onFocus:t[5]||(t[5]=r=>s.active(!0))},null,40,Xa),[[Je,o.localValue[1],void 0,{number:!0}]]),x(),a.unit?(u(),y("span",el,A(a.unit),1)):V("",!0)],6)),[[n,()=>s.active(!1)]])}const al=j(Wa,[["render",tl],["__scopeId","data-v-da091ba3"]]),ll={__name:"MonacoEditor",props:{mod:{type:String,default:"html"},modelValue:{type:String,default:""},options:{type:Object,default:()=>({})},clearable:{type:Boolean,default:!1},vsPath:{type:String,default:"https://cdn.jsdelivr.net/npm/monaco-editor@0.30.1/min/vs"}},emits:["update:modelValue","blur"],setup(e,{expose:t,emit:a}){const l=Ia("vsPath",""),o=m=>{if(document.getElementById(m))return;const w=document.createElement("script");w.type="text/javascript",w.src=m,w.id=m,document.body.append(w)},s=()=>{if(window.monaco)return new Promise(w=>w(window.monaco));const m=l||n.vsPath;return o(m+"/loader.js"),new Promise((w,k)=>{const S=setInterval(()=>{window.require&&(require.config({paths:{vs:m}}),require(["vs/editor/editor.main"],()=>{w(window.monaco),clearInterval(S)},()=>{k("error")}))},50)})},n=e,r=a,i=$();let d,f,h=null;Be(async()=>{f=await s();const{editor:m}=f;h=m.createModel(n.modelValue,n.mod),i.value&&(f.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0,allowComments:!0,schemaValidation:"error"}),d=m.create(i.value,C.merge({model:h,tabSize:4,automaticLayout:!0,foldingStrategy:"indentation",scrollBeyondLastLine:!1,glyphMargin:!1,folding:!0,scrollbar:{alwaysConsumeMouseWheel:!1},minimap:{enabled:!1}},n.options)),d.onDidChangeModelContent(()=>{const w=d.getValue();r("update:modelValue",w)}),d.onDidContentSizeChange(()=>{const w=Math.min(1500,d.getContentHeight());i.value.style.height=`${w}px`,d.layout()}),d.onDidBlurEditorWidget(()=>{g(),r("blur",{editor:d,markers:f.editor.getModelMarkers({})})}))});let v=[];const g=()=>{const m=f.editor.getModelMarkers({});return m.length>0?(d.revealLineInCenter(m[0].endLineNumber),v=d.deltaDecorations(v,[{range:new f.Range(m[0].endLineNumber,1,m[0].endLineNumber,1),options:{isWholeLine:!0,className:"myContentClass",glyphMarginClassName:"myGlyphMarginClass"}}]),ke("myGlyphMarginClass"),!1):(d.deltaDecorations(v,[]),!0)};return t({validate:g}),bt(()=>{d&&d.dispose()}),(m,w)=>(u(),y("div",{ref_key:"dom",ref:i,class:"editor"},null,512))}},Pe=j(ll,[["__scopeId","data-v-a25f8e4f"]]),wt=B({__name:"VJson",props:{modelValue:{type:[String,Object,Array],default:void 0},disabled:{type:Boolean,default:!1},validateEvent:{type:Boolean,default:!0}},emits:["update:modelValue","blur"],setup(e,{expose:t,emit:a}){const l=e,o=a,s=l.modelValue||"",n=q(s),r=$(n?s:JSON.stringify(s,null,2)),i=()=>{o("update:modelValue",n?r.value:JSON.parse(r.value))},d=$();return t({validate:()=>d.value.validate()}),(f,h)=>(u(),c(Pe,{ref_key:"editor",ref:d,modelValue:F(r),"onUpdate:modelValue":[h[0]||(h[0]=v=>re(r)?r.value=v:null),i],mod:"json"},null,8,["modelValue"]))}}),ol={name:"VIconSelect",props:{options:{type:Array,default:()=>[]},modelValue:{type:String,default:""},disabled:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1}},emits:["update:modelValue"],data(){return{filter:"",showIcons:!1,localValue:this.$props.modelValue,elIconList:[],key:0}},beforeCreate(){fetch("http://assest.daodao.run/element-plus-icons.json").then(e=>e.json()).then(e=>{this.elIconList=e}).catch(function(){})},methods:{onselected(e){this.localValue=e,this.key++,this.$emit("update:modelValue",this.localValue),this.$refs.popover.hide()},focus(){}}};function sl(e,t,a,l,o,s){const n=D("v-icon"),r=_e,i=Y,d=G,f=na,h=ia;return u(),c(h,{ref:"popover",placement:"bottom-start",trigger:"click",width:650},{reference:p(()=>[b(r,{modelValue:o.localValue,"onUpdate:modelValue":t[0]||(t[0]=v=>o.localValue=v),disabled:a.disabled,style:{width:"60%"},onFocus:s.focus},{prepend:p(()=>[(u(),c(n,{key:o.key,name:o.localValue||""},null,8,["name"]))]),_:1},8,["modelValue","disabled","onFocus"])]),default:p(()=>[b(f,{style:{"max-height":"300px",overflow:"auto"}},{default:p(()=>[b(r,{modelValue:o.filter,"onUpdate:modelValue":t[1]||(t[1]=v=>o.filter=v),placeholder:"搜索...",onFocus:s.focus},null,8,["modelValue","onFocus"]),b(d,{class:"icon-list"},{default:p(()=>[(u(!0),y(E,null,N(o.elIconList.filter(v=>v.indexOf(o.filter)!==-1),(v,g)=>(u(),c(i,{key:g,span:2,onClick:m=>s.onselected(v)},{default:p(()=>[b(n,{class:H({"icon-cell":!0,active:v===o.localValue}),name:v},null,8,["class","name"])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1},512)}const nl=j(ol,[["render",sl],["__scopeId","data-v-ffed56d6"]]),il=B({name:"VSubForm",components:{Plus:Ae,Minus:ht,VForm:X(()=>Promise.resolve().then(()=>jt))},inject:["formData","dev","mod"],props:{repeat:{type:Boolean,default:!1},max:{type:Number,default:100},formItems:{type:Array,default:()=>[]},modelValue:{type:[Object,Array],default:()=>({})},disabled:{type:Boolean,default:!1},options:{type:Object,default:()=>({})}},emits:["update:modelValue"],data(){let e=[];const t=C.cloneDeep(this.$props.modelValue);return this.$props.repeat===!0&&T(this.$props.modelValue)?e=t:this.$props.repeat===!1&&J(this.$props.modelValue)?e.push(t):e.push({}),e.length===0&&e.push({}),{key:1,fApis:[],sub:e,formOptions:C.merge(this.$props.options,{submitButton:!1,cancelButton:!1,disabled:this.disabled})}},watch:{$props:{immediate:!0,handler(e){e.repeat===!0&&!T(e.modelValue)&&console.error("sub-form type is repeat: modelValue must is array"),e.repeat===!1&&!J(e.modelValue)&&console.error("sub-form type is single: modelValue must is Object")}}},methods:{push(){this.sub.push({})},remove(e){this.sub=C.remove(this.sub,(t,a)=>a!==e),this.key++,this.$emit("update:modelValue",this.repeat?this.sub:this.sub[0])},onchange(){this.$emit("update:modelValue",this.repeat?this.sub:this.sub[0])},subMounted(e,t){this.fApis[t]=e},validate:async function(){let e=!0;for(let t=0;t<this.fApis.length;t++){const a=this.fApis[t];if(!e)return!1;await a.validate()||(e=!1)}return e},getRootData(){return this.formData}}}),rl={class:"sub-form"},ul={class:"box"},dl={class:"box"};function pl(e,t,a,l,o,s){const n=D("v-form"),r=Y,i=D("Minus"),d=Q,f=z,h=D("Plus"),v=G;return u(),y("div",rl,[(u(!0),y(E,null,N(e.sub,(g,m)=>(u(),c(v,{key:m+"-"+e.key},{default:p(()=>[b(r,{class:"sub-form-item",span:e.repeat?22:24},{default:p(()=>[b(n,{ref_for:!0,ref:"subForm"+m,modelValue:e.sub[m],"onUpdate:modelValue":[w=>e.sub[m]=w,e.onchange],"is-sub":!0,options:e.formOptions,"form-items":e.$props.formItems,"root-data":e.getRootData,disable:e.disabled,mod:e.mod,onMounted:w=>e.subMounted(w,m)},null,8,["modelValue","onUpdate:modelValue","options","form-items","root-data","disable","mod","onMounted"])]),_:2},1032,["span"]),e.repeat&&!e.disabled?(u(),c(r,{key:0,span:2},{default:p(()=>[_("div",ul,[e.sub.length>1?(u(),c(f,{key:0,type:"danger",circle:"",size:"small",onClick:w=>e.remove(m)},{icon:p(()=>[b(d,null,{default:p(()=>[b(i)]),_:1})]),_:2},1032,["onClick"])):V("",!0)]),_("div",dl,[m===e.sub.length-1&&e.sub.length<e.max?(u(),c(f,{key:0,type:"primary",size:"small",circle:"",onClick:e.push},{icon:p(()=>[b(d,null,{default:p(()=>[b(h)]),_:1})]),_:1},8,["onClick"])):V("",!0)])]),_:2},1024)):V("",!0)]),_:2},1024))),128))])}const cl=j(il,[["render",pl],["__scopeId","data-v-0f559968"]]),hl={components:{Plus:Ae},inject:["formData"],props:{modelValue:{type:[Array,String],default:()=>[]},disabled:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},action:{type:String,default:"#"},headers:{type:Object,default:()=>{}},limit:{type:Number,default:1},accept:{type:String,default:""},format:{type:Array,default:e=>[]},maxSize:{type:Number,default:0},type:{type:String,default:"image"}},emits:["update:modelValue"],data(){return{delIcon:!1,dialogImageUrl:"",dialogVisible:!1,fileList:Ut(this.$props.modelValue).map(this.parseFile),tip:"",tempIndex:1,reqHeaders:Object.assign(At(),this.$props.headers)}},mounted(){setTimeout(()=>{this.uploadAction()},20),this.addDownloadIcon()},methods:{addDownloadIcon(){this.$refs.upload.$el.getElementsByClassName("el-upload-list__item-actions").forEach((e,t)=>{if(this.delIcon||e.getElementsByClassName("el-icon-download").length)return;const a=document.createElement("span");a.innerHTML='<span class="el-upload-list__item-delete"><i class="iconfont ra-download"></i></span>',a.onclick=()=>{const l=this.fileList[t];zt(l.url,l.name)},this.delIcon=!0,e.appendChild(a)})},parseFile(e="",t){let a="";return this.fileList&&this.fileList[t]&&this.fileList[t].url===e&&(a=this.fileList[t].uid||Date.now()+this.tempIndex++),{url:e,name:e.split("/").pop(),status:"success",uid:a||Date.now()+this.tempIndex++}},uploadAction(){const e=this.uploadEl();this.fileList&&this.fileList.length>=this.limit?e&&(e.style.display="none"):e&&(e.style.display="inline-block");const t=this.fileList.map(l=>l.url);this.addDownloadIcon();const a=this.limit===1?t[0]??"":t;this.$emit("update:modelValue",a)},handleRemove(e,t){this.fileList=t,this.uploadAction()},preview(e){if(e.status!=="success")return!1;this.dialogImageUrl=e.url,this.dialogVisible=!0},beforeUpload(e){const{format:t,maxSize:a}={format:this.format,maxSize:this.maxSize},{name:l,size:o}=e;return t&&t.length>0&&t.indexOf(l.split(".").reverse()[0])===-1?(this.$message.warning(`格式错误，仅支持后缀名为 ${t.join("、")} 的文件!`),!1):a&&a<o/1024?(this.$message.warning(`文件大小不能超过 ${a}KB !`),!1):!0},onExceed(){this.$message.warning(`最多只能上传${this.limit}个`)},uploadEl(){if(this.$refs.upload)return this.$refs.upload.$el.getElementsByClassName("el-upload")[0]},onError(e,t,a){this.$notify.error({title:"上传失败",message:e})},onSuccess(e,t,a){var l;if(e.code!==0){this.$notify.error({title:e.message||"上传失败.",message:t.name}),this.fileList=C.remove(a,s=>s.response.code===0);return}const o=(l=e.data)==null?void 0:l.url;if(!o){this.$notify.error({message:"上传接口错误"});return}t.url=o,a[0].url=o,this.fileList=a,this.uploadAction()},httpRequest(e){return new Promise((t,a)=>{const l=new FormData;l.append("file",e.file),this.$http.create().request({url:I(e.action,this.formData),method:e.method,data:l,headers:{"Content-Type":"multipart/form-data",...e.headers}}).then(o=>{t(o.data)}).catch(o=>{a(o)})})}}},ml=["innerHTML"];function fl(e,t,a,l,o,s){const n=D("plus"),r=Q,i=z,d=ra,f=it,h=se;return u(),y(E,null,[b(d,{ref:"upload",class:"uploader ok",action:a.action,"list-type":a.type==="image"?"picture-card":"text",limit:a.limit,multiple:a.limit>1,"file-list":o.fileList,disabled:a.disabled,"before-upload":s.beforeUpload,"on-preview":s.preview,"on-remove":s.handleRemove,"on-exceed":s.onExceed,"on-success":s.onSuccess,"on-error":s.onError,headers:o.reqHeaders,"http-request":s.httpRequest},me({tip:p(()=>[_("div",{innerHTML:o.tip},null,8,ml)]),_:2},[o.fileList.length<a.limit?{name:"default",fn:p(()=>[a.type==="image"?(u(),c(r,{key:0,class:"uploader-icon"},{default:p(()=>[b(n)]),_:1})):V("",!0),a.type==="file"?(u(),c(i,{key:1,size:"small",type:"primary"},{default:p(()=>[x("点击上传")]),_:1})):V("",!0)]),key:"0"}:void 0]),1032,["action","list-type","limit","multiple","file-list","disabled","before-upload","on-preview","on-remove","on-exceed","on-success","on-error","headers","http-request"]),b(h,{modelValue:o.dialogVisible,"onUpdate:modelValue":t[0]||(t[0]=v=>o.dialogVisible=v)},{default:p(()=>[b(f,{src:o.dialogImageUrl,lazy:""},null,8,["src"])]),_:1},8,["modelValue"])],64)}const kt=j(hl,[["render",fl]]),bl={mounted(e,t){t.value&&xa(t.value).mask(e.getElementsByTagName("input")[0])}},yl=B({directives:{mask:bl},props:{modelValue:{type:[String,Number,Object,Array],default:""},showWordLimit:{type:Boolean,default:!0},readonly:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},autosize:{type:[Boolean,Object],default:()=>({minRows:2})},rows:{type:Number,default:6},showCopy:{type:Boolean,default:!1},showPassword:{type:Boolean,default:!1},mask:{type:[String,Object],default:""},placeholder:{type:String,default:""},type:{type:String,default:""}},emits:["change","blur","clear","input","inputNative","copy","focus","update:modelValue"],data(){return{inputValue:""}},watch:{modelValue:{handler:function(e){this.inputValue=e||""},immediate:!0}},created(){},methods:{updateModel(e){this.$emit("update:modelValue",e)},change(e){this.$emit("change",e)},blur(e){this.$emit("blur",e)},focus(e){this.$emit("focus",e)},clear(){this.$emit("clear")},input(){this.$emit("input",this.inputValue)},copy(){et(this.inputValue),this.$emit("copy")}}});function gl(e,t,a,l,o,s){const n=z,r=_e,i=ft("mask");return W((u(),c(r,M({modelValue:e.inputValue,"onUpdate:modelValue":t[0]||(t[0]=d=>e.inputValue=d),"show-word-limit":e.showWordLimit,rows:e.rows,clearable:e.clearable,disabled:e.disabled,"show-password":e.showPassword,type:e.type},e.$attrs,{autosize:e.autosize,placeholder:e.placeholder,onChange:e.change,onFocus:e.focus,onClear:e.clear,onBlur:e.blur,onInput:e.input,"onUpdate:modelValue":e.updateModel}),me({_:2},[e.showCopy?{name:"append",fn:p(()=>[e.showCopy?(u(),c(n,{key:0,icon:"el-icon-copy-document",onClick:e.copy},null,8,["onClick"])):V("",!0)]),key:"0"}:void 0]),1040,["modelValue","show-word-limit","rows","clearable","disabled","show-password","type","autosize","placeholder","onChange","onFocus","onClear","onBlur","onInput","onUpdate:modelValue"])),[[i,e.mask]])}const Vt=j(yl,[["render",gl],["__scopeId","data-v-740439c4"]]),vl=B({name:"VCascader",props:{options:{type:Array,default:()=>[]},modelValue:{type:[Array,Number],default:void 0},disabled:{type:Boolean,default:!1},clearable:{type:Boolean,default:!0},showAllLevels:{type:Boolean,default:!0},collapseTags:{type:Boolean,default:!1},filterable:{type:Boolean,default:!0},props:{type:Object,default:e=>{}},size:{type:String,default:""},optionsApi:{type:String,default:""},saveAs:{type:String,default:"array"}},emits:["update:modelValue"],setup(e,{emit:t}){const a=$(C.cloneDeep(be(e.modelValue)?[e.modelValue]:e.modelValue)),l=$(e.options),o=$(0),s=ie(),n=s==null?void 0:s.appContext.config.globalProperties.$http;return he(()=>{e.optionsApi&&n.request({method:"GET",url:e.optionsApi}).then(({data:r})=>{l.value=r||[],be(e.modelValue)&&(a.value=qt(l.value,e.modelValue,e.props.value||"value")),o.value++})}),{localValue:a,optionTree:l,onchange:()=>{let r=a;be(e.modelValue)&&(r=a.value[a.value.length-1]),e.saveAs==="array"?r=a.value:e.saveAs==="number"&&(r=a.value[a.value.length-1]),t("update:modelValue",r)},key:o}}});function wl(e,t,a,l,o,s){const n=ua;return u(),c(n,{key:e.key,modelValue:e.localValue,"onUpdate:modelValue":t[0]||(t[0]=r=>e.localValue=r),options:e.optionTree,disabled:e.disabled,clearable:e.clearable,"show-all-levels":e.showAllLevels,"collapse-tags":e.collapseTags,filterable:e.filterable,props:e.props,size:e.size,onChange:e.onchange},null,8,["modelValue","options","disabled","clearable","show-all-levels","collapse-tags","filterable","props","size","onChange"])}const kl=j(vl,[["render",wl]]),Ct=e=>{let t=[];return e.forEach(a=>{t.push(a.value),a.children!==void 0&&(t=t.concat(Ct(a.children)))}),t},St=(e,t)=>{let a=[];for(let l=0;l<t.length;l++){const o=t[l];if(o.value===e){o.children!==void 0?a=a.concat(Ct(o.children)):a.push(o.value);continue}o.children!==void 0&&(a=a.concat(St(e,o.children)))}return a},Vl=(e,t)=>{let a=[];return e.forEach(l=>{a=a.concat(St(l,t))}),a},Cl=B({props:{modelValue:{type:Array,default:()=>[]},options:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},clearable:{type:Boolean,default:!0},showAllLevels:{type:Boolean,default:!0},collapseTags:{type:Boolean,default:!1},filterable:{type:Boolean,default:!0},props:{type:Object,default:e=>{}},size:{type:String,default:""},optionsApi:{type:String,default:""}},emits:["update:modelValue"],setup(e,t){const{$http:a}=Ie(),l=$([]),o=$([]);he(async()=>{if(e.optionsApi){const{data:r}=await a.get(e.optionsApi);l.value=r||[]}else l.value=e.options;e.props.emitPath?o.value=e.modelValue:o.value=Vl(e.modelValue,l.value)});const s=r=>{if(e.props.emitPath)t.emit("update:modelValue",r);else{const i=[];n.value.getCheckedNodes().forEach(d=>{d.parent&&d.parent.checked||i.push(d.value)}),t.emit("update:modelValue",i)}},n=$(null);return{localVal:o,onchange:s,cas:n,optionsTree:l}}});function Sl(e,t,a,l,o,s){const n=da;return u(),c(n,{ref:"cas",modelValue:e.localVal,"onUpdate:modelValue":t[0]||(t[0]=r=>e.localVal=r),options:e.optionsTree,disabled:e.disabled,clearable:e.clearable,"show-all-levels":e.showAllLevels,"collapse-tags":e.collapseTags,filterable:e.filterable,props:e.props,size:e.size,onChange:e.onchange},null,8,["modelValue","options","disabled","clearable","show-all-levels","collapse-tags","filterable","props","size","onChange"])}const _t=j(Cl,[["render",Sl]]),_l=B({name:"VFilter",components:{FormItem:X(()=>Promise.resolve().then(()=>Dt)),draggable:Oa},inject:["formData","dev"],props:{formItems:{type:Array,default:()=>[]},modelValue:{type:Array||null,default:()=>[]},disabled:{type:Boolean,default:!1},options:{type:Object,default:()=>({})},showLabel:{type:Boolean,default:!0}},emits:["update:modelValue"],data(){const e=this.$props.modelValue?this.$props.modelValue:[];e.length===0&&e.push({field:"",value:void 0});const t=[];return this.$props.formItems.forEach(a=>{t.push({value:a.field,label:a.label})}),{key:1,fApis:[],sub:e,localOptions:t,formOptions:C.merge(this.$props.options,{submitButton:!1,cancelButton:!1}),plus:We(Ae),minus:We(ht)}},computed:{itemKey(){return Object.keys(this.$props.formItems[0]|{})[0]}},methods:{push(){this.sub.push({field:void 0,value:void 0})},remove(e){this.sub=C.remove(this.sub,(t,a)=>a!==e),this.key++,this.$emit("update:modelValue",this.sub)},onchange(){const e=[];this.sub.forEach(t=>{t.value!==void 0&&e.push({field:t.field,value:t.value})}),this.$emit("update:modelValue",e)},subMounted(e,t){this.fApis[t]=e},validate(){let e=!0;return this.fApis.forEach(t=>{if(!e)return!1;t.validate(a=>{a||(e=!1)})}),e},getRootData(){return this.formData},getFormitem(e){const t=this.sub[e].field;let a={};return this.$props.formItems.forEach(l=>{l.field===t&&(a=l)}),a},fieldChange(e){this.sub[e].id===void 0?this.sub[e].id=1:this.sub[e].id+=1},onFiledChange(){},allowOptions(e){const t=[];return this.sub.forEach((a,l)=>{l<e&&t.push(a.field)}),C.filter(this.localOptions,a=>t.indexOf(a.value)<0)}}}),$l={class:"sub-form"},xl={key:0};function Ol(e,t,a,l,o,s){const n=Ce,r=Se,i=Y,d=D("form-item"),f=G,h=z,v=D("draggable");return u(),y("div",$l,[b(v,{modelValue:e.sub,"onUpdate:modelValue":t[0]||(t[0]=g=>e.sub=g),group:"filter","item-key":e.itemKey,disabled:e.disabled,onStart:t[1]||(t[1]=g=>e.drag=!0),onEnd:t[2]||(t[2]=g=>e.drag=!1)},{item:p(({element:g,index:m})=>[b(f,null,{default:p(()=>[b(i,{class:"sub-form-item",span:22},{default:p(()=>[b(f,null,{default:p(()=>[e.showLabel?(u(),c(i,{key:0,span:4},{default:p(()=>[b(r,{modelValue:e.sub[m].field,"onUpdate:modelValue":w=>e.sub[m].field=w,disabled:e.$props.disabled||m<e.sub.length-1,onChange:()=>e.fieldChange(m)},{default:p(()=>[(u(!0),y(E,null,N(e.allowOptions(m),w=>(u(),c(n,{key:w.value,label:w.label,value:w.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"])]),_:2},1024)):V("",!0),b(i,{span:16},{default:p(()=>[e.sub[m].field?(u(),c(d,{key:0,modelValue:e.sub[m].value,"onUpdate:modelValue":[w=>e.sub[m].value=w,e.onchange],item:e.getFormitem(m),"form-options":{disabled:e.$props.disabled}},null,8,["modelValue","onUpdate:modelValue","item","form-options"])):V("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024),e.disabled?V("",!0):(u(),c(i,{key:0,span:2,class:"sub-form-item-action"},{default:p(()=>[_("div",null,[_("div",null,[e.sub.length>1?(u(),c(h,{key:0,class:"action",type:"danger",icon:e.minus,circle:"",onClick:w=>e.remove(m)},null,8,["icon","onClick"])):V("",!0)]),m===e.sub.length-1&&m<e.formItems.length-1?(u(),y("div",xl,[e.allowOptions(m).length>1?(u(),c(h,{key:0,class:"action",type:"primary",icon:e.plus,circle:"",onClick:e.push},null,8,["icon","onClick"])):V("",!0)])):V("",!0)])]),_:2},1024))]),_:2},1024)]),_:1},8,["modelValue","item-key","disabled"])])}const Al=j(_l,[["render",Ol],["__scopeId","data-v-ce9ff07b"]]),Bl=B({name:"VShow",inject:["formData"],props:{tpl:{type:[String,Array,Object],default:""},dataApi:{type:String,default:""},watch:{type:String,default:""},auto:{type:Boolean,default:!0},text:{type:String,default:"查询"},interval:{type:Number,default:0},timeout:{type:Number,default:0}},data(){if(this.auto){const e=C.debounce(t=>{this.request(t)},300);this.$watch(this.$props.watch?`formData.${this.$props.watch}`:"formData",e,{deep:!0,immediate:!0})}return{showTpl:"",key:0,loading:!1,instance:void 0,usTime:0}},beforeUnmount(){this.instance&&clearInterval(this.instance)},methods:{getTpl(e){if(T(this.tpl)){for(let t=0;t<this.tpl.length;t++)if(te(this.formData,this.tpl[t].when))return this.makeTpl(this.tpl[t].tpl,e||this.formData);return""}return this.makeTpl(this.tpl,e||this.formData)},makeTpl(e,t){return(a=>a.indexOf("function(")===0)(e)?new Function("return "+e)()(t||this.formData):e},requestApi(e,t){t&&(this.loading=!0);try{this.$http({method:"GET",url:I(this.$props.dataApi,{...this.formData})}).then(({data:a})=>{const l=Object.assign({},e,a);this.showTpl=I(this.getTpl(l),l),this.$props.interval&&a.state==="done"&&(clearInterval(this.instance),this.instance=void 0,this.usTime=0,this.loading=!1),t&&(this.loading=!1)}).catch(a=>{t&&(this.loading=!1),this.$props.interval&&(clearInterval(this.instance),this.instance=void 0,this.usTime=0,this.loading=!1)})}catch{t&&(this.loading=!1)}},request(e){this.$props.dataApi?this.$props.interval?(this.loading=!0,this.instance=setInterval(async()=>{if(this.$props.timeout>0&&this.usTime>=this.$props.timeout){clearInterval(this.instance),this.instance=void 0,this.$message.error("查询超时, 请重试");return}await this.requestApi(e),this.usTime+=this.$props.interval},this.$props.interval)):this.requestApi(e,!0):this.showTpl=I(this.getTpl(),e),this.key++}}}),Dl=["innerHTML"];function jl(e,t,a,l,o,s){const n=z;return u(),y("div",null,[e.loading?V("",!0):(u(),y("span",{key:e.key,innerHTML:e.showTpl},null,8,Dl)),e.auto?V("",!0):(u(),c(n,{key:1,loading:e.loading,onClick:t[0]||(t[0]=()=>e.request({}))},{default:p(()=>[x(A(e.text),1)]),_:1},8,["loading"]))])}const El=j(Bl,[["render",jl]]),Tl=B({__name:"VDate",props:{disabledDate:{type:[Function,Array],default:()=>e=>!1}},setup(e){const t=e,a=l=>{if(R(t.disabledDate))return t.disabledDate(l);const o=t.disabledDate;if(T(o[0])){for(let s=0;s<o.length;s++)if(Ke(l,Ye(o[s][1]),o[s][0]))return!0}else{const s=o;if(Ke(l,Ye(s[1]),s[0]))return!0}return!1};return(l,o)=>{const s=pa;return u(),c(s,{"disabled-date":a})}}}),Il={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 400 400"},Pl=_("g",{fill:"none","fill-rule":"evenodd"},[_("path",{d:"M0 0h400v400H0z"}),_("path",{fill:"currentColor",d:"M310 132v30h-96v75.5h96.5v30h-107v-.5H184V162H89v-30h221Z"}),_("circle",{cx:"200",cy:"200",r:"199",stroke:"#000","stroke-opacity":".546","stroke-width":"2"})],-1),Fl=[Pl];function Ll(e,t){return u(),y("svg",Il,[...Fl])}const Ml={render:Ll},Nl={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 400 400"},Rl=_("g",{fill:"none","fill-rule":"evenodd"},[_("path",{d:"M0 0h400v400H0z"}),_("circle",{cx:"200",cy:"200",r:"197.5",stroke:"#000","stroke-opacity":".546","stroke-width":"5"}),_("path",{fill:"currentColor",d:"M215 74v105h105v30H215v105h-30l-.001-105H80v-30h105V74h30Z"})],-1),Hl=[Rl];function Ul(e,t){return u(),y("svg",Nl,[...Hl])}const zl={render:Ul},ql={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 400 400"},Kl=_("g",{fill:"none","fill-rule":"evenodd",transform:"rotate(90 200 200)"},[_("path",{d:"M0 0h400v400H0z"}),_("circle",{cx:"200",cy:"200",r:"197.5",stroke:"#000","stroke-opacity":".546","stroke-width":"5"}),_("path",{fill:"currentColor",d:"M185 314V74h30v240z"})],-1),Yl=[Kl];function Gl(e,t){return u(),y("svg",ql,[...Yl])}const Wl={render:Gl},Jl=B({components:{SvgGroup:Ml,SvgAdd:zl,SvgRemove:Wl,FormItem:X(()=>Promise.resolve().then(()=>Dt))},props:{rule:{type:Object,default:e=>{}},formItems:{type:Array,default:e=>[]},factorOptions:{type:Array,default:e=>[]},addChildVisible:{type:Boolean,default:!0},maxDepth:{type:Number,default:3},deep:{type:Number,default:1},disabled:{type:Boolean,default:!1},ctrl:{type:Object,default:()=>{}}},emits:["add","addChild","delete","change"],data(){return{rules:{field:[{required:!0,message:"请选择",trigger:"change"}],operator:[{required:!0,message:"请选择",trigger:"change"}],value:[{required:!0,message:"请输入",trigger:["blur","change"]}]},defaultOperatorOptions:[{value:"=",label:"等于"},{value:">",label:"大于"},{value:"<",label:"小于"},{value:">=",label:"大于等于"},{value:"<=",label:"小于等于"},{value:"!=",label:"不等于"},{value:"in",label:"在其中"},{value:"not in",label:"不在其中"},{value:"has",label:"包含"},{value:"not has",label:"不包含"}],operatorOptions:[],valueKey:0}},watch:{rule:{handler(e){this.operatorOptions=[],this.formItems.forEach(t=>{t.field===e.field&&t.operatorOptions!==void 0&&(this.operatorOptions=t.operatorOptions)}),this.operatorOptions.length===0&&(this.operatorOptions=this.defaultOperatorOptions)},immediate:!0,deep:!0}},methods:{async validate(){return this.$refs._form.validate()},addRow(){this.$emit("add")},addChild(){this.$emit("addChild")},deleteRow(){this.$emit("delete")},change(e){this.$emit("change",e)},getFormItem(){const e=this.rule.field;let t={};return this.$props.formItems.forEach(a=>{a.field===e&&(t={...a})}),t.props=t.props||{},t.props.disabled=this.disabled,t}}}),Ql={class:"ruleFields"};function Zl(e,t,a,l,o,s){const n=Ce,r=Se,i=Oe,d=Y,f=D("FormItem"),h=D("SvgGroup"),v=ne,g=Q,m=D("SvgRemove"),w=D("SvgAdd"),k=G,S=xe;return u(),y("div",Ql,[(u(),c(S,{ref:"_form",key:e.rule.field,model:e.rule,rules:e.rules,inline:"",size:"small"},{default:p(()=>[b(k,null,{default:p(()=>[b(d,{span:6},{default:p(()=>[b(i,{prop:"field"},{default:p(()=>[b(r,{modelValue:e.rule.field,"onUpdate:modelValue":t[0]||(t[0]=O=>e.rule.field=O),placeholder:"请选择",filterable:"",disabled:e.disabled,onChange:t[1]||(t[1]=()=>e.change("field"))},{default:p(()=>[(u(!0),y(E,null,N(e.factorOptions,(O,P)=>(u(),c(n,{key:P,label:O.label,value:O.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),b(d,{span:6},{default:p(()=>[b(i,{prop:"operator"},{default:p(()=>[b(r,{modelValue:e.rule.operator,"onUpdate:modelValue":t[2]||(t[2]=O=>e.rule.operator=O),placeholder:"符号",disabled:e.disabled,onChange:t[3]||(t[3]=()=>e.change("operator"))},{default:p(()=>[(u(!0),y(E,null,N(e.operatorOptions,(O,P)=>(u(),c(n,{key:P,label:O.label,value:O.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),b(d,{span:6},{default:p(()=>[b(i,{prop:"value"},{default:p(()=>[(u(),c(f,{key:e.valueKey,modelValue:e.rule.value,"onUpdate:modelValue":[t[4]||(t[4]=O=>e.rule.value=O),t[5]||(t[5]=()=>e.change("value"))],"show-label":!1,item:e.getFormItem(),disabled:e.disabled},null,8,["modelValue","item","disabled"]))]),_:1})]),_:1}),e.disabled?V("",!0):(u(),c(d,{key:0,span:6,style:{"text-align":"right"}},{default:p(()=>[e.deep<=e.maxDepth&&e.ctrl.addSub?(u(),c(g,{key:0,size:"mini",color:"#67C23A"},{default:p(()=>[b(v,{placement:"top-start",content:"添加规则组"},{default:p(()=>[b(h,{style:{color:"green",padding:"2px"},onClick:e.addChild},null,8,["onClick"])]),_:1})]),_:1})):V("",!0),e.ctrl.del?(u(),c(g,{key:1,size:"mini",color:"#F56C6C"},{default:p(()=>[b(v,{placement:"top-start",content:"删除"},{default:p(()=>[b(m,{style:{color:"red",padding:"2px"},onClick:e.deleteRow},null,8,["onClick"])]),_:1})]),_:1})):V("",!0),e.ctrl.addBrother?(u(),c(g,{key:2,size:"mini",color:"#909399"},{default:p(()=>[b(v,{placement:"top-start",content:"添加同层规则"},{default:p(()=>[b(w,{style:{color:"gray",padding:"2px"},onClick:e.addRow},null,8,["onClick"])]),_:1})]),_:1})):V("",!0)]),_:1}))]),_:1})]),_:1},8,["model","rules"]))])}const Xl=j(Jl,[["render",Zl],["__scopeId","data-v-700634d0"]]),eo={props:{root:{type:Boolean,default:!1},left:{type:Boolean,default:!1},modelValue:{type:String,default:"and"},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],data(){return{localValue:""}},watch:{modelValue:{handler(e){this.localValue=e},immediate:!0,deep:!0}},methods:{onclick(){this.localValue=this.localValue==="and"?"or":"and",this.$emit("update:modelValue",this.localValue)}}},to=e=>(je("data-v-2bd34a41"),e=e(),Ee(),e),ao={key:0,class:"logic"},lo={key:1},oo=to(()=>_("div",{class:"line"},null,-1));function so(e,t,a,l,o,s){return u(),y("div",{class:H("ident "+(a.left?"line-left":""))},[a.root?V("",!0):(u(),y("div",ao,[a.disabled?(u(),y("span",lo,A(o.localValue==="and"?"且":"或"),1)):(u(),y("i",{key:0,class:H("iconfont "+(o.localValue==="and"?"ra-and":"ra-or")),onClick:t[0]||(t[0]=(...n)=>s.onclick&&s.onclick(...n))},null,2))])),oo],2)}const no=j(eo,[["render",so],["__scopeId","data-v-2bd34a41"]]),io={name:"RuleCreate",components:{CirclePlus:_a,RuleFields:Xl,RuleIdent:no},inject:["formData"],props:{modelValue:{type:Array,default:e=>[]},level:{type:Number,default:e=>1},formItems:{type:Array,default:e=>[]},factoryItems:{type:Array,default:e=>[]},optionsApi:{type:String,default:""},deep:{type:Number,default:1},maxDepth:{type:Number,default:3},disabled:{type:Boolean,default:!1},initValue:{type:Boolean,default:!0},ctrl:{type:Object,default:()=>{}}},emits:["update:modelValue","ruleTextChange"],data(){const e={logic:"and",field:"",operator:""};if(this.$props.optionsApi!==""){const t=Kt(this.$props.optionsApi);t.length>0&&t.forEach(a=>{this.$watch(`formData.${a}`,()=>{this.realOptionsApi=I(this.$props.optionsApi,this.formData),this.ruleList=[{...this.defaultConfig}]},{deep:!0,immediate:!0})})}return{validateMessage:"",defaultConfig:e,previewText:"",ruleList:[],factorOptions:this.$props.factoryItems,factoryKey:0,realOptionsApi:I(this.$props.optionsApi,this.formData),realFormItems:this.$props.formItems}},watch:{modelValue:{handler(e){Array.isArray(e)&&e.length>0?this.ruleList=e:this.initValue&&(this.ruleList=[{...this.defaultConfig}])},immediate:!0,deep:!0},previewText(){this.$emit("ruleTextChange",this.previewText)},realOptionsApi:{handler(e){this.$props.deep===1&&e&&this.$http.get(e).then(({data:t})=>{const a=t||[];this.realFormItems=a,this.makeFactory(a),this.change()})},immediate:!0,deep:!0},formItems:{handler(e){},immediate:!0,deep:!0},realFormItems:{handler(e){},immediate:!0,deep:!0}},mounted(){this.change()},methods:{addOne(){this.ruleList.push({...this.defaultConfig})},makeFactory(e){const t=[];e.forEach(a=>{t.push({value:a.field||"",label:a.label})}),this.factorOptions=t,this.factoryKey++},getKey(){return Math.random().toString(16).slice(2)},addRow(e,t){t.push({...this.defaultConfig}),this.change()},deleteRow(e,t){if(t.length===1&&this.level===1)return this.$message.warning("最少要保留一条！");t.splice(e,1),this.change()},addChild(e,t,a){a.push({...this.defaultConfig,children:[{...this.defaultConfig}]}),this.change()},validate:async function(){var e,t;if(this.$refs._ruleForm){for(let a=0;a<((e=this.$refs._ruleForm)==null?void 0:e.length);a++)if(!await this.$refs._ruleForm[a].validate())return!1}if(this.$refs._ruleCreate){for(let a=0;a<((t=this.$refs._ruleCreate)==null?void 0:t.length);a++)if(!await this.$refs._ruleCreate[a].validate())return!1}return!0},getPreviewText(){const e=(t,a=1)=>{const l=[];return t.forEach((o,s)=>{if(o.children&&o.children.length>0){l.push([o.logic,"(",e(o.children,a+1),")"].join(" "));return}const n=this.realFormItems.filter(r=>r.field===o.field)[0];l.push([s===0?"":o.logic,n?n.label:"",o.operator,o.value].filter(r=>r!=="").join(" "))}),l.join(" ")};this.previewText=e(this.ruleList,1)},change(e,t){this.level===1&&this.getPreviewText(),e==="field"&&t!==void 0&&(this.ruleList[t].operator="",this.ruleList[t].value=void 0),this.$emit("update:modelValue",this.ruleList)},changeRecursive(e){this.change()}}},ro={key:0},uo={key:1,class:"rule-row"},po={key:0,class:"preview"},co={key:1,class:"el-form-item__error"};function ho(e,t,a,l,o,s){const n=D("CirclePlus"),r=Q,i=D("RuleIdent"),d=Y,f=D("RuleCreate"),h=D("RuleFields"),v=G;return o.ruleList.length===0?(u(),y("div",ro,[a.disabled?V("",!0):(u(),c(r,{key:0,onClick:s.addOne},{default:p(()=>[b(n)]),_:1},8,["onClick"]))])):(u(),y("div",{key:1,class:H({_ruleCreate_root:a.level===1})},[(u(!0),y(E,null,N(o.ruleList,(g,m)=>(u(),c(v,{key:`root${m}`,class:"rule-cell"},{default:p(()=>[b(d,{span:2},{default:p(()=>[b(i,{modelValue:g.logic,"onUpdate:modelValue":[w=>g.logic=w,s.change],root:m===0,left:o.ruleList.length>1,disabled:a.disabled},null,8,["modelValue","onUpdate:modelValue","root","left","disabled"])]),_:2},1024),b(d,{span:22},{default:p(()=>[g.children&&g.children.length>0?(u(),c(f,{key:`child${o.factoryKey}`,ref_for:!0,ref:"_ruleCreate",modelValue:g.children,"onUpdate:modelValue":[w=>g.children=w,s.changeRecursive],class:H(["_child_root",{"last-row-child":m===o.ruleList.length-1}]),disabled:a.disabled,level:a.level+1,"factory-items":o.factorOptions,"form-items":o.realFormItems,deep:a.deep+1},null,8,["modelValue","onUpdate:modelValue","disabled","class","level","factory-items","form-items","deep"])):(u(),y("div",uo,[(u(),c(h,{ref_for:!0,ref:"_ruleForm",key:o.factoryKey,rule:g,"add-child-visible":a.level===1,"form-items":o.realFormItems,"factor-options":o.factorOptions,disabled:a.disabled,"max-depth":a.maxDepth,deep:a.deep+1,ctrl:{addSub:!0,addBrother:!0,del:!0,...a.ctrl},onAddChild:w=>s.addChild(m,g,o.ruleList),onDelete:w=>s.deleteRow(m,o.ruleList),onAdd:w=>s.addRow(m,o.ruleList),onChange:w=>s.change(w,m)},null,8,["rule","add-child-visible","form-items","factor-options","disabled","max-depth","deep","ctrl","onAddChild","onDelete","onAdd","onChange"]))]))]),_:2},1024)]),_:2},1024))),128)),a.level===1?(u(),y("div",po,"规则预览："+A(o.previewText),1)):V("",!0),a.level===1?(u(),y("div",co,A(o.validateMessage),1)):V("",!0)],2))}const $t=j(io,[["render",ho],["__scopeId","data-v-33709c91"]]);function Ze(e){return e.length===0?0:parseInt(e.join(""),2)}function mo(e){return e.toString(2).split("")}const fo=B({name:"VPointCheckbox",props:{options:{type:Array,default:()=>[]},modelValue:{type:Number,default:0},disabled:{type:Boolean,default:!1},min:{type:Number,default:void 0},max:{type:Number,default:void 0}},emits:["update:modelValue"],data(){const e=mo(this.$props.modelValue).reverse(),t=[];return e.forEach((a,l)=>{a==="1"&&t.push(l)}),{localValue:t}},methods:{onchange(){const e=this.$props.options.map(a=>a.value);let t=Array(Math.max(...e)).fill("0");this.localValue.forEach(a=>{t[a]="1"}),t=t.reverse(),t.join(""),Ze(t),this.$emit("update:modelValue",Ze(t))}}});function bo(e,t,a,l,o,s){const n=at,r=lt;return u(),c(r,{modelValue:e.localValue,"onUpdate:modelValue":t[0]||(t[0]=i=>e.localValue=i),max:e.max,min:e.min,onChange:e.onchange},{default:p(()=>[(u(!0),y(E,null,N(e.options,(i,d)=>(u(),c(n,{key:d+"-checkbox",label:i.value},{default:p(()=>[x(A(i.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue","max","min","onChange"])}const yo=j(fo,[["render",bo]]),xt=B({__name:"VNumber",props:{modelValue:{type:Number,default:0},min:{type:[Number,String],default:-1/0}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,l=U(()=>{if(q(a.min))switch(a.min){case"current":return a.modelValue}return a.min}),o=t,s=$(a.modelValue),n=()=>{o("update:modelValue",s.value)};return(r,i)=>{const d=oa;return u(),c(d,{modelValue:F(s),"onUpdate:modelValue":[i[0]||(i[0]=f=>re(s)?s.value=f:null),n],min:F(l)},null,8,["modelValue","min"])}}}),go={props:{modelValue:{type:[Number,String],default:""}},emits:["update:modelValue"],data(){return{hours:"",minutes:"",seconds:""}},watch:{modelValue:{handler(e){if(!e){this.hours=this.minutes=this.seconds=0;return}const t=parseInt(e,10);this.hours=Math.floor(t/3600),this.minutes=Math.floor((t-this.hours*3600)/60),this.seconds=t-this.hours*3600-this.minutes*60},immediate:!0}},methods:{handleInput(e,t){let a=0;t==="hours"&&(a=this.calcSeconds(e,this.minutes,this.seconds)),t==="minutes"&&(a=this.calcSeconds(this.hours,e,this.seconds)),t==="seconds"&&(a=this.calcSeconds(this.hours,this.minutes,e)),this.$emit("update:modelValue",a)},calcSeconds(e,t,a){return e*3600+t*60+a}}};function vo(e,t,a,l,o,s){const n=_e,r=Y,i=G;return u(),c(i,{gutter:20},{default:p(()=>[b(r,{span:6},{default:p(()=>[b(n,{modelValue:o.hours,"onUpdate:modelValue":[t[0]||(t[0]=d=>o.hours=d),t[1]||(t[1]=d=>s.handleInput(d,"hours"))],modelModifiers:{number:!0}},{append:p(()=>[x("时")]),_:1},8,["modelValue"])]),_:1}),b(r,{span:6},{default:p(()=>[b(n,{modelValue:o.minutes,"onUpdate:modelValue":[t[2]||(t[2]=d=>o.minutes=d),t[3]||(t[3]=d=>s.handleInput(d,"minutes"))],modelModifiers:{number:!0}},{append:p(()=>[x("分")]),_:1},8,["modelValue"])]),_:1}),b(r,{span:6},{default:p(()=>[b(n,{modelValue:o.seconds,"onUpdate:modelValue":[t[4]||(t[4]=d=>o.seconds=d),t[5]||(t[5]=d=>s.handleInput(d,"seconds"))],modelModifiers:{number:!0}},{append:p(()=>[x("秒")]),_:1},8,["modelValue"])]),_:1})]),_:1})}const wo=j(go,[["render",vo]]),ko=B({__name:"select",props:{source:{type:Array,default:()=>[]},onSelection:{type:Function,default:()=>{}}},setup(e){const t=X(()=>Promise.resolve().then(()=>Rt)),a=$({}),l=$(""),o=e;o.source.length>0&&(l.value=o.source[0].label+"");const s=U(()=>{let r=-1;return o.source.forEach((i,d)=>{i.label===l.value&&(r=d)}),r}),n=r=>{o.onSelection(s.value,r)};return(r,i)=>{const d=dt,f=pt;return u(),c(f,{modelValue:l.value,"onUpdate:modelValue":i[0]||(i[0]=h=>l.value=h),type:"card"},{default:p(()=>[(u(!0),y(E,null,N(o.source,(h,v)=>(u(),c(d,{key:v,label:h.label,name:h.label,lazy:!0},{default:p(()=>[b(F(t),{ref_for:!0,ref:a.value[h.value],"show-pagination":!1,"show-normal-button":!1,"show-batch-button":!1,"show-row-button":!1,"show-selection":!0,"sync-url":!1,"info-api":h.infoApi,"list-api":h.listApi,onSelection:n},null,8,["info-api","list-api"])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])}}}),Vo={class:"dialog-footer"},Co=B({__name:"index",props:{modelValue:{type:[String,Number,Array],default:void 0},tableSchema:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},multiple:{type:Boolean,default:!1},multipleLimit:{type:Number,default:0},effectData:{type:[String,Array,Object],default:()=>{}}},emits:["update:modelValue"],setup(e,{emit:t}){const a=t,l=e,o=$([]);De(()=>l.modelValue,h=>{h&&(o.value=l.multiple?[...h]:[h])},{immediate:!0});const s=h=>{o.value.splice(h,1)},n=$(!1),r=()=>{if(l.multiple===!1&&o.value.length>1){$e.error("只允许选择一个");return}n.value=!1,o.value.length>0&&a("update:modelValue",l.multiple?o.value:o.value[0],Ge(l.effectData,{tab_id:i.value}))},i=$(),d=(h,v)=>{i.value=l.tableSchema[h].id,o.value=v.map(g=>{const m=Ge(l.tableSchema[h].valueKey,g);return q(l.tableSchema[h].valueKey)?m[l.tableSchema[h].valueKey]:m}).filter(g=>g)},f=()=>{n.value=!1,o.value=[],i.value=void 0};return(h,v)=>{const g=Ve,m=z,w=se;return u(),y("div",null,[(u(!0),y(E,null,N(o.value,(k,S)=>(u(),c(g,{key:k,class:"mx-1",closable:"","disable-transitions":!1,onClose:O=>s(S)},{default:p(()=>[x(A(k),1)]),_:2},1032,["onClose"]))),128)),e.multiple||o.value.length===0?(u(),c(m,{key:0,class:"button-new-tag ml-1",size:"small",onClick:v[0]||(v[0]=k=>n.value=!0)},{default:p(()=>[x(" + 添加 ")]),_:1})):V("",!0),b(w,{ref:"dialog",modelValue:n.value,"onUpdate:modelValue":v[2]||(v[2]=k=>n.value=k),"append-to-body":!0,"destroy-on-close":!0,"before-close":f,title:"选择",width:"80%"},{footer:p(()=>[_("span",Vo,[b(m,{onClick:v[1]||(v[1]=k=>n.value=!1)},{default:p(()=>[x("取消")]),_:1}),b(m,{type:"primary",onClick:r},{default:p(()=>[x("确定")]),_:1})])]),default:p(()=>[b(ko,{ref:"selectDom",source:e.tableSchema,"on-selection":d},null,8,["source"])]),_:1},8,["modelValue"])])}}}),So=j(Co,[["__scopeId","data-v-eec61fd9"]]),_o={};function $o(e,t){const a=ca;return u(),c(a)}const xo=j(_o,[["render",$o]]),oe={input:"v-input",number:"v-number",radio:"v-radio",checkbox:"v-checkbox","number-range":"v-number-range",date:"v-date",daterange:"v-date",time:"el-time-picker",datetime:"el-date-picker",datetimerange:"el-date-picker",slider:"el-slider",image:"v-upload",upload:"v-upload",file:"v-upload",transfer:"el-transfer",color:"el-color-picker",rate:"el-rate",select:"v-select",switch:"v-switch",json:"v-json","icon-select":"v-icon-select","sub-form":"v-sub-form",cascader:"v-cascader","cascader-panel":"v-cascader-panel",rule:"v-rule",filter:"v-filter",show:"v-show",editor:"monaco-editor",code:"monaco-editor",textarea:"el-input","point-checkbox":"v-point-checkbox",duration:"v-duration","table-select":"v-table-select"},Oo={inline:!1,labelPosition:"right",labelWidth:"100px",submitButton:{show:!0,type:"primary",showText:"提交"},cancelButton:{show:!0,type:"info",showText:"取消"}};function Ao(e){return e=e||{},pe(e.submitButton)&&(e.submitButton={show:e.submitButton}),pe(e.cancelButton)&&(e.cancelButton={show:e.cancelButton}),C.merge({},Oo,e)}const ue={VSelect:vt,VRadio:Ya,VCheckbox:Ga,VNumberRange:al,VJson:wt,VIconSelect:nl,VSubForm:cl,VUpload:kt,VInput:Vt,VCascader:kl,VCascaderPanel:_t,VFilter:Al,VShow:El,MonacoEditor:Pe,VRule:$t,VPointCheckbox:yo,VNumber:xt,VDuration:wo,VDate:Tl,VTableSelect:So,VSwitch:xo},Bo=e=>{Object.keys(e).forEach(t=>{ue[t]=e[t]})},Fe=e=>(e||(e="input"),oe[e]!==void 0?oe[e]:oe["v-"+e]!==void 0?oe["v-"+e]:e),Le=(e,t)=>{const a=e.props||{};return t&&t.disabled&&(a.disabled=!0),e.options&&(a.options=e.options),["file","image"].indexOf(e.type)>-1&&(a.action||(a.action="/upload"),a.type=e.type),e.readonly!==void 0&&(a.disabled=!!e.readonly,delete e.readonly),e.disabled!==void 0&&(a.disabled=!!e.disabled,delete e.disabled),e.type!=="color"&&(a.clearable=!0),e.type==="datetime"&&(a.type="datetime",a.format="YYYY-MM-DD HH:mm:ss",a.valueFormat="YYYY-MM-DD HH:mm:ss"),e.type==="date"&&(a.type="date",a.format=a.format||"YYYY-MM-DD",a.valueFormat=a.valueFormat||"YYYY-MM-DD"),e.type==="datetimerange"&&(a.type="datetimerange",a.format=a.format||"YYYY-MM-DD HH:mm:ss",a.valueFormat=a.valueFormat||"YYYY-MM-DD HH:mm:ss",a.startPlaceholder=(e.label||e.field).replace("开始时间","").replace("时间","")+"开始时间",a.endPlaceholder=(e.label||e.field).replace("结束时间","").replace("时间","")+"结束时间"),e.type==="daterange"&&(a.type="daterange",a.format=a.format||"YYYY-MM-DD",a.valueFormat=a.valueFormat||"YYYY-MM-DD",a.startPlaceholder=(e.label||e.field).replace("开始日期","").replace("日期","")+"开始日期",a.endPlaceholder=(e.label||e.field).replace("结束日期","").replace("日期","")+"结束日期"),e.type==="textarea"&&(a.type="textarea"),t&&!t.labelWidth&&(a.placeholder=e.label||e.field),a},Ot=(e,t)=>{if(e.value!==void 0){if(e.type==="date"&&q(e.value)&&Xt(e.value)){const{format:a}=Le(e,t);return Aa(ea(e.value)).format(a)}return e.value}};let At=()=>({});function Do(e){At=e}const jo=B({__name:"FormAction",props:{submiting:{type:Boolean,default:!1},formOptions:{type:Object,default:()=>{}},submitConfirm:{type:[Boolean,Object],default:!1}},emits:["submit","cancel"],setup(e,{emit:t}){const a=e,l=t,o=r=>l(r),s=U(()=>{var r,i,d,f;return((i=(r=a.formOptions)==null?void 0:r.submitButton)==null?void 0:i.show)===!0||((f=(d=a.formOptions)==null?void 0:d.cancelButton)==null?void 0:f.show)===!0}),n=()=>{const r={title:a.submitConfirm===!0?"确认提示":a.submitConfirm.title,message:a.submitConfirm===!0?"确认要提交吗?":a.submitConfirm.message};ut.confirm(r.message,r.title).then(()=>{o("submit")},()=>{})};return(r,i)=>{const d=z,f=Oe;return F(s)?(u(),c(f,{key:0},{default:p(()=>[e.formOptions.submitButton&&e.formOptions.submitButton.show?(u(),c(d,M({key:0,loading:e.submiting},e.formOptions.submitButton,{onClick:i[0]||(i[0]=h=>e.submitConfirm?n():o("submit"))}),{default:p(()=>[x(A(e.formOptions.submitButton.showText),1)]),_:1},16,["loading"])):V("",!0),e.formOptions.cancelButton&&e.formOptions.cancelButton.show?(u(),c(d,M({key:1},e.formOptions.cancelButton,{onClick:i[1]||(i[1]=h=>o("cancel"))}),{default:p(()=>[x(A(e.formOptions.cancelButton.showText),1)]),_:1},16)):V("",!0)]),_:1})):V("",!0)}}});ue.Warning=ct;const Eo=B({name:"FormItem",components:ue,props:{formOptions:{type:Object,default:()=>{}},item:{type:Object,default:()=>{}},modelValue:{type:[String,Number,Object,Array,Boolean],default:void 0},showLabel:{type:Boolean,default:!0},components:{type:Object,default:()=>{}},mod:{type:String,default:""}},emits:["update:modelValue"],setup(e,{emit:t}){const a=$(e.modelValue),l=ie(),o=$(e.item);if(o.value.type==="template"){o.value.type="v-tpl"+o.value.field;const s={};Object.keys(o.value.comp.methods||[]).forEach(n=>{s[n]=Function(`return ${o.value.comp.methods[n]}`)()}),l!==null&&(l.type.components["VTpl"+o.value.field]=C.merge({},o.value.comp,{data(){return{...o.value.comp.data}},methods:s}))}return{localValue:a,getComponentName:Fe,onFiledChange:(s,n)=>{t("update:modelValue",s,n)},compProps:(s,n)=>{const r=Le(s,n);return e.mod==="create"&&s.value===void 0&&(r.disabled=!1),r}}}}),To=e=>(je("data-v-22b19f5f"),e=e(),Ee(),e),Io=["innerHTML"],Po=To(()=>_("i",{class:"el-icon-warning-outline"},null,-1)),Fo={style:{display:"flex","flex-direction":"column",width:"100%"}},Lo={key:0,class:"form-item-info"},Mo=["innerHTML"];function No(e,t,a,l,o,s){const n=ne,r=D("Warning"),i=Q,d=Oe;return W((u(),c(d,{prop:e.item.field},me({default:p(()=>{var f;return[_("div",Fo,[_("div",{class:H({"my-inline-form-item":(f=e.formOptions)==null?void 0:f.inline})},[(u(),c(K(e.getComponentName(e.item.type)),M({key:e.item.id||"",ref:"ctrl",modelValue:e.localValue,"onUpdate:modelValue":t[0]||(t[0]=h=>e.localValue=h)},e.compProps(e.item,e.$props.formOptions),{"onUpdate:modelValue":e.onFiledChange}),null,16,["modelValue","onUpdate:modelValue"]))],2),e.item.info&&!e.formOptions.inline?(u(),y("div",Lo,[b(i,{color:"#E6A23C"},{default:p(()=>[b(r)]),_:1}),x(),_("span",{innerHTML:e.item.info},null,8,Mo)])):V("",!0)])]}),_:2},[e.showLabel?{name:"label",fn:p(()=>[x(A(e.item.label||e.item.field)+" ",1),e.item.info&&e.formOptions.inline?(u(),c(n,{key:0,placement:"top"},{content:p(()=>[_("span",{innerHTML:e.item.info},null,8,Io)]),default:p(()=>[Po]),_:1})):V("",!0)]),key:"0"}:void 0]),1032,["prop"])),[[gt,e.item.type!=="hidden"]])}const Bt=j(Eo,[["render",No],["__scopeId","data-v-22b19f5f"]]),Dt=Object.freeze(Object.defineProperty({__proto__:null,default:Bt},Symbol.toStringTag,{value:"Module"})),de={required:{required:!0,message:"该项为必填项",trigger:"blur"},string:{type:"string",message:"该项类型必须是字符串",trigger:"blur"},number:{type:"number",message:"该项类型必须是数字",trigger:"blur"},boolean:{type:"boolean",message:"该项类型必须是布尔",trigger:"blur"},integer:{type:"integer",message:"该项类型必须是整数",trigger:"blur"},float:{type:"float",message:"该项类型必须是浮点数",trigger:"blur"},array:{type:"array",message:"该项类型必须是数组",trigger:"blur"},enum:e=>({type:"enum",enum:e.split(","),message:"该项值必须在"+e+"中",trigger:"change"}),url:{type:"url",message:"请输入正确的url",trigger:"change"},email:{type:"email",message:"请输入正确的邮箱",trigger:"change"},regex:e=>({pattern:new RegExp(e),message:"该项格式必须符合"+e,trigger:"change"}),len:e=>({len:parseInt(e),message:`该项长度必须为${e}位`,trigger:"blur"}),min:e=>({min:parseInt(e),message:`该项长度至少为${e}位`,trigger:"blur"}),max:e=>({max:parseInt(e),message:`该项长度最多为${e}位`,trigger:"blur"}),required_if:(e,t,a)=>({validator:function(l,o,s){t[e]!==void 0&&String(o).length===0?s("该项为必填项"):s()},trigger:"blur"})};function Ro(e,t,a){if(T(e))return e;if(J(e))return[e];if(q(e)){let l=[];typeof e=="string"&&(l=e.split("|"));const o=[];return l.forEach(s=>{if(s.indexOf(":")>-1){const n=s.split(":"),r=n[0],i=n[1];de[r]!==void 0?o.push(de[r](i,t,a)):console.warn("not support rule: "+r)}else de[s]!==void 0?o.push(de[s]):console.warn("not support rule: "+s)}),o}return[]}const Ho=B({name:"VForm",components:{FormAction:jo,FormItem:Bt,ElCard:ot},provide(){return{formData:this.formData,rootData:this.$props.rootData,dev:this.dev,mod:this.mod}},inheritAttrs:!1,props:{prefixPath:{type:String,default:""},isSub:{type:Boolean,default:!1},modelValue:{type:Object,default:e=>{}},formItems:{type:[Array,Function],default:()=>[]},infoApi:{type:String,default:""},getApi:{type:String,default:""},saveApi:{type:[String,Boolean],default:""},options:{type:Object,default:()=>({})},afterSubmit:{type:[String,Function],default:""},afterReset:{type:[String,Function],default:""},components:{type:Object,default:()=>({})},rootData:{type:Function,default:()=>({})},dev:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},enableCache:{type:Boolean,default:!1},initQueryParams:{type:Boolean,default:!0},mod:{type:String,default:""},submitPreCheck:{type:Function,default:()=>""},submitConfirm:{type:[Boolean,Object],default:!1}},emits:["submit","reset","fieldchange","update:modelValue","mounted","devAction"],data(){return{key:0,loading:!1,submiting:!1,errMsg:"",props:C.cloneDeep(this.$props),formData:Object.assign({},this.$props.modelValue),cacheFormData:Object.assign({},this.$props.modelValue),tmpFormData:Object.assign({},this.$props.modelValue),fieldMap:{},computeRules:[],formItemsSource:[],cacheItems:[],formOptions:{},dependMap:{fieldDependFields:{},dependFieldSourceFields:{}}}},computed:{formRules(){const e={};let t=this.$props.formItems;return R(this.$props.formItems)&&(t=this.$props.formItems(this.formData)),t.forEach(a=>{a.rules!==void 0&&this.canShow(a)&&(e[a.field]=Ro(a.rules,this.formData,()=>this.$refs.formData))}),e},formItemsSection(){const e=[],t=this.formItemsSource.map(function(l,o){return l.index===void 0&&(l.index=`[${o}]`),l.type==="sub-form"&&l.props&&l.props["form-items"]&&(l.props["form-items"]=l.props["form-items"].map((s,n)=>(s.index===void 0&&(s.index=`[${o}].props.form-items[${n}]`),s))),l});t.forEach((l,o)=>{(o===0||l.section!==void 0)&&e.push(o)});const a=[];for(let l=0,o=1;e[l]!==void 0;l++,o++)a.push(t.slice(e[l],e[o]||t.length));return a.map(l=>{const o=this.layoutItem(l);return{name:o[0].items[0].section,children:o}})}},watch:{props:{handler(){const{formItems:e,options:t}=this.props,a=this.init(C.cloneDeep(R(e)?e(this.$props.modelValue):e));Object.keys(a).forEach(l=>{l==="formData"?(this[l]=C.merge(this.formData,a[l]),this.cacheFormData=C.cloneDeep(this.formData)):this[l]=a[l]}),this.formOptions=Ao(t||this.$props.options),setTimeout(this.computedInit,50)},immediate:!0}},mounted(){this.$watch(()=>this.rootData(),()=>{this.formItemsSource.forEach(e=>{var t,a;if(((a=(t=e.depend)==null?void 0:t.field)==null?void 0:a.indexOf("."))!==0)return;const l=this.canShow(e);e.show!==l&&(e.show=this.canShow(e),e.id=ye())})},{deep:!0,immediate:!0}),this.$props.infoApi?(this.loading=!0,this.$http.request({method:"GET",url:this.$props.infoApi}).then(({data:e})=>{this.$props.infoApi!==""&&delete e.infoApi,this.$props.saveApi!==""&&delete e.saveApi,this.props=C.merge({},this.$props,e),this.loading=!1,this.key++,this.$emit("mounted",this.$refs.formData)})):this.$emit("mounted",this.$refs.formData),!this.$props.dev&&this.$props.getApi&&this.$http.request({method:"GET",url:this.$props.getApi}).then(({data:e})=>{const t=Yt(e,this.formData);this.formData=Object.assign(this.formData,e),t.forEach(a=>{this.canShowPop(a,this.dependMap.dependFieldSourceFields[a]||[])}),this.key++})},methods:{async onenter(){var e;(e=this.$props.options)!=null&&e.inline&&await this.submitForm()},layoutItem(e){const t=[],a={isCard:!1,isRow:!0,items:[]};return e.forEach((l,o)=>{if(l.col=l.col||{span:24},l.col.span===24)t.push(Object.assign({},a,{items:[l]}));else if(t.length>0){const s=C.sum(t[t.length-1].items.map(n=>n.col.span));s<24&&s+l.col.span<=24?t[t.length-1].items.push(l):t.push(Object.assign({},a,{items:[l]}))}else t.push(Object.assign({},a,{items:[l]}))}),t},defaultValue(e){const t={};return e.forEach(a=>{var l,o;if(a.value!==void 0&&(t[a.field]=a.value),a.type==="sub-form"){const s=this.defaultValue(((l=a==null?void 0:a.props)==null?void 0:l.formItems)||[]);t[a.field]=((o=a==null?void 0:a.props)==null?void 0:o.repeat)===!0?[s]:s}}),t},getQueryParams(){return tt(location.href)},getQueryObject(e){const t=this.initQueryParams?this.getQueryParams():{};Object.keys(t).forEach(l=>{l.indexOf("[]")>-1&&(t[l.replace("[]","")]=t[l],delete t[l])});const a={};return e.forEach(l=>{t[l.field]!==void 0&&(a[l.field]=this.parseType(l,t[l.field]))}),a},getFormData(e){const t={query:this.getQueryObject(e),default:this.defaultValue(e),model:this.$props.modelValue},a=["model","query","default"],l=[];a.reverse().forEach(s=>{l.push(t[s])});const o=C.merge(l[0],l[1],l[2]);return e.forEach(s=>{o[s.field]!==void 0&&(o[s.field]=this.parseType(s,o[s.field]))}),o},init(e){const t=this.getFormData(e),a={},l={};e.forEach(s=>{t[s.field]===void 0&&(t[s.field]=Ot(s)),a[s.field]=s,s.computed!==void 0&&(l[s.field]=s.computed),s.props=this.getComponentProps(s),this.formOptions.column!==void 0&&(s.col={span:24/this.formOptions.column}),this.$props.disabled&&(s.props.disabled=!0),s.depend&&(T(s.depend)?s.depend:[s.depend]).forEach(n=>{this.dependMap.fieldDependFields[s.field]=this.dependMap.fieldDependFields[s.field]||[],this.dependMap.fieldDependFields[s.field].push(n.field),this.dependMap.dependFieldSourceFields[n.field]=this.dependMap.dependFieldSourceFields[n.field]||[],this.dependMap.dependFieldSourceFields[n.field].push(s.field)})});const o=null;return this.formData=t,e.forEach(s=>{s.show=this.canShow(s)}),{initData:C.cloneDeep(C.merge(t,o)),fieldMap:a,computeRules:l,formItemsSource:e,cacheItems:C.cloneDeep(e)}},parseType(e,t){var a;const l=t||e.value,o=He(l);let s=e.valueType;switch(e.options&&e.options[e.options.length-1]!==void 0&&(s=He((a=e.options[e.options.length-1])==null?void 0:a.value)),e.type==="switch"&&(s="boolean"),s){case"number":return o==="array"?t.map(n=>(n+"").indexOf(".")>-1?parseFloat(n):parseInt(n)):(l+"").indexOf(".")>-1?parseFloat(l):parseInt(l);case"string":return l+"";case"boolean":return Gt(l);default:return l}},async validate(){var e,t,a;try{const l=this.$props.submitPreCheck(this.formData);if(l)return this.errMsg=l,!1;if(!await this.$refs.formData.validate())return!1;for(let o=0;o<this.formItemsSource.length;o++){const s=this.formItemsSource[o],n=this.$refs[s.field]?(a=(t=(e=this.$refs[s.field][0])==null?void 0:e.$refs)==null?void 0:t.ctrl)==null?void 0:a.validate:void 0;if(!(!s.show||!n)&&(Wt(n)&&!await n()||R(n)&&!n()))return!1}return!0}catch(l){return console.error(l),!1}},async submitForm(e){if(!await this.validate())return ke("is-error"),console.warn("form validate result : false"),!1;if(!this.$props.saveApi){this.$emit("submit",this.formData);return}this.submiting=!0;const t={...this.formData};try{const a=await this.$http.request({method:"POST",url:this.$props.saveApi,data:t});let l=a.message;l==="0"&&(l=void 0),this.$message({type:"success",message:l||"保存成功"}),this.submiting=!1,setTimeout(o=>this.execAfter("afterSubmit"),1e3),this.$emit("submit",this.formData,a)}catch{this.submiting=!1}},resetForm(e){this.formData=C.cloneDeep(this.initData),this.$emit("update:modelValue",C.cloneDeep(this.initData)),this.$emit("reset"),setTimeout(t=>this.execAfter("afterReset"),1e3)},getComponentName(e){return oe[e]||e},getComponentProps(e){const t=e.props||{};return e.options&&(t.options=e.options),t},canShow(e){let t=!0;const a=e.depend;return a&&(T(a)?a:[a]).forEach(l=>{let o=this.formData;l.field.indexOf(".")!==-1&&(o=this.rootData());const s=l.field.replace(/^\.+/,""),n=Jt(s,o);let r=(i,d)=>i===d;T(l.value)&&(T(n)?r=(i,d)=>i.filter(function(f){return d.indexOf(f)>-1}).length>0:r=(i,d)=>i.indexOf(d)>-1),r(l.value,n)||(t=!1)}),e.hide,t},canShowPop(e,t){t.forEach(a=>{const l=this.formItemsSource.findIndex(s=>s.field===a),o=this.canShow(this.formItemsSource[l]);this.formItemsSource[l].show=o,this.formItemsSource[l].id=ye(),o||(this.formData[a]=this.initData[a],(this.dependMap.dependFieldSourceFields[a]||[]).forEach(s=>{this.canShowPop(s,this.dependMap.dependFieldSourceFields[a]||[])}))})},onFiledChange(e,t,a){if(this.formData[e]=t,a){let s=!1;Object.keys(a).forEach(n=>{n!==e&&this.formData[n]!==a[n]&&(this.formData[n]=a[n],s=!0)}),s&&this.key++}this.canShowPop(e,this.dependMap.dependFieldSourceFields[e]||[]);var l;clearTimeout(l),l=setTimeout(()=>{this.computedWhen(e,t)},300),this.$emit("fieldchange",{field:e,value:t});const o=Fa(this.formData);delete o.__test__,this.$emit("update:modelValue",o)},computedInit(){Object.keys(this.formData).forEach(e=>{this.computedWhen(e,this.formData[e])})},execComputeRule(e,t,a,l,o=!1){let s=[];T(a)?T(a[0])||(s=[e,...a]):s=[e,"=",a];const n={};n[e]=t,Object.keys(l||[]).forEach(r=>{const i=C.findIndex(this.formItemsSource,{field:r});if(te(n,s))this.formItemsSource[i]=C.merge(this.formItemsSource[i],l[r],{id:ye()}),l[r].value!==void 0&&(this.formData[r]=l[r].value,this.key++);else if(!o){const d=C.findIndex(this.cacheItems,{field:r});this.formItemsSource[i]=C.cloneDeep(this.cacheItems[d],{id:(this.formItemsSource[i]||0)+1});const f=this.cacheFormData[r]||this.cacheItems[d].value;l[r].value!==void 0&&f&&(this.formData[r]=f,this.key++)}})},computedWhen(e,t){const a=this.computeRules[e];if(a!==void 0){if(T(a)){a.forEach(l=>{this.execComputeRule(e,t,l.when,l.set||[],!0)});return}this.execComputeRule(e,t,a.when,a.set||[])}},execAfter(e){const t=this.props[e];if(t!==void 0){if(q(t))switch(this.props[e]){case"goback":this.$route&&this.$route.preHash?this.$router.push(this.$route.preHash):history.state.back&&history.back();break;case"reload":location.reload();break}R(t)&&t()}},onDevAction(e,t){this.$emit("devAction",e,t)}}});function Uo(e,t,a,l,o,s){const n=ha,r=D("form-item"),i=D("form-action"),d=Y,f=G,h=xe,v=rt;return u(),y(E,null,[e.errMsg?(u(),c(n,{key:0,type:"error",style:{margin:"20px 40px"}},{default:p(()=>[x(A(e.errMsg),1)]),_:1})):V("",!0),e.formItemsSection.length>0?W((u(),c(h,{ref:"formData",key:e.key,class:"v-form",model:e.formData,rules:e.formRules,"label-width":e.formOptions.labelWidth,inline:e.formOptions.inline,"label-position":e.formOptions.labelPosition,"validate-on-rule-change":!1,onKeyup:Ma(e.onenter,["enter"])},{default:p(()=>[b(f,null,{default:p(()=>[(u(!0),y(E,null,N(e.formItemsSection,(g,m)=>(u(),c(K(e.formOptions.inline||m===0&&e.formItemsSection.length===1?"span":"el-card"),{key:"item-"+m,class:H(e.formOptions.inline?"form-section-inline":"form-section"),shadow:"never"},me({default:p(()=>[(u(!0),y(E,null,N(g.children,(w,k)=>(u(),c(K(e.formOptions.inline?"span":w.isRow?"el-row":"span"),{key:"section-"+m+"-"+k},{default:p(()=>[(u(!0),y(E,null,N(w.items,(S,O)=>(u(),c(K(e.formOptions.inline?"span":"el-col"),{key:"each-"+O,span:S.col.span},{default:p(()=>[W((u(),c(r,{key:S.id,ref_for:!0,ref:S.field,modelValue:e.formData[S.field],"onUpdate:modelValue":[P=>e.formData[S.field]=P,(P,L)=>e.onFiledChange(S.field,P,L)],devtool:"{devId: `${prefixPath}${each.index}`, dev: dev}","form-options":e.formOptions,components:e.components,item:S,"show-label":!!e.formOptions.labelWidth,mod:e.props.mod},null,8,["modelValue","onUpdate:modelValue","form-options","components","item","show-label","mod"])),[[gt,S.type!=="hidden"&&S.show]])]),_:2},1032,["span"]))),128))]),_:2},1024))),128))]),_:2},[g.name?{name:"header",fn:p(()=>[_("span",null,A(g.name),1)]),key:"0"}:void 0]),1032,["class"]))),128)),e.formOptions.inline===!0?(u(),c(i,{key:0,submiting:e.submiting,"form-options":e.formOptions,"submit-confirm":e.submitConfirm,onSubmit:t[0]||(t[0]=g=>e.submitForm("formData")),onCancel:t[1]||(t[1]=g=>e.resetForm("formData"))},null,8,["submiting","form-options","submit-confirm"])):(u(),c(d,{key:1,span:24},{default:p(()=>[b(i,{submiting:e.submiting,"form-options":e.formOptions,"submit-confirm":e.submitConfirm,onSubmit:t[2]||(t[2]=g=>e.submitForm("formData")),onCancel:t[3]||(t[3]=g=>e.resetForm("formData"))},null,8,["submiting","form-options","submit-confirm"])]),_:1}))]),_:1})]),_:1},8,["model","rules","label-width","inline","label-position","onKeyup"])),[[v,e.loading]]):V("",!0)],64)}const Me=j(Ho,[["render",Uo],["__scopeId","data-v-aa1b1e50"]]),jt=Object.freeze(Object.defineProperty({__proto__:null,default:Me},Symbol.toStringTag,{value:"Module"})),zo=Object.freeze(Object.defineProperty({__proto__:null,MonacoEditor:Pe,VCascaderPanel:_t,VForm:Me,VInput:Vt,VJson:wt,VRule:$t,VSelect:vt,VUpload:kt,customFormComps:ue,getComponentName:Fe,regCustomFormComps:Bo,setUploadHeaderHandle:Do},Symbol.toStringTag,{value:"Module"})),Et=["click","afterClick","apiError","apiSuccess","action","formReset","formSubmit"],Tt={props:{type:Object,default:()=>{}},metaData:{type:[Object,Function],default:()=>{}},injectData:{type:[Object,Function],default:()=>{}},dynamicExtra:{type:Function,default:e=>e},preCheck:{type:Function,default:()=>!0},container:{type:String,default:"dialog",validator:e=>["dialog","drawer"].indexOf(e)!==-1},containerProps:{type:Object,default:()=>{}},beforeCloseContainer:{type:Function,default:()=>()=>!0},confirm:{type:Boolean,default:!0}},Ne={VForm:X(()=>Promise.resolve().then(()=>jt)),VTable:X(()=>Promise.resolve().then(()=>Rt)),VPlayer:X(()=>Promise.resolve().then(()=>tn))},qo={onclick(e,t,a,l,o){l!=null&&l.actionHandler&&R(l==null?void 0:l.actionHandler)?l==null||l.actionHandler():setTimeout(()=>a.emit("action"),200),o()}},Ko={onclick(e,t){const a=e();if(/http.*/.test(a))window.open(a);else{if(!t.$router){console.error("you must set : app.config.globalProperties.$router = createRouter()");return}t.$router.push(a).then()}}},Yo={onclick(e,t,a,l,o){if(!t.$http){console.error("you must set : app.config.globalProperties.$http = axios.create()");return}const s={url:e,...l};if(l.sourceData!==void 0&&J(l.sourceData)){const r={};Object.keys(l.sourceData).forEach(i=>{const d=C.get(l.metaData||{},l.sourceData[i]);r[i]=d}),s.data={...s.data||{},...r}}let n=null;l.isGrup&&(n=nt.service({lock:!0,text:"正在提交",background:"rgba(0, 0, 0, 0.7)"})),t.$http.request(s).then(r=>{var i;a.emit("apiSuccess",r),o(),l.isGrup&&n&&n.close(),$e({message:((i=r==null?void 0:r.data)==null?void 0:i.message)||"操作成功",type:"success",duration:5*1e3})}).catch(r=>{l.isGrup&&n&&n.close(),a.emit("apiError",r),o()}).finally(()=>{l.isGrup&&n&&n.close(),o()})},getSubProps(e,t){return e.infoApi&&(e.infoApi=I(e.infoApi,t)),e}},Go={onclick(e,t,a,l,o){o()},getSubComp(){return"VForm"},getSubProps(e,t){Object.keys(e).forEach(s=>{/.*Api$/.test(s)&&(e[s]=I(e[s],{...t,...t.$row}))});const a={},l=R(e.formItems)?e.formItems(t):e.formItems||[],o=t||{};return l.forEach(s=>{o&&o[s.field]!==void 0&&(a[s.field]=o[s.field])}),{...e},{modelValue:a,...e}},getSubEvent(e,t,a,l){return{submit(o,s){s&&s.code!==0||(a.value=!1,l!=null&&l.actionHandler&&R(l==null?void 0:l.actionHandler)?l==null||l.actionHandler(o):setTimeout(()=>t.emit("action"),200))},reset(){a.value=!1}}}},Wo={onclick(e,t,a,l,o){o()},getSubComp(e){const t=e.type;return t?"v-"+t:""},getSubProps(e,t){const a={};return Object.keys(e).forEach(l=>{/.*Api$/.test(l)?a[l]=I(e[l],t):e[l]!=="type"&&(a[l]=e[l])}),a},getSubEvent(e,t,a){return{}}},Jo={onclick(e,t,a,l,o){o()},getSubComp(){return"VTable"},getSubProps(e,t){return Object.keys(e).forEach(a=>{/.*Api$/.test(a)&&(e[a]=I(e[a],t))}),e},getSubEvent(e,t,a){return{reset(){var l;a.value=!1,"reset"in e.extra&&e.extra.reset&&((l=e.extra)==null||l.reset())},submit(l){var o;"submit"in e.extra&&e.extra.submit&&((o=e.extra)==null||o.submit(l))}}}},we={jump:Ko,api:Yo,form:Go,table:Jo,modal:Wo,base:qo};function It(e,t){let a={"append-to-body":!0,"destroy-on-close":!0};return e==="dialog"&&(a={width:"80%",...a}),e==="drawer"&&(a={size:"80%",...a}),{...a,...t.containerProps}}function Qo(e){Object.keys(e).forEach(t=>{Ne[t]=e[t]})}const Zo=B({name:"VButton",components:{...Ne,ElDialog:se,ElDrawer:st},props:{type:{type:String,default:"",validator:e=>["jump","api","form","table","modal","","base"].includes(e)},target:{type:String,default:""},text:{type:String,default:void 0},extra:{type:Object,default(){return{}}},...Tt},emits:Et,setup(e,t){const a=ie().appContext.config.globalProperties,l=$(!1),o=we[e.type||"base"];if(!o)return console.error(`您所配置的 button.type=${e.type} 不存在, 仅支持`+Object.keys(we).join(", ")),{};const s=()=>R(e.metaData)?e.metaData():e.metaData,n=()=>R(e.injectData)?e.injectData(e.extra):e.injectData,r=k=>{if(w.value=!0,t.emit("click",k),!e.preCheck(e))return;const S=()=>I(e.target||"",s());let O=e.extra||{};O.url===void 0&&(O.url=e.target),O=e.dynamicExtra({...O});const P=n();O.method===void 0||O.method==="GET"?O.params=C.merge(O.params,P):O.data=C.merge(O.data,P);const L={...O,metaData:s()};Object.keys(L).forEach(ee=>{q(L[ee])&&(L[ee]=I(L[ee],s()))}),o.onclick(S,a,t,L,()=>{["modal","form","table"].indexOf(e.type)>-1&&(l.value=!0),["api"].indexOf(e.type)>-1&&t.emit("action"),w.value=!1})},i=U(()=>I(e.text||"",s())),d=$({}),f=$("span"),h=$({}),v=$({});De(()=>l.value,()=>{d.value=It(e.container,e),f.value=o.getSubComp?o.getSubComp(e.extra||{}):"span",h.value=o.getSubProps?o.getSubProps(e.extra,s()):{},v.value=o.getSubEvent?o.getSubEvent(e,t,l,e.extra):{}});const g=()=>{e.beforeCloseContainer()&&(l.value=!1)},m=()=>{l.value=!1},w=$(!1);return{clickHandler:r,relText:i,showContainer:l,containerProps:d,beforeClose:g,xsubComp:f,xsubProps:h,xsubEvent:v,closeModal:m,transBtnProps:k=>{if(k&&k.icon&&q(k.icon)){const S=Xe(k.icon.replace("el-icon-",""),"-");k.icon=La(mt[S])}return k=k||{},k.loading=w.value,k}}}}),Xo={class:"v-btn"};function es(e,t,a,l,o,s){const n=z,r=ma;return u(),y("span",Xo,[e.$props.type==="api"&&e.confirm?(u(),c(r,{key:0,title:"确定要"+(e.relText?e.relText:"操作")+"吗",onConfirm:e.clickHandler},{reference:p(()=>[e.relText?(u(),c(n,ce(M({key:0},e.transBtnProps(e.$props.props))),{default:p(()=>[x(A(e.relText),1)]),_:1},16)):(u(),c(n,ce(M({key:1},e.transBtnProps(e.$props.props))),null,16))]),_:1},8,["title","onConfirm"])):(u(),y(E,{key:1},[e.relText?(u(),c(n,M({key:0},e.transBtnProps(e.$props.props),{onClick:e.clickHandler}),{default:p(()=>[x(A(e.relText),1)]),_:1},16,["onClick"])):(u(),c(n,M({key:1},e.transBtnProps(e.$props.props),{onClick:e.clickHandler}),null,16,["onClick"]))],64)),e.showContainer?(u(),c(K("el-"+e.container),M({key:2,modelValue:e.showContainer,"onUpdate:modelValue":t[0]||(t[0]=i=>e.showContainer=i)},e.containerProps,{"before-close":e.beforeClose,title:e.relText}),{default:p(()=>[Z(e.$slots,"default"),e.xsubComp!==""?(u(),c(K(e.xsubComp),M({key:0},e.xsubProps,yt(e.xsubEvent)),null,16)):V("",!0)]),_:3},16,["modelValue","before-close","title"])):V("",!0)])}const ae=j(Zo,[["render",es]]),ts={splitButton:!1},as=B({name:"VButtonGroup",components:{...Ne,ArrowDown:$a,ElDialog:se,ElDrawer:st},props:{buttons:{type:Array,default:()=>[]},text:{type:String,default:"更多"},...Tt},emits:Et,setup(e,t){const a=ie().appContext.config.globalProperties,l={...ts,...e.props},o=k=>I(k,e.metaData),s=$(void 0),n=$(!1),r=U(()=>{var k;return((k=e.buttons)==null?void 0:k.length)>0?o(e.buttons[0].text||""):""}),i=$(null),d=k=>{if(k=k-1,!e.preCheck(e))return;const S=e.buttons[k],O=()=>R(S["meta-data"])?S["meta-data"]():S["meta-data"],P=()=>I(S.target||"",O());i.value=we[S.type||"base"];let L=S.extra||{};L.url===void 0&&(L.url=S.target);const ee=R(S["inject-data"])?S["inject-data"](L):S["inject-data"];L=R(S["dynamic-extra"])?S["dynamic-extra"]({...L}):L,L.method===void 0||L.method==="GET"?L.params=C.merge(L.params,ee):L.data=C.merge(L.data,ee);const le={...L},Ht=O();Object.keys(le||{}).forEach(fe=>{q(le[fe])&&(le[fe]=I(le[fe],Ht||{}))}),i.value.onclick(P,a,t,{...le,isGrup:!0},()=>{s.value=k,["modal","form","table"].indexOf(S.type)>-1&&(n.value=!0),["api"].indexOf(S.type)>-1&&t.emit("action"),R(e.buttons[k].onClick)&&e.buttons[k].onClick(k)})},f=()=>{e.beforeCloseContainer()&&(n.value=!1)},h=U(()=>{const k=e.buttons[s.value];return o(k.text||"")}),v=$({}),g=$("span"),m=$({}),w=$({});return De(()=>s.value,()=>{const k=e.buttons[s.value];v.value=It(e.container,e);const S=R(k["meta-data"])?k["meta-data"]():k["meta-data"];g.value=i.value&&i.value.getSubComp?i.value.getSubComp(k.extra||{}):"span",m.value=i.value&&i.value.getSubProps?i.value.getSubProps(k.extra,S):{},w.value=i.value&&i.value.getSubEvent?i.value.getSubEvent(k,t,n):{}}),{dropProps:l,showText:r,replaceText:o,clickHandle:d,showContainer:n,containerProps:v,beforeClose:f,xsubComp:g,xsubProps:m,xsubEvent:w,containerTitle:h,openFullScreen2:()=>{const k=nt.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});setTimeout(()=>{k.close()},2e3)}}}}),ls={class:"v-btn"};function os(e,t,a,l,o,s){const n=D("arrow-down"),r=Q,i=z,d=fa,f=ba,h=ya;return u(),y("span",ls,[b(h,M(e.dropProps,{onCommand:e.clickHandle}),{dropdown:p(()=>[b(f,null,{default:p(()=>[(u(!0),y(E,null,N(e.buttons,(v,g)=>(u(),c(d,{key:g+"button-group",command:g+1},{default:p(()=>[x(A(v.text),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:p(()=>[e.dropProps.splitButton?(u(),y(E,{key:0},[x(A(e.text),1)],64)):(u(),c(i,{key:1,type:e.dropProps.type},{default:p(()=>[x(A(e.text)+" ",1),b(r,{class:"el-icon--right"},{default:p(()=>[b(n)]),_:1})]),_:1},8,["type"]))]),_:1},16,["onCommand"]),e.showContainer?(u(),c(K("el-"+e.container),M({key:0,modelValue:e.showContainer,"onUpdate:modelValue":t[0]||(t[0]=v=>e.showContainer=v)},e.containerProps,{"before-close":e.beforeClose,title:e.containerTitle}),{default:p(()=>[(u(),c(K(e.xsubComp),M(e.xsubProps,yt(e.xsubEvent)),null,16))]),_:1},16,["modelValue","before-close","title"])):V("",!0)])}const Pt=j(as,[["render",os]]),ss=B({components:{VButton:ae,VButtonGroup:Pt},inject:{dev:{from:"dev",default:!1}},props:{buttons:{type:Array,default:()=>[]},prefixPath:{type:String,default:""}},emits:["click","action"],data(){return{localButton:[]}},watch:{buttons:{deep:!0,immediate:!0,handler(e,t){const a=[];this.$props.buttons.forEach(l=>{delete l.when,a.push(l)}),this.localButton=a}}},methods:{isArray(e){return T(e)},onclick(e){this.$emit("click",e)},onaction(e){this.$emit("action",e)}}});function ns(e,t,a,l,o,s){const n=D("v-button-group"),r=D("v-button");return u(!0),y(E,null,N(e.localButton,(i,d)=>(u(),y(E,{key:d+"v-button"},[e.isArray(i)?(u(),c(n,M({key:0,devtool:"{devId: `${prefixPath}[${index}]`, dev: dev}",ref_for:!0},{buttons:i},{onClick:e.onclick,onAction:e.onaction}),null,16,["onClick","onAction"])):(u(),c(r,M({key:1,devtool:"{devId: `${prefixPath}[${index}]`, dev: dev}",ref_for:!0},i,{onClick:e.onclick,onAction:e.onaction}),null,16,["onClick","onAction"]))],64))),128)}const Re=j(ss,[["render",ns]]);function is(e,t=!0){let a="";return C.cloneDeep(e).reverse().forEach((l,o)=>{var s;o<2&&(s=l.meta)!=null&&s.title&&(a=l.meta.title+(a&&"-"+a))}),a}class rs{constructor(){Qe(this,"SheetNames",[]),Qe(this,"Sheets",{})}}const us=e=>(+e-+new Date(Date.UTC(1899,11,30)))/(24*60*60*1e3),ds=e=>{const t={},a={s:{c:1e7,r:1e7},e:{c:0,r:0}};for(let l=0;l!==e.length;++l)for(let o=0;o!==e[l].length;++o){a.s.r>l&&(a.s.r=l),a.s.c>o&&(a.s.c=o),a.e.r<l&&(a.e.r=l),a.e.c<o&&(a.e.c=o);const s={v:e[l][o],t:"",z:""};if(s.v==null)continue;const n=ve.encode_cell({c:o,r:l});typeof s.v=="number"?s.t="n":typeof s.v=="boolean"?s.t="b":s.v instanceof Date?(s.t="n",s.z=ja.get_table()[14],s.v=us(s.v)):s.t="s",t[n]=s}return a.s.c<1e7&&(t["!ref"]=ve.encode_range(a)),t},ps=e=>{const t=new ArrayBuffer(e.length),a=new Uint8Array(t);for(let l=0;l!==e.length;++l)a[l]=e.charCodeAt(l)&255;return t},Ft=(e,t,a="excel-list",l=[],o=[],s=!0,n="xlsx")=>{t.unshift(e);for(let h=l.length-1;h>-1;h--)t.unshift(l[h]);const r="SheetJS",i=new rs,d=ds(t);if(o.length>0&&(d["!merges"]||(d["!merges"]=[]),o.forEach(h=>{d["!merges"].push(ve.decode_range(h))})),s){const h=t.map(g=>g.map(m=>m==null?{wch:10}:m.toString().charCodeAt(0)>255?{wch:m.toString().length*2}:{wch:m.toString().length})),v=h[0];for(let g=1;g<h.length;g++)for(let m=0;m<h[g].length;m++)v[m].wch<h[g][m].wch&&(v[m].wch=h[g][m].wch);d["!cols"]=v}i.SheetNames.push(r),i.Sheets[r]=d;const f=Da(i,{bookType:n,bookSST:!1,type:"binary"});Ba.saveAs(new Blob([ps(f)],{type:"application/octet-stream"}),`${a}.${n}`)},cs=B({name:"ExportAddButton",props:{getInfo:{type:Function,default:void 0}},data(){return{dialogVisible:!1,task:{page:1,size:20,total:200}}},computed:{percentage(){return(this.task.page/Math.ceil(this.task.total/this.task.size)&&1)*100}},methods:{async execute(){const e=this.$props.getInfo();this.task=Object.assign(this.task,e);let t=[];const a=[],l=[];for(e.header.forEach(o=>{a.push(o.label),l.push(o.field)}),this.dialogVisible=!0;this.task.page<=Math.ceil(this.task.total/this.task.size);){const o=Object.assign({_page:e.page||1,_size:e.size||20},e.filter||{}),{data:s}=await this.$http.request({method:"GET",url:e.listApi,params:o}),n=[];(s.list||[]).forEach(r=>{const i=[];l.forEach(d=>{i.push(r[d])}),n.push(i)}),t=s.list.concat(n),this.task.page++,this.task.total=s.page.count}Ft(a,t,e.name),this.$message.success("文件导出成功"),this.dialogVisible=!1}}});function hs(e,t,a,l,o,s){const n=z,r=va,i=se;return u(),y(E,null,[b(n,{type:"primary",onClick:e.execute},{default:p(()=>[x("导出")]),_:1},8,["onClick"]),b(i,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[0]||(t[0]=d=>e.dialogVisible=d),title:"提示",width:"30%"},{default:p(()=>[b(r,{percentage:e.percentage},null,8,["percentage"])]),_:1},8,["modelValue"])],64)}const ms=j(cs,[["render",hs]]),fs=B({__name:"emum",props:{data:{type:[String,Number,Array],default:""},column:{type:Object,default:()=>{}},row:{type:Object,default:()=>{}},scope:{type:Object,default:()=>{}},when:{type:Array,default:()=>[]}},setup(e){const t=e,{column:a,data:l}=Pa(t),o=U(()=>T(l==null?void 0:l.value)?l==null?void 0:l.value:[l==null?void 0:l.value]),s=i=>{var d,f;const h=["success","info","warning","danger"],v=(d=a.value)!=null&&d.state?(f=a.value)==null?void 0:f.state:h,g=v[i]?v[i]:i;return h.indexOf(g)>-1?g+"":""},n=i=>{var d;if(i==="")return"";const f=C.findIndex((d=a.value)==null?void 0:d.options,{value:i}),h=a.value.options?a.value.options[f]:!1;return h?h.label:i},r=U(()=>{const i=t.when;return i.length===0?!0:te({data:l==null?void 0:l.value},["data",...i])});return(i,d)=>{const f=Ve;return F(r)?(u(!0),y(E,{key:0},N(F(o).filter(h=>n(h)!==""),(h,v)=>(u(),c(f,{key:v,type:s(h)},{default:p(()=>[x(A(n(h)),1)]),_:2},1032,["type"]))),128)):V("",!0)}}}),bs={name:"CellSpan",props:{data:{type:String,default:""},row:{type:Object,default:()=>{}},scope:{type:Object,default:()=>{}}}},ys=["innerHTML"];function gs(e,t,a,l,o,s){return u(),y("span",{innerHTML:a.data},null,8,ys)}const vs=j(bs,[["render",gs]]),ws={name:"CellImage",props:{data:{type:String,default:""},column:{type:Object,default:()=>{}},row:{type:Object,default:()=>{}},scope:{type:Object,default:()=>{}}}},ks={class:"image-item"};function Vs(e,t,a,l,o,s){const n=it;return u(),y("div",ks,[a.data?(u(),c(n,{key:0,lazy:!0,class:"cell-image",src:a.data,"preview-src-list":[a.data]},null,8,["src","preview-src-list"])):V("",!0)])}const Cs=j(ws,[["render",Vs],["__scopeId","data-v-d715bbc6"]]),Ss=B({__name:"link",props:{link:{type:String,default:""},data:{type:String,default:""},column:{type:Object,default:()=>{}},row:{type:Object,default:()=>{}},scope:{type:Object,default:()=>{}},extraData:{type:Object,default:()=>{}}},setup(e){const t=e;he(()=>{});const a=U(()=>C.merge({type:"primary",href:t.data,target:"_blank"},t.column.props||{})),l=U(()=>C.merge({type:"primary",href:I(t.link,{...t.row,...t.extraData}),target:"_blank"},t.column.props||{}));return(o,s)=>{const n=sa;return e.link==""?(u(),c(n,ce(M({key:0},F(a))),{default:p(()=>[x(A(e.column.label),1)]),_:1},16)):(u(),c(n,ce(M({key:1},F(l))),{default:p(()=>[x(A(e.data),1)]),_:1},16))}}}),_s={name:"JsonView",props:{data:{type:[Object,Array],required:!0},jsonKey:{type:String,default:""},closed:{type:Boolean,default:!1},isLast:{type:Boolean,default:!0},fontSize:{type:Number,default:14},lineHeight:{type:Number,default:24},deep:{type:Number,default:3},currentDeep:{type:Number,default:1},iconStyle:{type:String,default:"circle"},iconColor:{type:Array,default(){return[]}},theme:{type:String,default:""},hasSiblings:{type:Boolean,default:!0},tools:{type:Boolean,default:!0}},data(){return{innerclosed:this.closed,templateDeep:this.currentDeep,visible:!1}},computed:{isArray(){return this.getDataType(this.data)==="array"},length(){return this.isArray?this.data.length:Object.keys(this.data).length},subfix(){const e=this.data;return this.isEmptyArrayOrObject(e)?"":(this.isArray?"]":"}")+(this.isLast?"":",")},prefix(){return this.isArray?"[":"{"},items(){const e=this.data;return this.isArray?e.map(t=>{const a=this.isObjectOrArray(t);return{value:t,isJSON:a,key:""}}):Object.keys(e).map(t=>{const a=e[t],l=this.isObjectOrArray(a);return{value:a,isJSON:l,key:t}})},iconColors(){const{theme:e,iconColor:t}=this;return t.length===2?t:e==="one-dark"?["#747983","#747983"]:e==="vs-code"?["#c6c6c6","#c6c6c6"]:["#747983","#747983"]}},watch:{closed(){this.innerclosed=this.closed}},mounted(){setTimeout(()=>{this.visible=!0},0)},methods:{getDataType(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()},isObjectOrArray(e){return["array","object"].includes(this.getDataType(e))},toggleClose(){this.length!==0&&(this.innerclosed=!this.innerclosed)},isClose(){return this.templateDeep+1>this.deep},isEmptyArrayOrObject(e){return[{},[]].map(t=>JSON.stringify(t)).includes(JSON.stringify(e))},copy(){et(JSON.stringify(this.data,null,2))}}},$s={key:0,class:"json-view-tool"},xs={class:"content-wrap"},Os={key:0,class:"json-key"},As={key:1},Bs={class:"json-note"},Ds={key:2},js={key:0,class:"json-body"},Es={key:1,class:"json-item"},Ts={class:"json-key"},Is={key:0,class:"base-line"},Ps={key:1,class:"last-line"};function Fs(e,t,a,l,o,s){const n=ne,r=D("json-view");return u(),y(E,null,[a.tools?(u(),y("div",$s,[b(n,{content:"复制"},{default:p(()=>[_("i",{class:"el-icon-copy-document",onClick:t[0]||(t[0]=(...i)=>s.copy&&s.copy(...i))})]),_:1})])):V("",!0),o.visible?(u(),y("div",{key:1,class:H(["json-view-container",a.theme,`deep-${a.currentDeep}`])},[_("div",{class:H(["json-view",s.length?"closeable":""]),style:Te({fontSize:a.fontSize+"px",lineHeight:a.lineHeight+"px"})},[s.length&&a.iconStyle==="square"?(u(),y("span",{key:0,class:"angle",onClick:t[1]||(t[1]=(...i)=>s.toggleClose&&s.toggleClose(...i))},[_("i",{class:H("el-icon-"+(o.innerclosed?"plus":"minus"))},null,2)])):V("",!0),s.length&&a.iconStyle==="circle"?(u(),y("span",{key:1,class:"angle",onClick:t[2]||(t[2]=(...i)=>s.toggleClose&&s.toggleClose(...i))},[_("i",{class:H("el-icon-"+(o.innerclosed?"circle-plus-outline":"remove-outline"))},null,2)])):V("",!0),s.length&&a.iconStyle==="triangle"?(u(),y("span",{key:2,class:"angle",onClick:t[3]||(t[3]=(...i)=>s.toggleClose&&s.toggleClose(...i))},[_("i",{class:H("el-icon-"+(o.innerclosed?"caret-right":"el-icon-caret-bottom"))},null,2)])):V("",!0),_("div",xs,[_("p",{class:H(["first-line",s.length>0?"pointer":""]),onClick:t[4]||(t[4]=(...i)=>s.toggleClose&&s.toggleClose(...i))},[a.jsonKey?(u(),y("span",Os,'"'+A(a.jsonKey)+'": ',1)):V("",!0),s.length?(u(),y("span",As,[x(A(s.prefix)+A(o.innerclosed?"..."+s.subfix:"")+" ",1),_("span",Bs,A(o.innerclosed?s.length+" items":""),1)])):V("",!0),x(),s.length?V("",!0):(u(),y("span",Ds,A(`${s.isArray?"[]":"{}"}${a.isLast?"":","}`),1))],2),!o.innerclosed&&s.length?(u(),y("div",js,[(u(!0),y(E,null,N(s.items,(i,d)=>(u(),y(E,{key:d},[i.isJSON?(u(),c(r,{key:0,closed:s.isClose(),data:i.value,"json-key":i.key,"current-deep":o.templateDeep+1,deep:a.deep,"icon-style":a.iconStyle,theme:a.theme,"font-size":a.fontSize,"line-height":a.lineHeight,"icon-color":s.iconColors,"is-last":d===s.items.length-1,"has-siblings":i.hasSiblings,tools:!1},null,8,["closed","data","json-key","current-deep","deep","icon-style","theme","font-size","line-height","icon-color","is-last","has-siblings"])):(u(),y("p",Es,[_("span",Ts,A(s.isArray?"":'"'+i.key+'":'),1),_("span",{class:H(["json-value",s.getDataType(i.value)])},A(`${s.getDataType(i.value)==="string"?'"':""}${i.value}${s.getDataType(i.value)==="string"?'"':""}${d===s.items.length-1?"":","}`),3)]))],64))),128)),o.innerclosed?V("",!0):(u(),y("span",Is))])):V("",!0),o.innerclosed?V("",!0):(u(),y("p",Ps,[_("span",null,A(s.subfix),1)]))])],6)],2)):V("",!0)],64)}const Lt=j(_s,[["render",Fs],["__scopeId","data-v-f41f94ce"]]),Ls=B({__name:"json",props:{data:{type:[Object,String,Array],default:()=>{}},column:{type:Object,default:()=>{}},row:{type:Object,default:()=>{}},scope:{type:Object,default:()=>{}}},setup(e){const t=e,a=U(()=>q(t.data)?JSON.parse(t.data):t.data);return(l,o)=>(u(),c(ae,{type:"modal",text:"查看"},{default:p(()=>[b(Lt,{data:F(a)},null,8,["data"])]),_:1}))}}),Ms=B({__name:"span",props:{data:{type:[String,Number,Array,Object],default:""},column:{type:Object,default:()=>{}},row:{type:Object,default:()=>{}},render:{type:String,default:""},scope:{type:Object,default:()=>{}}},setup(e){const t=e,a=U(()=>t.render?new Function("return "+t.render)()(t.data,t.row):t.data);return(l,o)=>(u(),y("span",null,A(F(a)),1))}}),Ns={name:"CellRichText",functional:!0,props:{data:{type:[String,Number,Array],default:""},row:{type:Object,default:()=>{}}},setup(e){let t=e.data;const a=function(o){const s=/<([\s\S]*?)>/g;let n=s.exec(o);const r=[];for(;n!=null;)r.push(RegExp.$1),n=s.exec(o);return r};(typeof t=="string"||typeof t=="number")&&(t=[t]);const l=[];for(let o=0;o<t.length;o++){const s=a(t[o]),n={};let r=t[o];for(let i=0;i<s.length;i++){const d=r.split("<"+s[i]+">");l.push(b("span",null,[d[0]]));const f=s[i].split("|");let h={color:void 0,background:void 0};f[1]!==void 0&&(h.color=f[1]),f[2]!==void 0&&(h.background=f[2]),h=Object.assign({},n,h),l.push(b("span",{class:"el-tag el-tag--mini",style:h},[f[0]])),r=d[1]}l.push(b("span",null,[r])),o<t.length-1&&l.push(b("br",null,null))}return()=>b("div",null,[l])}},Rs=B({__name:"icon",props:{data:{},row:{},scope:{}},setup(e){return(t,a)=>{const l=D("v-icon");return u(),c(l,{name:t.data},null,8,["name"])}}}),Hs={key:0},Us=["innerHTML"],zs=B({__name:"tpl",props:{data:{type:[String,Number,Array,Object],default:""},column:{type:Object,default:()=>{}},row:{type:Object,default:()=>{}},tpl:{type:String,default:""},interval:{type:Number,default:0},api:{type:Object,default:void 0},scope:{type:Object,default:()=>{}},extraData:{type:Object,default:()=>{}}},setup(e){const{$http:t}=Ie(),a=e,l=$("");let o;const s=$(!1);return he(()=>{if(l.value=I(a.tpl,{...a.row,...a.extraData}),a.api===void 0)return;const n={url:"",method:"GET",...a.api,data:a.row};n.url=I(n.url,{...a.row,...a.extraData});const r=()=>{s.value=!0,t==null||t.request(n).then(i=>{l.value=I(a.tpl,{...i.data,...a.extraData,resp:i.data}),n.url,a.tpl,{...i.data,...a.extraData,resp:i.data},s.value=!1}).catch(i=>{s.value=!1})};r(),a.interval>0&&(o=setInterval(r,a.interval))}),Ta(()=>{clearInterval(o)}),(n,r)=>{const i=Q;return F(s)?(u(),y("span",Hs,[b(i,{class:"is-loading"},{default:p(()=>[b(F(Ca))]),_:1})])):(u(),y("span",{key:1,innerHTML:F(l)},null,8,Us))}}}),qs={__name:"view",props:{fields:{type:Array,default:()=>[]},column:{type:Object,default:()=>{}},row:{type:Object,default:()=>{}},scope:{type:Object,default:()=>{}}},setup(e){const t=e,a=U(()=>{var l,o;if(((l=t.fields)==null?void 0:l.length)===0)return t.row;const s={};return(o=t.fields)==null||o.forEach(n=>{s[n]=t.row[n]}),s});return(l,o)=>(u(),c(ae,{type:"modal",text:"查看"},{default:p(()=>[b(Lt,{data:F(a)},null,8,["data"])]),_:1}))}},Ks=qs,Ys={name:"VChart",props:{options:{type:Object,default:()=>{}}},setup(e){const t=$(null),a=null;Be(()=>{l()});const l=ta(()=>a.value.resize(),200);return bt(()=>{window.removeEventListener("resize",l)}),{chartDom:t,chart:a}}},Gs={ref:"chartDom",class:"chart",style:{height:"100%",width:"100%"}};function Ws(e,t,a,l,o,s){return u(),y("div",Gs,null,512)}const Js=j(Ys,[["render",Ws]]),Qs=B({__name:"chart",props:{data:{type:Array,default:()=>[]},column:{type:Object,default:()=>{}},scope:{type:Object,default:()=>{}},options:{type:Object,default:()=>{}},noDataText:{type:String,default:"暂无数据"},row:{type:Object,default:()=>{}}},setup(e){const t=e,a={title:{text:""},tooltip:{trigger:"axis"},grid:{left:"2%",right:"2%",bottom:"5%",containLabel:!0},xAxis:{type:"category",data:[]},yAxis:{type:"value"}},l=U(()=>{var o;const s=C.cloneDeep(C.merge({series:[]},t.options,a));return(o=t.data)==null||o.forEach(n=>{s.xAxis.data.push(n[0]),n.forEach((r,i)=>{i>0&&(s.series[i-1].data=s.series[i-1].data||[],s.series[i-1].data.push(r))})}),s});return(o,s)=>{const n=Y,r=G;return t.data.length>0?(u(),c(ae,{key:0,type:"modal",text:"查看"},{default:p(()=>[b(r,null,{default:p(()=>[b(n,null,{default:p(()=>[b(Js,{options:F(l)},null,8,["options"])]),_:1})]),_:1})]),_:1})):V("",!0)}}}),Zs=B({name:"VPlayer",props:{playurl:{type:String,default:""},playApi:{type:String,default:""}},data(){return{loading:!1,localPlayUrl:this.$props.playurl}},beforeCreate(){this.$props.playApi&&this.$http.request({url:this.$props.playApi}).then(({data:e})=>{this.localPlayUrl=e.playurl})}}),Xs=["src"];function en(e,t,a,l,o,s){return e.localPlayUrl?(u(),y("video",{key:e.localPlayUrl,src:e.localPlayUrl,controls:"controls",preload:"",autoplay:"autoplay",style:{width:"100%",height:"500px"}},null,8,Xs)):V("",!0)}const Mt=j(Zs,[["render",en]]),tn=Object.freeze(Object.defineProperty({__proto__:null,default:Mt},Symbol.toStringTag,{value:"Module"})),an={name:"CellPlayer",components:{VPlayer:Mt},props:{data:{type:String,default:""},column:{type:Object,default:()=>{}},row:{type:Object,default:()=>{}},scope:{type:Object,default:()=>{}}}},ln={class:"image-item"};function on(e,t,a,l,o,s){const n=D("v-player");return u(),y("div",ln,[b(n,{playurl:a.data},null,8,["playurl"])])}const sn=j(an,[["render",on]]),nn={key:1},rn={inheritAttrs:!1},un=B({...rn,__name:"sortIndex",props:{data:{type:String,default:""},column:{type:Object,default:()=>{}},row:{type:Object,default:()=>{}},ctrl:{type:Boolean,default:!1},scope:{type:Object,default:()=>{}}},emits:["sortIndexChange"],setup(e,{emit:t}){const a=e,l=$(a.scope.$index+1),o=$(!1),s=t,n=()=>{new Date().getTime(),s("sortIndexChange",{from:a.scope.$index,to:l.value-1}),o.value=!1};return(r,i)=>{const d=Y,f=z,h=G;return F(o)?(u(),y("span",nn,[b(h,{gutter:10},{default:p(()=>[b(d,{span:18},{default:p(()=>[b(xt,{modelValue:F(l),"onUpdate:modelValue":i[1]||(i[1]=v=>re(l)?l.value=v:null),props:{controls:!1},style:{width:"auto"}},null,8,["modelValue"])]),_:1}),b(d,{span:6},{default:p(()=>[b(f,{icon:F(Sa),type:"success",circle:"",onClick:n},null,8,["icon"])]),_:1})]),_:1})])):(u(),y("span",{key:0,style:{display:"inline-block",width:"100%"},onClick:i[0]||(i[0]=v=>o.value=!F(o))},A(F(l)),1))}}}),dn=Object.freeze(Object.defineProperty({__proto__:null,CellChart:Qs,CellEnum:fs,CellHtml:vs,CellIcon:Rs,CellImage:Cs,CellJson:Ls,CellLink:Ss,CellPlayer:sn,CellRichText:Ns,CellSortIndex:un,CellSpan:Ms,CellTpl:zs,CellView:Ks},Symbol.toStringTag,{value:"Module"})),pn=B({name:"CellEdit",components:{...ue,VButton:ae},provide(){return{formData:{}}},props:{modelValue:{type:[String,Number,Array,Object],default:void 0},item:{type:Object,default:()=>{}},modal:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],data(){return{localValue:this.$props.modelValue}},methods:{onFiledChange(e){this.$emit("update:modelValue",e)},getComponentName(e){return Fe(e)},getComponentProps(e){return Le(e,{disabled:this.disabled})}}});function cn(e,t,a,l,o,s){const n=D("VButton"),r=xe;return u(),c(r,null,{default:p(()=>[e.modal?(u(),c(n,{key:0,type:"modal",text:"查看"},{default:p(()=>[(u(),c(K(e.getComponentName(e.item.type)),M({modelValue:e.localValue,"onUpdate:modelValue":t[0]||(t[0]=i=>e.localValue=i)},e.getComponentProps(e.item),{"onUpdate:modelValue":e.onFiledChange}),null,16,["modelValue","onUpdate:modelValue"]))]),_:1})):(u(),c(K(e.getComponentName(e.item.type)),M({key:1,modelValue:e.localValue,"onUpdate:modelValue":t[1]||(t[1]=i=>e.localValue=i)},e.getComponentProps(e.item),{"onUpdate:modelValue":e.onFiledChange}),null,16,["modelValue","onUpdate:modelValue"]))]),_:1})}const hn=j(pn,[["render",cn]]),mn=B({name:"TableStyle",components:{VButton:Re,CellEdit:hn,Warning:ct,...dn},inject:["dev"],props:{headers:{type:Array,default:e=>[]},dataList:{type:Array,default:e=>[]},props:{type:Object,default:e=>{}},selection:{type:Boolean,default:!1},cellType:{type:Function,default:()=>{}},cellProps:{type:Function,default:()=>{}},cellEvent:{type:Function,default:()=>{}},rowButton:{type:Array,default:e=>[]},makeRowButton:{type:Function,default:()=>{}},loadChildren:{type:Function,default:()=>{}},dragSort:{type:Boolean,default:!1},localSortHandler:{type:Function,default:()=>{}},showRowButton:{type:Boolean,default:!0}},emits:["select-change","sort-change","cell-change","btn-action","mounted","drag-sort"],setup(e,{emit:t}){Be(()=>{e.dragSort&&h()});const a=$(0),l=U(()=>{var g,m;if(e.rowButton.length===1)return;let w=0;for(let k=0;k<((g=e.rowButton)==null?void 0:g.length);k++){const S=e.rowButton[k];if(S.ignoreWith!==!0)if(S.type==="group")w+=98;else{const O=S.width||1;w+=(S.text?(m=S==null?void 0:S.props)!=null&&m.icon?90:78:65)*O}}return w}),o=g=>{t("select-change",g)},s=g=>{t("sort-change",g)},n=g=>({sortable:g.sortable?"custom":!1,...g.props}),r=(g,m,w)=>{t("cell-change",{index:g,field:m,value:w})},i=g=>{t("btn-action",g),f.value++},d=$(null),f=$(0),h=()=>{const g=document.querySelector(".el-table__body-wrapper tbody");Ea.create(g,{onEnd(m){t("drag-sort",m)}})},v=$([]);return{rowKey:a,actionWidth:l,handleSelectionChange:o,sortTable:s,getColumnProps:n,cellChange:r,btnAction:i,tabledom:d,rowAction:f,indexs:v,rowClassName:({row:g,rowIndex:m})=>`table-tr-${m}`}}}),fn={devtool:"{devId: `headers[${index}]`, dev: dev, parent: 2}"},bn=["innerHTML"];function yn(e,t,a,l,o,s){const n=wa,r=D("warning"),i=Q,d=ne,f=D("cell-edit"),h=D("v-button"),v=ka,g=Va;return u(),c(g,M({id:"table",ref:"tabledome",data:e.dataList,load:e.loadChildren,style:{width:"100%"}},e.props,{"header-cell-style":{background:"#eef1f6",color:"#606266"},"row-class-name":e.rowClassName,onSelectionChange:e.handleSelectionChange,onSortChange:e.sortTable}),{empty:p(()=>[x(A(e.props.emptyText||"没有数据"),1)]),default:p(()=>[e.selection?(u(),c(n,{key:0,type:"selection"})):V("",!0),(u(!0),y(E,null,N(e.headers.filter(m=>m.type!=="hidden"),(m,w)=>(u(),c(n,M({key:w+"-table-column",prop:m.field,ref_for:!0},e.getColumnProps(m)),{header:p(()=>[_("span",fn,[x(A(m.label||m.field)+" ",1),m.info?(u(),c(d,{key:0,effect:"dark",placement:"top-start"},{content:p(()=>[_("span",{innerHTML:m.info},null,8,bn)]),default:p(()=>[b(i,null,{default:p(()=>[b(r)]),_:1})]),_:2},1024)):V("",!0)])]),default:p(k=>[m.edit?(u(),c(f,M({key:`${w}-${e.rowKey}`,modelValue:k.row[k.column.property],"onUpdate:modelValue":S=>k.row[k.column.property]=S,ref_for:!0},{item:m,disabled:m.props&&m.props.disabled},{"onUpdate:modelValue":S=>e.cellChange(k.index_,m.field,S)}),null,16,["modelValue","onUpdate:modelValue"])):(u(),c(K(e.cellType(m)),M({key:1,ref_for:!0},e.cellProps(m,k)),null,16))]),_:2},1040,["prop"]))),128)),e.showRowButton&&e.rowButton.length>0?(u(),c(n,{key:1,label:"操作",fixed:"right",width:e.actionWidth},{default:p(m=>[(u(),c(h,{key:e.rowAction+"-"+m.$index,buttons:e.makeRowButton(e.rowButton,m.row,m.$index),"prefix-path":"rowButton",onAction:e.btnAction},null,8,["buttons","onAction"]))]),_:1},8,["width"])):V("",!0),b(v)]),_:1},16,["data","load","row-class-name","onSelectionChange","onSortChange"])}const gn=j(mn,[["render",yn]]),ge=mt,vn=B({name:"VIcon",props:{name:{type:String,required:!0}},setup(e){const t=()=>null;if(e.name===void 0)return t;if(e.name.indexOf("el-")===0){const a=Xe(e.name.replace("el-icon-",""),"-"),l=ge[a];if(!l)return t;const o={height:"1em",width:"1em"};return()=>b(l,{style:o},null)}if(ge[e.name]){const a=ge[e.name],l={height:"1em",width:"1em"};return()=>b(a,{style:l},null)}return e.name.indexOf("ra-")===0?()=>b("i",{class:"iconfont "+e.name},null):t}}),wn=B({name:"VTable",components:{VIcon:vn,VForm:Me,VButton:Re,ExportAddButton:ms,TableStyle:gn},provide(){return{dev:this.dev}},inheritAttrs:!1,props:{dev:{type:Boolean,default:!1},headers:{type:Array,default:()=>[]},list:{type:Array,default:()=>[]},listApi:{type:String,default:""},infoApi:{type:String,default:""},schemaHandle:{type:Function,default:e=>e},filter:{type:Array,default:()=>[]},batchButton:{type:Array,default:()=>[]},normalButton:{type:Array,default:()=>[]},rowButton:{type:Array,default:()=>[]},showPagination:{type:Boolean,default:!0},showNormalButton:{type:Boolean,default:!0},showBatchButton:{type:Boolean,default:!0},showRowButton:{type:Boolean,default:!0},showFilter:{type:Boolean,default:!0},showSelection:{type:Boolean,default:void 0},selectedNotice:{type:[String,Object],default:""},listIncrease:{type:[Boolean,Object],default:!1},tableProps:{type:Object,default:e=>{}},exportAble:{type:Boolean,default:!1},exportCurrentPageAble:{type:Boolean,default:!1},tabs:{type:Array,default:e=>[]},rowHandler:{type:Function,default:(e,t)=>e},dragSort:{type:[Object,String,Boolean],default:()=>""},syncUrl:{type:Boolean,default:!0}},emits:["cell-change","unshiftList","deleteList","updateList","topList","dragSort","selection"],data(){var e,t;const a={border:!0,stripe:!0,size:"default",rowKey:"id",lazy:!0,defaultExpandAll:!1,expandRowKeys:[1]};let l="";this.$props.tabs.length>0&&(l=this.$props.tabs[0].value),this.$route&&this.$route.query.tab&&(l=this.$route.query.tab);const o=Ue.get("table_filter:"+((e=this.$route)==null?void 0:e.path)),s=Object.assign({},this.$route?this.$route.query:{},o,this.queryParams());Object.keys(s).forEach(i=>{i.indexOf("[]")>-1&&(s[i.replace("[]","")]=s[i],delete s[i])});let n=!1;q(this.$props.dragSort)&&this.$props.dragSort&&(n=!0),J(this.$props.dragSort)&&this.$props.dragSort.sortApi&&(n=!0),pe(this.$props.dragSort)&&(n=this.$props.dragSort);const r={...this.$props.tableProps};return r.rowKey==="__random__"&&(r.rowKey=()=>new Date().getTime()+Math.random()),s._sort_by!==void 0&&(r.defaultSort={prop:s._sort_by,order:s._sort_type==="desc"?"descending":"ascending"}),{rowKey:0,formKey:0,tableKey:0,tableDefaultProps:a,filterFormOptions:{inline:!0,labelPosition:"right",labelWidth:0,submitButton:{innerHTML:"查询"},cancelButton:{innerHTML:"重置"}},tableNormalButton:this.$props.normalButton,tableBatchButton:this.$props.batchButton,tableRowButton:this.$props.rowButton,tableHeaders:this.$props.headers.filter(i=>i).filter(i=>i.hidden!==!0),tableFilter:this.$props.filter,tableList:this.$props.list,tableSelectedNotice:this.$props.selectedNotice,tableShowPagination:this.$props.showPagination,tableTableProps:Object.assign({},a,r),selectionRows:[],tableExportAble:this.$props.exportAble,tableExportCurrentPageAble:this.$props.exportCurrentPageAble,tableTabs:this.$props.tabs,tableListApi:this.$props.listApi,dragSortEnable:n,tablePage:Object.assign({ps:s._ps?parseInt(s._ps):20,sizes:[20,100,200],pn:s._pn?parseInt(s._pn):1,total:0},((t=this.$props.tableProps)==null?void 0:t.page)||{}),paginationKey:0,filterForm:this.$props.syncUrl?s:{},loading:!1,sort:null,activeTab:l+"",exporting:!1}},computed:{enableSelection(){return this.showSelection===!0?!0:this.tableBatchButton.length!==0},batchButtonCol(){if(this.tableBatchButton.length===0&&this.tableNormalButton.length===0)return 0;const e=this.tableBatchButton.length;let t=this.tableBatchButton.length+this.tableNormalButton.length;return this.$props.exportCurrentPageAble&&(t+=1),Math.round(e/t*24)},showFilterCard(){return this.tableFilter.length>0},actionWidth(){if(this.tableRowButton.length===1)return;let e=0;return this.tableRowButton.forEach(t=>{e+=t.text?73:60}),e},listIncreaseConf(){return pe(this.$props.listIncrease)?this.$props.listIncrease===!1?{state:!1}:{state:!0,type:"append",location:"beforeList"}:this.$props.listIncrease},selectedInfoPosition(){return J(this.tableSelectedNotice)?this.tableSelectedNotice.position:"beforePagination"},selectedInfo(){const e={selectedCount:this.selectionRows.length},t=J(this.tableSelectedNotice)?this.tableSelectedNotice.text:this.tableSelectedNotice,a=t.match(/{([\s\S]*?)}/g);if(!a)return t;const l=a.map(s=>s.replace("{","").replace("}","")),o=this.tableHeaders.map(s=>s.field);for(const s in l){const n=l[s].split("|");if(n.length===1||o.indexOf(n[0])===-1)continue;const r=this.selectionRows.map(i=>i[n[0]]);e[l[s]]=Qt.execute(r,n.slice(1))}return I(t,e)}},beforeCreate(){this.$props.infoApi&&this.$http.request({method:"GET",url:this.$props.infoApi}).then(({data:e})=>{e=this.$props.schemaHandle(e),Object.keys(e).forEach(a=>{a==="tableProps"?this["table"+ze(a)]=Object.assign({},this.tableDefaultProps,e[a]):this["table"+ze(a)]=e[a]});let t="";this.tableTabs.length>0&&(t=this.tableTabs[0].value),this.$route&&this.$route.query.tab&&(t=this.$route.query.tab),this.activeTab=t+"",this.load()})},mounted(){this.$nextTick(()=>{!this.$props.infoApi&&this.load()})},methods:{changeTab(e,t){this.activeTab=this.tableTabs[e.index].value+"",e.index,this.load()},resetFilter(){const e=this.queryParams();Object.keys(this.filterForm).forEach(t=>{delete e[t],delete e[t+"[]"]}),qe(e),this.filterForm={},this.formKey++,this.filterForm,this.load()},cellType(e){let t=e.type||"span";return t=t==="input"?"span":t,`cell-${t}`},cellProps(e,t){let a={data:C.get(t.row,t.column.property),column:e,scope:t};return this.cellType(e)==="cell-sort-index"&&(a.onSortIndexChange=({from:l,to:o})=>{var s;if(l!==o&&((s=this.tableList)==null?void 0:s.length)>0){o>this.tableList.length-1&&(o=this.tableList.length-1),o<=0&&(o=0);const n=this.tableList.splice(l,1)[0];this.tableList.splice(o,0,n),this.tableKey++,setTimeout(()=>{const r=document.getElementsByClassName(`table-tr-${o}`)[0];r.classList.forEach(i=>{}),(o+1)%2===0&&r.classList.toggle("el-table__row--striped"),r.classList.add("table-highlight"),ke("table-highlight"),setTimeout(()=>{r.classList.remove(["table-highlight"]),(o+1)%2===0&&r.classList.toggle("el-table__row--striped")},2e3)},60)}}),a.row=t.row,e.type==="tpl"&&(a.tpl=e.tpl||""),e.cellProps!==void 0&&(a=Object.assign(a,e.cellProps)),a},getAvailableFilter(){var e;const t={};return Object.keys(this.filterForm).length===0&&((e=this.tableFilter)==null||e.forEach(a=>{a.value!==void 0&&(t[a.field]=Ot(a))})),Object.keys(this.filterForm).map(a=>{this.filterForm[a]!==""&&this.filterForm[a]!==void 0&&(t[a]=this.filterForm[a])}),t},searchAction(){const e=this.getAvailableFilter();if(Object.keys(e).length===0){this.$message({message:"请填写筛选条件",type:"warning"});return}this.load({resetPage:!0})},load(e={},t={}){var a;if(!this.tableListApi)return;this.loading=!0,e.resetPage!==void 0&&e.resetPage!==!1&&(this.tablePage.pn=1);const l=this.getAvailableFilter(),o=this.showPagination?{_pn:this.tablePage.pn,_ps:this.tablePage.ps}:{},s=Object.assign({},l,o,this.sort,t,this.$route?this.$route.params:{}),n=(a=C.cloneDeep(this.tableTabs))==null?void 0:a.map(r=>(r.value=r.value+"",r));if(this.activeTab){const r=C.findIndex(n,{value:this.activeTab});this.activeTab,r>-1&&(s[this.tableTabs[r].field]=this.activeTab)}this.syncParamsToUrl(s),this.$http.request({type:"GET",url:this.tableListApi,params:s}).then(({data:r})=>(this.tableList=(r.list||[]).map(this.rowHandler),this.tablePage=Object.assign(this.tablePage,r.page||{}),this.loading=!1,this.tableKey++,s))},syncParamsToUrl(e){if(!this.syncUrl)return;C.cloneDeep(this.queryParams()),C.cloneDeep(e);const t=C.merge({},C.cloneDeep(e)),a={_pn:1,_ps:20};Object.keys(a).forEach(l=>{t[l]===a[l]&&delete t[l]}),Ue.set("table_filter:"+this.$route.path,t,86400*7),qe(t)},handleSelectionChange(e){this.selectionRows=e,this.$emit("selection",e)},batchButtonPreCheck(){return this.selectionRows.length===0?(this.$message({message:"请勾选相应记录",type:"warning"}),!1):!0},batchMetaData(e){const t=[];return this.selectionRows.forEach(a=>{a.id!==void 0&&t.push(a.id)}),{ids:t,_selection:this.selectionRows,_query:this.queryParams()}},batchDynamicExtra(e){const t=[],a={};if(e&&e.batchApiParamsKey&&e.batchApiParamsKey.forEach(s=>{a[s]=[]}),this.selectionRows.forEach(s=>{s.id!==void 0&&t.push(s.id),Object.keys(a).forEach(n=>{s[n]!==void 0&&a[n].push(s[n])})}),t.length===0)return this.$message({message:"列表记录缺少主键 id",type:"warning"}),{};const l=t.join(","),o={id:l,ids:l};return Object.keys(a).forEach(s=>{o[s]=a[s].join(",")}),e=e||{},e.data=e.data||{},e.data._selected=this.selectionRows,e.url!==void 0&&(e.params=e.params||{},Object.keys(a).forEach(s=>{e.params[s]=a[s].join(",")}),e.url.indexOf("{id}")===-1&&(e.params.id=l),Zt(e.url)&&(e.url=I(e.url,o))),e},batchBtnAction(){this.load()},pssChange(e){this.tablePage.pn=1,this.tablePage.ps=e,this.paginationKey+=1,this.load()},pnChange(e){if(e-this.tablePage.pn>100){this.$message({message:"禁止大跨度翻页",type:"error"}),this.paginationKey+=1;return}this.tablePage.pn=e,this.load({resetPage:!1})},isArray(e){return T(e)},makeBatchButton(e){return e.map(t=>{var a,l;if(T(t))t=this.makeBatchButton(t);else if(t["pre-check"]=this.batchButtonPreCheck,t["dynamic-extra"]=this.batchDynamicExtra,t["meta-data"]=this.batchMetaData,(a=t==null?void 0:t.extra)!=null&&a.actionHandler)switch((l=t==null?void 0:t.extra)==null?void 0:l.actionHandler){case"@topList":t.extra.actionHandler=()=>{this.moveSelectedToTop()};break;case"@deleteList":t.extra.actionHandler=()=>{this.deleteSelected()};break}return t})},queryParams(){return tt(location.hash)},queryString(){const e=location.hash.indexOf("?");return e===-1?"":location.hash.substring(e+1)},makeNormalButton(e){const t=this.queryParams();return e.filter(a=>{if(a.when){let l=a.when;return T(a.when[0])||(l=[a.when]),te(t,l)}return!0}).map(a=>{var l,o,s;if(T(a))a=this.makeNormalButton(a);else if(a["meta-data"]=()=>({...this.queryParams(),_query:this.queryString(),tableList:this.tableList}),((l=a==null?void 0:a.extra)==null?void 0:l.initQueryParams)===!1&&(a["meta-data"]={}),(o=a==null?void 0:a.extra)!=null&&o.actionHandler)switch((s=a==null?void 0:a.extra)==null?void 0:s.actionHandler){case"@unshiftList":a.extra.actionHandler=n=>{var r,i;const d=R((r=a.extra)==null?void 0:r.parseFormData)?a.extra.parseFormData(n):n;d&&((i=this.tableList)==null||i.unshift(d),this.$emit("unshiftList",n))};break}return a})},fullPath(){return{route_full_path:encodeURIComponent(location.hash.replace("#",""))}},makeRowButton(e,t,a){const l=[];return C.cloneDeep(e.filter(o=>!!o)).forEach(o=>{o.type==="group"?l.push(o.subButton):l.push(o)}),l.filter(o=>{if(o.when){let s=o.when;return T(o.when[0])||(s=[o.when]),te(t,s)}return!0}).map(o=>{var s,n,r;if(T(o))o=this.makeRowButton(o,t);else{const i=o.metaData||{};if(o["inject-data"]=()=>C.merge(this.queryParams(),i),o["meta-data"]=()=>{const d=this.fullPath();return{...this.queryParams(),...t,...d,...i}},((s=o==null?void 0:o.extra)==null?void 0:s.initQueryParams)===!1&&(o["meta-data"]={...t,...i}),(n=o==null?void 0:o.extra)!=null&&n.actionHandler)switch((r=o==null?void 0:o.extra)==null?void 0:r.actionHandler){case"@updateList":o.extra.actionHandler=d=>{this.tableList[a]=C.merge(this.tableList[a],d),this.$emit("updateList",d,a)};break;case"@deleteList":o.extra.actionHandler=()=>{this.tableList.splice(a,1),this.$emit("deleteList",a)};break;case"@unshiftList":o.extra.actionHandler=d=>{var f;(f=this.tableList)==null||f.unshift(d),this.$emit("unshiftList",d,a)};break;case"@topList":o.extra.actionHandler=d=>{this.moveItemToTop(a),this.$emit("topList",d,a)};break}}return o})},moveItemToTop(e){var t;const a=(t=this.tableList)==null?void 0:t.splice(e,1);this.tableList.unshift(a[0])},moveSelectedToTop(){for(let e=0;e<this.selectionRows.length;e++){const t=this.selectionRows[e],a=this.tableList.findIndex(l=>l.id===t.id);a>-1&&this.moveItemToTop(a)}},deleteSelected(){var e;for(let t=0;t<this.selectionRows.length;t++){const a=this.selectionRows[t],l=this.tableList.findIndex(o=>o.id===a.id);l>-1&&((e=this.tableList)==null||e.splice(l,1))}},listIncreaseRecord(){const e={};Object.keys(this.tableHeaders).forEach(t=>{e[t.field]=void 0}),this.listIncreaseConf.type==="append"?this.tableList.push(e):this.listIncreaseConf.type==="unshift"?this.tableList.unshift(e):console.warn("unknown listIncrease type"),this.rowKey++},cellChange(e,t,a){this.$emit("cell-change",{index:e,field:t,value:a})},getColumnProps(e){return{sortable:e.sortable?"custom":!1}},sortTable({column:e,order:t,prop:a}){if(!(t&&a)){this.sort=null;return}this.sort={_sort_by:a,_sort_type:t==="descending"?"desc":"asc"};const l={prop:a,order:t},o=this.tableTableProps.defaultSort;JSON.stringify(o)!==JSON.stringify(l)&&(this.tableTableProps.defaultSort=l,this.load())},loadChildren(e,t,a){this.$http.request({type:"GET",url:this.tableListApi.replace("/list","/children"),params:{pid:e.id}}).then(({data:l})=>{a(l||[])})},btnAction(){this.load()},getExportInfo(){return{listApi:this.tableListApi,params:this.filterForm,header:C.cloneDeep(this.tableHeaders),name:is(this.$route?this.$route.matched:[],!1)}},exportCurrentTable(){this.exporting=!0;const e=[],t=[],a={};this.tableHeaders.forEach(s=>{e.push(s.label),a[s.field]=s,t.push(s.field)});const l=[];(this.tableList||[]).forEach(s=>{const n=[];t.forEach(r=>{let i=s[r];if(i===void 0){n.push("");return}const d=a[r];switch(d.type){case"enum":{const f=C.findIndex(d.options,{value:i}),h=d.options?d.options[f]:!1;i=h?h.label:i;break}}n.push(i)}),l.push(n)});const o=document.title||new Date().getTime();Ft(e,l,o,!1),this.exporting=!1},dragSortHandle(e){var t,a;if(!this.dragSortEnable)return;this.tableTableProps.defaultSort={};const{newIndex:l,oldIndex:o}=e;let s={};((t=this.tableList)==null?void 0:t.length)>0&&(s=this.tableList.splice(o,1)[0],this.tableList.splice(l,0,s),this.tableKey++);let n="",r=!1,i="此操作将会改变数据顺序, {oldIndex} => {newIndex}, 是否确认此操作?";if(q(this.$props.dragSort)&&this.$props.dragSort&&(n=this.$props.dragSort),J(this.$props.dragSort)&&this.$props.dragSort.sortApi&&(n=this.$props.dragSort.sortApi,r=this.$props.dragSort.confirm===!0,this.$props.dragSort.confirmMsg&&(i=this.$props.dragSort.confirmMsg),this.$props.dragSort),!n)return;const d=[];if((a=this.tableList)==null||a.forEach(h=>{h.id!==void 0&&d.push(h.id)}),d.length===0)return;const f=()=>this.$http.request({method:"POST",url:n,data:{ids:d.join(",")}}).then(h=>{this.$message({type:"success",message:"排序更新成功, 数据将刷新"}),this.$emit("dragSort"),this.load()});r?ut.confirm(I(i,{...s,oldIndex:o+1,newIndex:l+1}),"Warning",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{f()}).catch(()=>{const h=this.tableList.splice(l,1)[0];this.tableList.splice(o,0,h),this.tableKey++,$e({type:"info",message:"已取消"})}):f()},getListData(){return this.tableList},localSortHandler(e,t){}}}),kn={key:0,class:"selected-info"},Vn=["innerHTML"],Cn={key:0,class:"selected-info"},Sn=["innerHTML"],_n={key:0,class:"table-pagination"};function $n(e,t,a,l,o,s){const n=D("v-form"),r=ot,i=D("v-button"),d=Y,f=D("export-add-button"),h=z,v=G,g=D("v-icon"),m=D("table-style"),w=dt,k=pt,S=ga,O=rt;return u(),y(E,null,[e.showFilter&&e.showFilterCard?(u(),c(r,{key:0,shadow:"never",class:"table-filter"},{default:p(()=>[Z(e.$slots,"filter",{},()=>[e.tableFilter.length>0?(u(),c(n,{key:e.formKey,ref:"filter",modelValue:e.filterForm,"onUpdate:modelValue":t[0]||(t[0]=P=>e.filterForm=P),dev:e.dev,class:"filter-form","prefix-path":"filter",options:e.filterFormOptions,"form-items":e.tableFilter,"init-query-params":e.syncUrl,onSubmit:e.searchAction,onReset:e.resetFilter},null,8,["modelValue","dev","options","form-items","init-query-params","onSubmit","onReset"])):V("",!0)],!0)]),_:3})):V("",!0),Z(e.$slots,"action",{},()=>[b(v,{gutter:20,style:{"margin-bottom":"20px"}},{default:p(()=>[e.showBatchButton?(u(),c(d,{key:0,span:e.batchButtonCol},{default:p(()=>[b(i,{buttons:e.makeBatchButton(e.tableBatchButton),"prefix-path":"batchButton",onAction:e.batchBtnAction},null,8,["buttons","onAction"]),e.tableBatchButton.length>0&&e.selectedInfoPosition==="afterBatchButton"?(u(),y("div",kn,[_("span",{innerHTML:e.selectedInfo},null,8,Vn)])):V("",!0)]),_:1},8,["span"])):V("",!0),e.showNormalButton?(u(),c(d,{key:1,span:24-e.batchButtonCol,class:"normal-button"},{default:p(()=>[b(i,{buttons:e.makeNormalButton(e.tableNormalButton),"prefix-path":"normalButton",onAction:e.load},null,8,["buttons","onAction"]),e.tableExportAble?(u(),c(f,{key:0,"get-info":e.getExportInfo},null,8,["get-info"])):V("",!0),e.tableExportCurrentPageAble?(u(),c(h,{key:1,type:"primary",loading:e.exporting,onClick:e.exportCurrentTable},{default:p(()=>[x("导出")]),_:1},8,["loading","onClick"])):V("",!0)]),_:1},8,["span"])):V("",!0)]),_:1})],!0),Z(e.$slots,"before_table",{},void 0,!0),e.tableTabs.length>0?(u(),c(k,{key:1,modelValue:e.activeTab,"onUpdate:modelValue":t[1]||(t[1]=P=>e.activeTab=P),type:"card",onTabClick:e.changeTab},{default:p(()=>[(u(!0),y(E,null,N(e.tableTabs,(P,L)=>(u(),c(w,{key:L+"-pane",name:P.value+"",lazy:!0},{label:p(()=>[_("span",null,[b(g,{name:P.icon||""},null,8,["name"]),x(A(P.label),1)])]),default:p(()=>[Z(e.$slots,"table",{},()=>[W((u(),c(m,{ref_for:!0,ref:"table",key:e.tableKey,headers:e.tableHeaders,"data-list":e.tableList,"drag-sort":e.dragSortEnable,props:e.tableTableProps,selection:e.enableSelection,"cell-type":e.cellType,"cell-props":e.cellProps,"row-button":e.tableRowButton,"show-row-button":e.showRowButton,"make-row-button":e.makeRowButton,"load-children":e.loadChildren,"local-sort-handler":e.localSortHandler,onSelectChange:e.handleSelectionChange,onSortChange:e.sortTable,onCellChange:e.cellChange,onBtnAction:e.btnAction,onMounted:e.load,onDragSort:e.dragSortHandle},null,8,["headers","data-list","drag-sort","props","selection","cell-type","cell-props","row-button","show-row-button","make-row-button","load-children","local-sort-handler","onSelectChange","onSortChange","onCellChange","onBtnAction","onMounted","onDragSort"])),[[O,e.loading]])],!0)]),_:2},1032,["name"]))),128))]),_:3},8,["modelValue","onTabClick"])):Z(e.$slots,"table",{key:2},()=>[W((u(),c(m,{ref:"table",key:e.tableKey,headers:e.tableHeaders,"data-list":e.tableList,"drag-sort":e.dragSortEnable,props:e.tableTableProps,selection:e.enableSelection,"cell-type":e.cellType,"cell-props":e.cellProps,"row-button":e.tableRowButton,"show-row-button":e.showRowButton,"make-row-button":e.makeRowButton,"load-children":e.loadChildren,"local-sort-handler":e.localSortHandler,onSelectChange:e.handleSelectionChange,onSortChange:e.sortTable,onCellChange:e.cellChange,onBtnAction:e.btnAction,onDragSort:e.dragSortHandle},null,8,["headers","data-list","drag-sort","props","selection","cell-type","cell-props","row-button","show-row-button","make-row-button","load-children","local-sort-handler","onSelectChange","onSortChange","onCellChange","onBtnAction","onDragSort"])),[[O,e.loading]])],!0),e.listIncreaseConf.state&&e.listIncreaseConf.location==="afterList"?(u(),c(h,{key:3,class:"list-incr-button",onClick:e.listIncreaseRecord},{default:p(()=>[x("添加")]),_:1},8,["onClick"])):V("",!0),b(v,{style:{display:"flex"}},{default:p(()=>[b(d,{span:12,style:{"min-height":"15px"}},{default:p(()=>[e.tableBatchButton.length>0&&e.selectedInfoPosition==="beforePagination"?(u(),y("div",Cn,[_("span",{innerHTML:e.selectedInfo},null,8,Sn)])):V("",!0)]),_:1}),b(d,{span:12},{default:p(()=>[Z(e.$slots,"page",{},()=>[e.tableShowPagination?(u(),y("div",_n,[(u(),c(S,{key:e.paginationKey,background:"",layout:"total, sizes, prev, pager, next","page-size":e.tablePage.ps,"page-sizes":e.tablePage.sizes,"current-page":e.tablePage.pn,total:e.tablePage.total,onSizeChange:e.pssChange,onCurrentChange:t[2]||(t[2]=P=>e.pnChange(P))},null,8,["page-size","page-sizes","current-page","total","onSizeChange"]))])):V("",!0)],!0)]),_:3})]),_:3})],64)}const Nt=j(wn,[["render",$n],["__scopeId","data-v-e342b621"]]),Rt=Object.freeze(Object.defineProperty({__proto__:null,default:Nt},Symbol.toStringTag,{value:"Module"})),xn=Object.freeze(Object.defineProperty({__proto__:null,VTable:Nt},Symbol.toStringTag,{value:"Module"})),On=Object.freeze(Object.defineProperty({__proto__:null,RegComponents:Qo,VBtn:Re,VButton:ae,VButtonGroup:Pt},Symbol.toStringTag,{value:"Module"}));({...zo,...xn,...On});export{Nt as G,Me as K,Re as W,Lt as Y,vn as j,Do as q,Js as u};
