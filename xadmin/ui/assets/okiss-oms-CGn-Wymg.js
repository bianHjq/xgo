import"./vue-BdIfQa2M.js";import{A as He,X as xt,f as ie,D as Et,p as It,_ as X,z as Tt,K as Ct,E as Se,a as Fe,P as Re,w as oe,Y as Bt,b as Je}from"./okiss-utils-BhHyC4YL.js";import{y as ue}from"./mockjs-Z9x5-dno.js";import{Z as Ot,l as f}from"./lodash-ByQCJHeL.js";import{z as Ge,i as $t,E as ze,a as Ke,b as At,c as Pt,d as Xe,e as Lt,f as Dt,g as xe,h as Rt,j as Ee,k as We,l as re,m as Ze,n as Ye,o as le,p as W,q as jt,r as Mt,s as Nt,t as qt,u as Vt,v as Ut,w as Ht,x as Ft,y as Jt,A as Ie,B as pe,C as Gt}from"./element-plus-CMnLGHVt.js";import{a as Te}from"./axios-BimPEqV4.js";import{a as j}from"./js-cookie-Cz0CWeBA.js";import{c as zt,m as Ce,u as Qe}from"./vuex-C_aAXq0c.js";import"./dayjs-DZPVkzsk.js";import{c as Kt,a as Xt,u as et,b as de,o as Wt,d as Zt}from"./vue-router-CcS2Bio5.js";import{c as Yt}from"./path-to-regexp-C0JKNNVD.js";import{K as Be,g as Qt,T as el,z as J,q as Oe,Y as te,J as tl}from"./okiss-vbtf-iP6zxgdx.js";/* empty css                      */import{T as ll}from"./mitt-vYF5bycW.js";import{k as al}from"./vueuse-core-BQzZhQeI.js";import{O as il}from"./vue3-markdown-it-Dz73Mmte.js";import{a as ol}from"./crypto-js-DFuDHw7_.js";import{k as ve}from"./nprogress-0hbLWlTz.js";import{h as N,c as L,j as s,k as b,l as y,t as ne,x as E,F as I,J as $,f as tt,p as nl,N as w,q as m,z as c,y as S,s as p,m as V,r as ee,L as Z,v as lt,o as at,A as sl,g as rl,M as pl,Q as dl}from"./vue-runtime-core--ucnQW77.js";import{f as cl,e as me,a as ul,T as ml}from"./vue-runtime-dom-BaJLXN6r.js";import{r as D,u as x,b as hl,i as fl,d as bl}from"./vue-reactivity-CMjsa9wm.js";import{n as U,t as O,f as yl,j as H}from"./vue-shared-a06sHnWM.js";String.prototype.format||(String.prototype.format=function(){const e=arguments;return this.replace(/{(\d+)}/g,function(t,l){return typeof e[l]<"u"?e[l]:t})});const vl=N({__name:"App",setup(e){var t,l,i,a;return tt(()=>{var o;const n=document.getElementById("preloader");n!==null&&(document.body.removeChild(n),(o=document.getElementById("preloader"))==null||o.remove(),Tt("test-icon","//at.alicdn.com/t/font_2246548_zclaqxwmzq8.css"),Ct(`.iconfont {
      font-size: 19px;
      font-style: normal;
      -webkit-font-smoothing: antialiased;
      font-family: iconfont !important;
    }`))}),(l=(t=window==null?void 0:window.OmsOptions)==null?void 0:t.form)!=null&&l.vsPath&&nl("vsPath",(a=(i=window==null?void 0:window.OmsOptions)==null?void 0:i.form)==null?void 0:a.vsPath),(o,n)=>{const r=w("router-view");return s(),m(r)}}});var Y=(e=>(e.GET="get",e.POST="post",e.DELETE="delete",e.FETCH="fetch",e.OPTION="option",e.PUT="put",e))(Y||{});const gl={saveApi:"/save",afterSubmit:"",afterReset:"goback",options:{column:3,submitButton:{text:"提交"},cancelButton:{text:"取消",on:{click:"() => console.error(33333333)"}}},formItems:[{type:"radio",field:"radio",label:"单选框",info:'表单控件支持提示信息, 可写html <a class="el-link el-link--primary is-underline" target="_blank" href="http://github.com/daodao97">文档</a>',options:[{value:1,label:"选项1"},{value:2,label:"选项2"}],value:1,col:{span:12}},{type:"input",field:"input",label:"输入框",value:5,props:{maxlength:10,suffixIcon:"el-icon-date",slots:{prepend:"前缀"},showCopy:!0,prefixIcon:"el-icon-search"},rules:[{required:!0,message:"该项为必填项"}],depend:{field:"radio",value:1},computed:[{when:"aaa",set:{checkbox:{value:[1]}}},{when:"bbb",set:{checkbox:{value:[2,3]}}}],info:"当前控件依赖 单选框 的值, 仅在 选项1 下显示",col:{span:12}},{type:"number",field:"number",label:"数字",props:{step:2},computed:{when:4,set:{range_number:{label:"数字区间2"}}},col:{span:12},value:4},{type:"number-range",field:"range_number",label:"数字区间",col:{span:12}},{type:"checkbox",field:"checkbox",label:"复选框",value:[],options:[{value:1,label:"复选框1"},{value:2,label:"复选框2"},{value:3,label:"复选框3"}],info:"动态计算, 当 输入框 字段的值 为 aaa 时, 复选框1将被选中, 为 bbb 时, 复选框2,3 将被选中",col:{span:8}},{type:"date",field:"date",label:"日期",props:{disabled:!0},info:"禁用控件",col:{span:8}},{type:"date",field:"date_range",label:"日期范围",value:"",props:{type:"daterange",rangeSeparator:"~",startPlaceholder:"开始日期",endPlaceholder:"结束日期"},col:{span:8}},{type:"time",field:"time",label:"时间"},{type:"time",field:"time_range",label:"时间范围",props:{isRange:!0}},{type:"datetime",field:"datetime",label:"日期时间"},{type:"datetime",field:"datetime_range",label:"日期时间范围",props:{type:"datetimerange"}},{type:"select",field:"select",label:"下拉框",options:[{value:1,label:"选项1"},{value:2,label:"选项2"},{value:3,label:"选项3"},{value:4,label:"选项4"}],props:{selectApi:"/user/select"}},{type:"switch",field:"switch",label:"开关"},{type:"slider",field:"slider",label:"滑块"},{type:"upload",field:"upload",label:"上传",value:"http://qupinapptest.oss-cn-beijing.aliyuncs.com/1/202002/d81d3c9dc7c3df7590d333f783a97995.jpeg",props:{}},{type:"upload",field:"upload_multiple",label:"上传多张",props:{limit:3}},{type:"transfer",field:"transfer",label:"穿梭框",options:[{value:1,label:"备选项1"},{value:2,label:"备选项2"},{value:3,label:"备选项3"}],value:[]},{type:"color",field:"color",label:"颜色"},{type:"rate",field:"rate",label:"评分",value:3},{type:"sub-form",field:"sub_form",label:"多项子表单",props:{repeat:!0,formItems:[{type:"input",field:"sub_input",label:"输入框",rules:[{required:!0,message:"子表单的校验将在上层表单校验通过后执行"}],info:"input 输入框支持 mask",props:{mask:"99-9999999"}},{type:"input",field:"sub_input_1",label:"输入框1"}]}},{type:"sub-form",field:"sub_form_not_repeat",label:"子表单",props:{options:{inline:!0},formItems:[{type:"input",field:"sub_input",label:"输入框",rules:[{required:!0,message:"子表单的校验将在上层表单校验通过后执行"}]},{type:"input",field:"sub_input_1",label:"输入框1"}]}},{type:"icon-select",field:"icon",label:"图标"},{type:"json",field:"json",label:"json",value:'{"a":1}'},{type:"rule",field:"rule",label:"rule",value:[],props:{factorOptions:[{label:"A",value:"A"},{label:"B",value:"B"},{label:"C",value:"C"}],symbolOptions:[{label:"大于",value:">"},{label:"等于",value:"="},{label:"小于",value:"<"}]}},{type:"template",field:"p3",label:"自定义",comp:{inject:["formData"],template:'<div>{{ msg }}<br/>当前的表单数据是:<pre>{{JSON.stringify(formData, null, 2)}}</pre><el-button @click="onclick">click</el-button></div>',data:{msg:"this is custom data"},methods:{onclick:"() => { console.log(this)}"}},info:"在通用表单控件无法满足需求时, 可以编写 `template` 模板组件"}]},je=[{type:"jump",text:"跳转",target:"http://github.com/daodao97"},{type:"api",text:"请求接口",target:"/test_api",extra:{method:"POST",url:"/test_api"},props:{type:"warning"}},{type:"table",text:"表格",extra:{infoApi:"/student/list_info",listApi:"/student/list"},props:{type:"info"}},[{type:"jump",text:"跳转",target:"http://github.com/daodao97"},{type:"api",text:"请求接口",extra:{method:"POST",url:"/test_api"}}],{type:"form",text:"表单",extra:{infoApi:"/form",saveApi:"/save"},props:{type:"success"}}],kl={exportAble:!0,filter:[{field:"name",type:"input",label:"姓名"},{field:"sex",type:"select",label:"性别",options:[{value:1,label:"男"},{value:0,label:"女"}]}],headers:[{field:"name",label:"姓名",info:"表头提示"},{field:"sex",type:"enum",label:"性别",options:[{value:1,label:"男"},{value:0,label:"女"}],state:{1:"info",0:"warning"},props:{sortable:!0}},{field:"github",type:"link",label:"主页"},{field:"html",type:"html",label:"HTML"},{field:"image",type:"image",label:"头像"},{field:"json",type:"json",label:"信息"},{field:"richText",type:"rich-text",label:"信息"}],batchButton:je,rowButton:[{type:"jump",text:"编辑",target:"/user/{id}"},{type:"form",extra:{infoApi:"/user/{id}",saveApi:"/user/{id}"},props:{icon:"el-icon-edit",type:"success"}},{type:"api",extra:{method:"POST",url:"/student/{id}"},props:{icon:"el-icon-delete",type:"danger"}}],normalButton:[...Ot.cloneDeep(je),{type:"jump",target:"/user/form",props:{icon:"el-icon-plus",type:"primary"}}],selectedNotice:"当前共勾选: {selectedCount} 条",listApi:"/user/list"},_l={code:0,data:{"list|0-100":[{"id|0-1000":1,name:"@cname","sex|0-1":1,"score|0-100":60,link:"http://github.com/daodao97",image:"http://qupinapptest.oss-cn-beijing.aliyuncs.com/1/202002/d81d3c9dc7c3df7590d333f783a97995.jpeg",html:"<S>显示删除线1</S>",json:{slogan:"左手代码右手诗"},richText:"在一段文本中<突出|black|yellow>显示某些<文字|#ffffff|#000000>"}],page:{"count|1-10":2,"page|1-5":2}}},wl={afterSubmit:"",afterReset:"goback",formItems:[{type:"input",label:"span12-1",col:{span:12}},{type:"input",label:"span12-1",col:{span:12}},{type:"input",label:"span6-1",col:{span:6}},{type:"input",label:"span6-1",col:{span:6}},{type:"input",label:"span"}]},Sl={afterSubmit:"",afterReset:"",formItems:[{type:"input",label:"span12-1",col:{span:12}},{type:"input",label:"span12-1",col:{span:12}},{type:"input",label:"span6-1",section:"表单片段1",col:{span:6}},{type:"input",label:"span6-1",col:{span:6}},{section:"表单片段2",type:"input",label:"span"}]},xl={form:gl,table:kl,listMock:_l,layoutForm:wl,layoutSection:Sl},El=[{method:Y.POST,url:"/login",response(e){return{code:0,data:{name:"daodao97",token:"xxxxxxx"}}}},{method:Y.GET,url:"/user/info",response(e){return{code:0,data:{role_ids:[1],resource:[[0,20,"formItems","radio"],[0,1,2]]}}}},{url:"/user/routes",method:Y.GET,response:e=>({code:0,data:[{id:0,label:"",routes:[]}]})},{url:"/user/list",method:Y.GET,response:e=>xl.listMock}],Il=[...El],Tl={baseURL:"/api",withCredentials:!0,cacheEnable:!0},it={title:"oms",fixedHeader:!1,sidebarLogo:!0,logo:"http://assest.daodao.run/logo.png",closeNavNotice:!1,navBarNotice:"",hasNewMessage:!0,showPageJsonSchema:!1,loginTips:"",sso:{},ElementPlus:{size:"default",zIndex:3e3,locale:Ge},nav:[],whiteRoutes:["/login"],tokenExpire:7*24*60*60*1e3,defaultAvatar:"http://assest.daodao.run/avatar.jpg",envColor:{uat:"gray",pre:"green"},serviceOffLineNotice:"当前页面功能正在维护, 请稍后再试~~~",formMutex:!0,captcha:!0},$e={axios:Tl,settings:it,plugins:[],mock:!1},ge={};function ot(e){e.forEach(t=>{const l=nt(t);ge[`${t.method}::${l}`]=t})}ot(Il);function nt(e){var t;let l=e.url,i=e.baseURL||((t=$e.axios)==null?void 0:t.baseURL);return i||(i=""),typeof l=="string"?(l=("/"+i+l).split("/").filter(a=>a).join("/"),l+="(|\\?.*)$",new RegExp(l)):l}function Cl(){Object.keys(ge).forEach(e=>{const t=ge[e],l=nt(t);ue.mock(l,t.method,function(i){const{url:a,type:o,body:n}=i,r=Et(a),d=n?JSON.parse(n):{},u=t.response({query:r,data:d}),h=ue.mock(u);return It(a,{type:o,query:r,data:d,response:h}),ue.mock(h)})})}const Ae="oms:token";function Pe(){return j.get(Ae)||""}function Bl(e){const t=new Date(new Date().getTime()+(_.state.settings.tokenExpire||864e5));return j.set(Ae,e,{expires:t})}function st(){return j.remove(Ae)}const Ol={name:"",nickname:"",avatar:"",token:Pe(),customRouter:[],remoteRouter:[],menuRoutes:[],isLodeRemoteRoutes:!1,resource:{},roleIds:[],path:"",env:"",expired:!1},$l={namespaced:!0,state:Ol,mutations:{updateToken(e,t){e.token=t,Bl(t)},removeToken(e){e.token="",st()},updateRemoteRouter(e,t){e.remoteRouter=t,e.isLodeRemoteRoutes=!0},setCustomRoutes(e,t){e.customRouter=e.customRouter.concat(t)},updateState(e,{key:t,value:l}){e[t]=l},resetUser(e){Object.assign({name:"",nickname:"",avatar:"",token:Pe(),customRouter:[],remoteRouter:[],menuRoutes:[],isLodeRemoteRoutes:!1,resource:{},roleIds:[],path:"",env:"",expired:!1})},SET_EXPIRED:e=>{e.expired=!e.expired}},actions:{login({commit:e,state:t,rootState:l},i){return new Promise((a,o)=>{l.http?l.http.request({url:"/user/login",method:"POST",data:i}).then(n=>{var r;e("updateToken",(r=n.data)==null?void 0:r.token),a(!0)}).catch(n=>{o(n)}):o("http client not init")})},logout({commit:e}){e("removeToken"),e("resetUser")},info({commit:e,rootState:t}){return new Promise((l,i)=>{t.http?t.http.request({url:"/user/info",method:"GET"}).then(a=>{var o,n,r,d,u,h;const v=((o=a.data)==null?void 0:o.role_ids)||[];e("updateState",{key:"name",value:(n=a.data)==null?void 0:n.name}),e("updateState",{key:"nickname",value:(r=a.data)==null?void 0:r.nickname}),e("updateState",{key:"roleIds",value:v}),e("updateState",{key:"env",value:(d=a.data)==null?void 0:d.env});const k=((u=a.data)==null?void 0:u.website)||{};e("settings/updateSettings",k,{root:!0}),!j.get("username")&&j.set("username",(h=a.data)==null?void 0:h.name),l(!0)}).catch(a=>{i(a)}):i("http client not init")})},loadRemoteRoutes({state:e,rootState:t}){return new Promise((l,i)=>{var a;(a=t.http)==null||a.request({url:"/user/routes",method:"get"}).then(o=>{if(o.code===0){const n=o.data||[];l(n)}else i("error")}).catch(o=>{i(o)})})},SetExpired({commit:e}){e("SET_EXPIRED")}}},Al=f.cloneDeep(it),Pl={namespaced:!0,state:Al,mutations:{updateSettings(e,t){e=f.merge(e,t)}},actions:{updateSettings({commit:e,state:t},l){e("updateSettings",l)}}},Ll={sidebar:{opened:j.get("sidebarStatus")?!!j.get("sidebarStatus"):!0,withoutAnimation:!1},device:"desktop",pages:{},currentRouteMeta:{},builderSchema:{},baseURL:""},Dl={namespaced:!0,state:Ll,mutations:{TOGGLE_SIDEBAR:e=>{e.sidebar.opened=!e.sidebar.opened,e.sidebar.withoutAnimation=!1,e.sidebar.opened?j.set("sidebarStatus","1"):j.set("sidebarStatus","0")},CLOSE_SIDEBAR:(e,t)=>{j.set("sidebarStatus","0"),e.sidebar.opened=!1,e.sidebar.withoutAnimation=t},TOGGLE_DEVICE:(e,t)=>{e.device=t},SET_PAGE_JSON_SCHEMA:(e,{page:t,json:l})=>{e.pages[t]=l},SET_CURRENT_META:(e,t)=>{e.currentRouteMeta=t},SET_BUILDER_SCHEMA:(e,t)=>{e.builderSchema=t},SET_BASE_API:(e,t)=>{e.baseURL=t}},actions:{toggleSideBar({commit:e}){e("TOGGLE_SIDEBAR")},closeSideBar({commit:e},{withoutAnimation:t}){e("CLOSE_SIDEBAR",t)},toggleDevice({commit:e},t){e("TOGGLE_DEVICE",t)},setPageJsonSchema({commit:e},t){e("SET_PAGE_JSON_SCHEMA",t)},setCurrentMeta({commit:e},t){e("SET_CURRENT_META",t)},setBuilderSchema({commit:e},t){e("SET_BUILDER_SCHEMA",t)},setBaseAPI({commit:e},t){e("SET_BASE_API",t)}}},Rl={currentCellItem:{}},jl={namespaced:!0,state:Rl,mutations:{SET_CURRENT_CELLITEM:(e,t)=>{e.currentCellItem=t}},actions:{setCurrentCellItem({commit:e},t){e("SET_CURRENT_CELLITEM",t)}}},_=zt({state:void 0,getters:{http:e=>e.http,sidebar:e=>e.app.sidebar,device:e=>e.app.device,token:e=>e.user.token,avatar:e=>e.user.avatar,name:e=>e.user.name,nickname:e=>e.user.nickname,remoteRouter:e=>e.user.remoteRouter,customRouter:e=>e.user.customRouter,nav:e=>e.settings.nav,builderSchema:e=>e.app.builderSchema,currentCellItem:e=>e.builderSchema.currentCellItem},mutations:{setHttp(e,t){e.http=t}},actions:{setHttp({commit:e,state:t},l){e("setHttp",l)}},modules:{user:$l,settings:Pl,app:Dl,builderSchema:jl}}),Ml=ze,Me=Ke,Nl=Te.CancelToken,se={taskList:{},cacheList:new Map,uniqueId(e){return`${location.href}|${e.method}|${e.url}|`},addTask(e,t){const l=this.uniqueId(e);this.taskList[l]=t},delTask(e){const t=this.uniqueId(e),l=this.taskList[t];l&&l(e)},pending(e){const t=this.uniqueId(e);return!!this.taskList[t]},cache(e){const t=this.uniqueId(e),l=this.cacheList.get(t);if(l){if(l.expirationTime<new Date().getTime()){this.delCache(e);return}return l.response,l.response}},addCache(e,t){const l=this.uniqueId(e),i=e.cacheTime||0;i&&this.cacheList.set(l,{response:t,expirationTime:new Date().getTime()+i})},delCache(e){const t=this.uniqueId(e);return this.cacheList.delete(t)}},ql={onFulfilled:function(e){return e.cacheEnable===!1||(se.pending(e)&&se.delTask(e),e.cancelToken=new Nl(t=>{se.addTask(e,t)})),e},onRejected(e){return Promise.reject(e)}},Vl={onFulfilled:function(e){return e.config.cacheEnable===!1||e.config.method==="get"&&Object.keys(e.data).length>0&&se.addCache(e.config,e.data),e},onRejected(e){return Promise.reject(e)}},rt={};function wn(e,t){rt[e]=t}function Ul(e){return rt[e]}const Hl=N({name:"Dashboard",setup(){const e=Qe(),t=Ul("dashboard");if(t)return()=>c("span",null,[c(t,null,null)]);const l=L(()=>e.getters.name);return()=>c("div",{class:"dashboard-container"},[c("div",{class:"dashboard-text"},[S("Hi "),l.value,S(" 😄")])])}}),T=(e,t)=>{const l=e.__vccOpts||e;for(const[i,a]of t)l[i]=a;return l},Fl=T(Hl,[["__scopeId","data-v-3122b6c7"]]),Jl={data(){return{levelList:null}},watch:{$route(){this.getBreadcrumb()}},created(){this.getBreadcrumb()},methods:{getBreadcrumb(){let e=this.$route.matched.filter(l=>l.meta&&l.meta.title);const t=e[0];this.isDashboard(t)||(e=[{path:"/dashboard",meta:{title:"Dashboard"}}].concat(e)),this.levelList=e.filter(l=>l.meta&&l.meta.title&&l.meta.breadcrumb!==!1)},isDashboard(e){const t=e&&e.name;return t?t.trim().toLocaleLowerCase()==="Dashboard".toLocaleLowerCase():!1},pathCompile(e){const{params:t}=this.$route;return Yt(e)(t)},handleLink(e){const{redirect:t,path:l}=e;if(t){this.$router.push(t);return}this.$router.push(this.pathCompile(l))}}},Gl={key:0,class:"no-redirect"},zl=["onClick"];function Kl(e,t,l,i,a,o){const n=At,r=Pt;return s(),m(r,{class:"app-breadcrumb",separator:"/"},{default:p(()=>[c(ul,{name:"breadcrumb"},{default:p(()=>[(s(!0),b(I,null,$(a.levelList,(d,u)=>(s(),m(n,{key:d.path},{default:p(()=>[d.path.indexOf("/DIR_")===0&&d.redirect===void 0||u===a.levelList.length-1?(s(),b("span",Gl,O(d.meta.title),1)):(s(),b("a",{key:1,onClick:h=>o.handleLink(d)},O(d.meta.title),9,zl))]),_:2},1024))),128))]),_:1})]),_:1})}const Xl=T(Jl,[["render",Kl],["__scopeId","data-v-fa74804e"]]),Wl={name:"Hamburger",props:{isActive:{type:Boolean,default:!1}},emits:["toggle-click"],methods:{toggleClick(){this.$emit("toggle-click")}}};function Zl(e,t,l,i,a,o){const n=w("v-icon");return s(),b("div",{style:{padding:"0 15px"},onClick:t[0]||(t[0]=(...r)=>o.toggleClick&&o.toggleClick(...r))},[c(n,{class:U({"is-active":l.isActive}),name:"ra-leftalignment"},null,8,["class"])])}const Yl=T(Wl,[["render",Zl]]),Ql={};function ea(e,t){const l=W,i=Ht,a=Ft,o=Jt;return s(),m(o,{style:{width:"100%",height:"100%"}},{default:p(()=>[c(l,{class:"aside"},{default:p(()=>[ee(e.$slots,"left-aside",{},void 0,!0)]),_:3}),c(i,{class:"main",style:{margin:"0 10px"}},{default:p(()=>[ee(e.$slots,"main",{},void 0,!0)]),_:3}),c(a,{class:"aside",width:"350px",style:{padding:"20px"}},{default:p(()=>[ee(e.$slots,"right-aside",{},void 0,!0)]),_:3})]),_:3})}const pt=T(Ql,[["render",ea],["__scopeId","data-v-7c3d697b"]]),ta={type:"input",name:"文本框",default:{type:"input",label:"label",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"sub-form",field:"props",label:"属性",props:{options:{labelPosition:"top"},formItems:[{type:"number",field:"maxlength",label:"最大字符数"},{type:"icon-select",field:"prefixIcon",label:"前置ICON"},{type:"icon-select",field:"suffixIcon",label:"后置ICON"},{type:"switch",field:"showCopy",label:"复制"},{type:"switch",field:"disabled",label:"禁用"},{type:"switch",field:"showWordLimit",label:"显示限制词数"},{type:"input",field:"mask",label:"mask",info:'<a href="https://github.com/RobinHerbots/Inputmask" target="_blank" class="el-link el-link--primary">文档</a>'}]}}]},la={type:"number",name:"数字",default:{type:"number",label:"label",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"sub-form",field:"props",label:"属性",props:{options:{labelPosition:"top"},formItems:[{type:"number",field:"min",label:"最小值"},{type:"number",field:"man",label:"最大值"}]}}]},aa={type:"number-range",name:"数字区间",default:{type:"number-range",label:"label",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"sub-form",field:"props",props:{options:{labelPosition:"top"},formItems:[{type:"input",field:"unit",label:"单位"},{type:"switch",field:"disabled",label:"禁用"}]}}]},ia={type:"select",name:"下拉框",default:{type:"select",label:"label",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"radio",field:"optionType",label:"备选项类型",value:0,options:[{value:0,label:"local"},{value:1,label:"remote"}]},{type:"sub-form",field:"options",label:"备选项",props:{repeat:!0,options:{labelPosition:"top"},formItems:[{type:"input",field:"value",label:"value"},{type:"input",field:"label",label:"label"}]},depend:{field:"optionType",value:0}},{type:"sub-form",field:"props",label:"属性",props:{options:{labelPosition:"top"},formItems:[{type:"input",field:"selectApi",label:"备选项接口",depend:{field:".optionType",value:1}},{type:"switch",field:"multiple",label:"多选"},{type:"number",field:"multipleLimit",label:"最大选中数",depend:{field:"multiple",value:!0}},{type:"switch",field:"allowCreate",label:"允许创建"},{type:"switch",field:"filterable",label:"允许过滤"}]}}],trans(e){const t=f.cloneDeep(e);return e.optionType===0?t.props&&t.props.selectApi!==void 0&&delete t.props.selectApi:e.optionType===1&&t.options&&delete t.options,delete t.optionType,t}},oa={type:"radio",name:"单选框",default:{type:"radio",label:"label",field:"field_name",options:[]},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"sub-form",field:"options",label:"备选项",props:{formItems:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"value",label:"字段值"}],repeat:!0}},{type:"input",field:"default",label:"默认值"}]},na={type:"switch",name:"开关",default:{type:"switch",label:"label",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"sub-form",field:"props",props:{options:{labelPosition:"top"},formItems:[{type:"input",field:"activeText",label:"打开时的文字描述"},{type:"input",field:"inactiveText",label:"关闭时的文字描述"},{type:"color",field:"activeColor",label:"打开时的背景色"},{type:"color",field:"inactiveColor",label:"关闭时的背景色"},{type:"switch",field:"disabled",label:"禁用"}]}}]},sa={type:"code",name:"Code",default:{type:"code",label:"label",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"}]},ra={type:"json",name:"json",default:{type:"json",label:"label",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"}]},pa={type:"upload",name:"上传",default:{type:"upload",label:"label",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"}]},da={type:"template",name:"自定义组件",default:{type:"template",label:"label",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"}]},ca={type:"icon-select",name:"图标选择器",default:{type:"icon-select",label:"label",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"}]},ua={type:"sub-form",name:"子表单",default:{type:"sub-form",label:"label",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"sub-form",field:"props",label:"属性",props:{options:{labelPosition:"top"},formItems:[{type:"switch",field:"repeat",label:"可重复"},{type:"sub-form",field:"form-items",label:"子表单控件",props:{options:{labelPosition:"top"},repeat:!0,formItems:[{type:"input",field:"label",label:"label"},{type:"select",field:"type",label:"类型",options:[{value:"input",label:"文本框"}]}]}},{type:"switch",field:"disabled",label:"禁用"}]}}]},ma={type:"checkbox",name:"复选框",default:{type:"checkbox",label:"label",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"sub-form",field:"props",props:{options:{labelPosition:"top"},formItems:[{type:"number",field:"max",label:"最大选中数"},{type:"number",field:"min",label:"最小选中数"},{type:"switch",field:"disabled",label:"禁用"}]}}]},dt={};function A(e){dt[e.type]=e}A(ta);A(ia);A(la);A(aa);A(na);A(ua);A(oa);A(ma);A(sa);A(ra);A(pa);A(ca);A(da);const ke=dt,ha={options:{labelPosition:"top",submitButton:!1,cancelButton:!1},formItems:[{type:"input",field:"saveApi",label:"保存接口"},{type:"switch",field:"inline",label:"行布局"},{type:"radio",field:"labelPosition",label:"label位置",options:[{value:"right",label:"右"},{value:"left",label:"左"},{value:"top",label:"上"}]},{type:"input",field:"labelWidth",label:"label宽度",value:"100px"},{type:"switch",field:"showSubmitButton",label:"显示提交按钮",value:!0},{type:"sub-form",field:"submitButton",label:"提交按钮",props:{options:{labelPosition:"top"},formItems:[{type:"input",field:"text",label:"文案",value:"提交"},{type:"select",field:"type",label:"按钮类型",options:[{value:"primary",label:"primary"}]}]}},{type:"switch",field:"showCancelButton",label:"显示取消按钮",value:!0},{type:"sub-form",field:"cancelButton",label:"取消按钮",props:{options:{labelPosition:"top"},formItems:[{type:"input",field:"text",label:"文案",value:"取消"},{type:"select",field:"type",label:"按钮类型",options:[{value:"primary",label:"primary"}]}]}}]},he={labelPosition:"top",submitButton:!1,cancelButton:!1},Le=[];Object.keys(ke).forEach(e=>{Le.push({value:e,label:ke[e].name})});const fa={options:{submitButton:!1,cancelButton:!1},formItems:[{type:"sub-form",field:"columns",props:{repeat:!0,formItems:[{type:"input",field:"field",label:"字段key"},{type:"select",field:"type",label:"类型",options:f.cloneDeep(Le)},{type:"input",field:"label",label:"字段label"}]}}]},ba={components:{DevLayout:pt,VForm:J,VButton:Be,JsonView:Oe},props:{schema:{type:Object,default:e=>{}}},data(){return{sqlOptions:{},sqlSchema:fa,baseSchema:ha,activeTab:"base",builderSchema:Object.assign({},this.$props.schema,{options:{submitButton:!1,cancelButton:!1}}),baseOptions:{},key:0,ctrlKey:0,activeCtrl:void 0,ctrlOptions:{},ctrlSchema:{},ctrlName:"",activeIndex:void 0,ctrlMap:ke,activeIndexReg:/(formItems)?\[(\d+)\]/,tableStruct:"",activeName:"1",currentCtrlType:"input",types:f.cloneDeep(Le)}},computed:{getSaveSchema(){return{formItems:this.builderSchema.formItems}}},watch:{baseOptions:{deep:!0,immediate:!0,handler(e){const t=f.cloneDeep(e);e.showSubmitButton===!1&&(t.submitButton=!1),e.cancelSubmitButton===!1&&(t.cancelButton=!1),delete t.showSubmitButton,delete t.showCancelButton,Object.keys(t).length>0&&(this.builderSchema=f.merge(this.builderSchema,{options:t}),this.key++)}},ctrlOptions:{deep:!0,handler(e){const t=f.get(this.builderSchema,this.activeIndex);if(!t)return;const l=t?t.type:"",i=this.ctrlMap[l],a=i.trans?i.trans(e):e;if(a&&Object.keys(a).length>0){if(a.type=l,this.activeIndex.indexOf("[")>-1){const[o,n,r]=this.activeIndex.match(/(\w+)\[(\d+)\]/);this.builderSchema[n][r]={...a}}else this.builderSchema[this.activeIndex]=a;this.key++}}},currentCtrlType:{handler(e){const t=this.ctrlMap[e];this.ctrlSchema=f.cloneDeep({options:f.cloneDeep(he),formItems:f.cloneDeep(t.builder)});const l=f.get(this.builderSchema,this.activeIndex);this.ctrlOptions=f.cloneDeep(l),this.ctrlOptions.type=e,this.ctrlKey++,this.key++}}},beforeCreate(){z.on("dev-action",({event:e,data:t})=>{this.onDevAction(t.type,t.devId)})},unmounted(){z.off("dev-action")},methods:{onDevAction(e,t){this.activeIndex="formItems"+t,e==="edit"&&(this.activeTab="ctrl",this.clicklabel()),e==="del"&&(this.activeTab="base",this.removeOne()),this.ctrlKey++},push(e){const t="formItems";this.ctrlOptions={},this.builderSchema[t]=this.builderSchema[t]||[];const l=this.ctrlMap[e];this.activeCtrl=l,this.builderSchema[t].push(f.cloneDeep(l.default)),this.ctrlSchema=f.cloneDeep({options:f.cloneDeep(he),formItems:f.cloneDeep(l.builder)}),this.ctrlKey++,this.key++,this.activeIndex=`${t}[${this.builderSchema[t].length-1}]`,this.activeTab="ctrl"},removeOne(){f.unset(this.builderSchema,this.activeIndex),this.builderSchema=f.cloneDeep(Fe(this.builderSchema)),this.activeIndex="",this.ctrlOptions={},this.ctrlSchema={},this.key++,this.ctrlKey++},clicklabel(){const e=this.activeIndex;if(e.match(this.activeIndexReg)){const t=f.cloneDeep(f.get(this.builderSchema,e)),l=t.type,i=this.ctrlMap[l];if(!i){this.$message({type:"warning",message:"尚未支持该组件的UI编辑"});return}this.currentCtrlType=l,this.ctrlOptions=t,this.ctrlSchema=f.cloneDeep({options:f.cloneDeep(he),formItems:f.cloneDeep(i.builder)}),this.ctrlKey++}},saveSchema(){this.$http.request({method:"POST",url:"/devtool/page_schema",data:{formItems:this.builderSchema.formItems}}).then(({data:e})=>{e&&this.$message({type:"success",message:"保存成功, 请刷新页面查看效果"})})}}};function ya(e,t,l,i,a,o){const n=w("v-form"),r=We,d=re,u=w("JsonView"),h=w("VButton"),v=xe,k=Ee,g=Ze,F=Ye,q=w("dev-layout");return s(),m(q,null,{main:p(()=>[a.builderSchema.formItems?(s(),m(n,V({ref:"form",key:a.key,dev:!0},a.builderSchema),null,16)):E("",!0),c(r),c(d,{type:"primary",onClick:o.saveSchema},{default:p(()=>t[2]||(t[2]=[S("保存页面配置")])),_:1},8,["onClick"]),t[3]||(t[3]=S("    ")),c(h,{text:"PageSchema",type:"modal"},{default:p(()=>[c(u,{data:o.getSaveSchema},null,8,["data"])]),_:1})]),"right-aside":p(()=>[a.activeIndex?(s(),m(F,{key:0},{default:p(()=>[c(g,{label:"控件类型"},{default:p(()=>[c(k,{modelValue:a.currentCtrlType,"onUpdate:modelValue":t[0]||(t[0]=B=>a.currentCtrlType=B)},{default:p(()=>[(s(!0),b(I,null,$(a.types,(B,K)=>(s(),m(v,{key:K,label:B.label,value:B.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})):E("",!0),(s(),m(n,V({key:a.ctrlKey,modelValue:a.ctrlOptions,"onUpdate:modelValue":t[1]||(t[1]=B=>a.ctrlOptions=B)},a.ctrlSchema),null,16,["modelValue"]))]),_:1})}const va=T(ba,[["render",ya],["__scopeId","data-v-875f0171"]]),ga={type:"input",name:"文本框",default:{type:"input",label:"label",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"sub-form",field:"props",label:"属性",props:{options:{labelPosition:"top"},formItems:[{type:"number",field:"maxlength",label:"最大字符数"},{type:"switch",field:"showWordLimit",label:"显示限制词数"},{type:"input",field:"mask",label:"mask",info:'<a href="https://github.com/RobinHerbots/Inputmask" target="_blank" class="el-link el-link--primary">文档</a>'}]}}]},ka={type:"select",name:"下拉框",default:{type:"select",label:"label",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"radio",field:"optionType",label:"备选项类型",value:0,options:[{value:0,label:"local"},{value:1,label:"remote"}]},{type:"sub-form",field:"options",label:"备选项",props:{repeat:!0,options:{labelPosition:"top"},formItems:[{type:"input",field:"value",label:"value"},{type:"input",field:"label",label:"label"}]},depend:{field:"optionType",value:0}},{type:"sub-form",field:"props",label:"属性",props:{options:{labelPosition:"top"},formItems:[{type:"input",field:"selectApi",label:"备选项接口",depend:{field:".optionType",value:1}},{type:"switch",field:"multiple",label:"多选"},{type:"number",field:"multipleLimit",label:"最大选中数",depend:{field:"multiple",value:!0}},{type:"switch",field:"filterable",label:"允许过滤"}]}}],trans(e){const t=f.cloneDeep(e);return e.optionType===0?t.props&&t.props.selectApi!==void 0&&delete t.props.selectApi:e.optionType===1&&t.options&&delete t.options,delete t.optionType,t}},_a={type:"date",name:"日期",default:{type:"date",label:"时间",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"}]},Ne={options:{labelPosition:"top",submitButton:!1,cancelButton:!1},formItems:[{type:"switch",field:"showFilter",label:"搜索条件",value:!0},{type:"switch",field:"showPagination",label:"页码",value:!0},{type:"switch",field:"exportAble",label:"导出按钮"}]},fe={labelPosition:"top",submitButton:!1,cancelButton:!1},wa={type:"span",name:"文本",default:{type:"span",label:"表头",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"input",field:"info",label:"提示"},{type:"switch",field:"sortable",label:"排序"}]},Sa={type:"enum",name:"标签",default:{type:"enum",label:"表头",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"input",field:"info",label:"提示"},{type:"sub-form",field:"options",label:"映射",props:{options:{labelPosition:"top"},formItems:[{type:"input",field:"value",label:"value"},{type:"input",field:"label",label:"label"}]},value:[]}],trans(e){return e.options=e.options||[],e.label||(e.label="表头"),e}},xa={type:"html",name:"HTML",default:{type:"html",label:"表头",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"input",field:"info",label:"提示"}]},Ea={type:"icon",name:"图标",default:{type:"icon",label:"表头",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"input",field:"info",label:"提示"}]},Ia={type:"image",name:"图片",default:{type:"image",label:"表头",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"input",field:"info",label:"提示"}]},Ta={type:"json",name:"JSON",default:{type:"json",label:"表头",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"input",field:"info",label:"提示"}]},Ca={type:"link",name:"链接",default:{type:"link",label:"表头",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"input",field:"info",label:"提示"}]},Ba={type:"rich",name:"富文本",default:{type:"rich",label:"表头",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"input",field:"info",label:"提示"}]},Oa={type:"tpl",name:"模板",default:{type:"tpl",label:"表头",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"input",field:"info",label:"提示"},{type:"input",field:"tpl",label:"模板",info:"例如 <code>姓名: {name} 年龄:{age}</code>"}]},$a={span:wa,enum:Sa,html:xa,icon:Ea,image:Ia,json:Ta,link:Ca,rich:Ba,tpl:Oa},Aa={type:"jump",name:"跳转",default:{type:"jump",target:"",text:"按钮"},builder:[{type:"input",field:"target",label:"跳转地址",info:"可以是本地路由, 也可以是url"},{type:"input",field:"text",label:"文案"},{type:"sub-form",field:"props",label:"属性",props:{options:{labelPosition:"top"},formItems:[{type:"icon-select",field:"icon",label:"图标"},{type:"select",field:"type",label:"类型",options:[{value:"primary",label:"primary"},{value:"info",label:"info"}]}]}}]},Pa={type:"api",name:"接口请求",default:{type:"api",target:"",text:"请求"},builder:[{type:"input",field:"target",label:"API地址",info:"此处填写接口path即可"},{type:"input",field:"text",label:"文案"},{type:"sub-form",field:"props",label:"属性",props:{options:{labelPosition:"top"},formItems:[{type:"input",field:"text",label:"文案"},{type:"icon-select",field:"icon",label:"图标"},{type:"select",field:"type",label:"类型",options:[{value:"primary",label:"primary"},{value:"info",label:"info"}]},{type:"input",field:"api",label:"API地址",info:"此处填写接口path即可"},{type:"select",field:"method",label:"请求类型",options:[{value:"GET",label:"GET"},{value:"POST",label:"POST"},{value:"DELETE",label:"DELETE"},{value:"PUT",label:"PUT"}]}]}}]},La={type:"form",name:"弹框表单",default:{type:"form",target:"",text:"弹框表单"},builder:[{type:"input",field:"text",label:"文案"},{type:"radio",field:"container",label:"模式",options:[{value:"dialog",label:"模态框"},{value:"drawer",label:"抽屉"}],value:"dialog"},{type:"radio",field:"schema_type",label:"表单类型",options:[{value:0,label:"本地"},{value:1,label:"远程"}],value:1},{type:"input",field:"infoApi",label:"formSchema接口",depend:{field:"schema_type",value:1}},{type:"json",field:"form-items",label:"表单控件"},{type:"input",field:"saveApi",label:"保存接口"}]},Da={type:"table",name:"弹框列表",default:{type:"form",target:"",text:"弹框表单"},builder:[{type:"input",field:"text",label:"文案"},{type:"radio",field:"container",label:"模式",options:[{value:"dialog",label:"模态框"},{value:"drawer",label:"抽屉"}],value:"dialog"},{type:"radio",field:"schema_type",label:"表单类型",options:[{value:0,label:"本地"},{value:1,label:"远程"}],value:1},{type:"input",field:"infoApi",label:"formSchema接口",depend:{field:"schema_type",value:1}},{type:"json",field:"form-items",label:"表单控件"},{type:"input",field:"saveApi",label:"保存接口"}]},Ra={jump:Aa,api:Pa,form:La,table:Da},ja={components:{JsonView:Oe,DevLayout:pt,VTable:te,VForm:J,VButton:Be},props:{schema:{type:Object,default:e=>{}}},data(){const e=hl(this.$props.schema);return delete e.listApi,e.list=[{}],{baseSchema:Ne,activeTab:"base",builderSchema:Object.assign({},Ne,e),baseOptions:{},key:0,ctrlKey:0,activeCtrl:void 0,activeBrick:void 0,ctrlOptions:{},ctrlSchema:{},ctrlName:"",activeIndex:void 0,ctrlMap:{filter:{input:ga,select:ka,date:_a},headers:$a,buttons:Ra},activeIndexReg:/(filter|headers|normalButton|batchButton|rowButton)?\[(\d+)\]/,currentCtrlType:"input"}},computed:{types(){const e=[],t=this.ctrlMap[this.activeBrick];return Object.keys(t).forEach(l=>{e.push({value:l,label:t[l].name})}),e},getSaveSchema(){return{filter:this.builderSchema.filter,headers:this.builderSchema.headers,rowButton:this.builderSchema.rowButton,normalButton:this.builderSchema.normalButton,batchButton:this.builderSchema.batchButton}},currentBuilderSchema(){return this.$store.state.app.builderSchema}},watch:{baseOptions:{deep:!0,immediate:!0,handler(e){this.builderSchema=f.merge(this.builderSchema,e),this.key++,this.updateBuilderSchema()}},ctrlOptions:{deep:!0,handler(e){const t=this.activeIndex.match(this.activeIndexReg);if(!t)return;let l=this.builderSchema[t[1]][parseInt(t[2])].type;t[1]==="headers"&&l===void 0&&(l="span");const i=this.ctrlMap[this.activeBrick][l];if(!i)return;const a=i.trans?i.trans(e):e;if(a&&Object.keys(a).length>0){if(a.type=l,this.activeIndex.indexOf("[")>-1){const[o,n,r]=this.activeIndex.match(/(\w+)\[(\d+)\]/);this.builderSchema[n][r]={...a}}else this.builderSchema[this.activeIndex]=a;this.key++}this.updateBuilderSchema()}},currentCtrlType:{handler(e){const t=this.ctrlMap[this.activeBrick][e];this.ctrlSchema=f.cloneDeep({options:f.cloneDeep(fe),formItems:f.cloneDeep(t.builder)});const l=f.get(this.builderSchema,this.activeIndex);l.type=e;const i=f.cloneDeep(l);this.ctrlOptions=i,i.text&&(this.ctrlOptions.text=i.text,this.ctrlOptions.props=i.props||{}),this.ctrlKey++,this.key++,this.updateBuilderSchema()}}},beforeCreate(){z.on("dev-action",({event:e,data:t})=>{this.onDevAction(t.type,t.devId)})},unmounted(){z.off("dev-action")},methods:{updateBuilderSchema(){this.$store.dispatch("app/setBuilderSchema",this.builderSchema)},onDevAction(e,t){this.activeIndex=t,e==="edit"&&(this.activeTab="ctrl",this.clicklabel()),e==="del"&&(this.activeTab="base",this.removeOne()),this.ctrlKey++},pushFilter(e){this.push(e,"filter","filter","filter")},pushHeaders(e){this.push(e,"headers","headers","headers")},pushNormalButton(e){this.push(e,"normalButton","buttons","buttons")},pushBatchButton(e){this.push(e,"batchButton","buttons","buttons")},pushRowButton(e){this.push(e,"rowButton","buttons","buttons")},push(e,t,l,i){const a=this.ctrlMap[l];if(!a[e]){this.$message({type:"warning",message:"尚未支持此组件的UI编辑"});return}this.activeCtrl=a[e],this.activeBrick=i,this.ctrlOptions={},this.builderSchema[t]=this.builderSchema[t]||[],this.builderSchema[t].push(f.cloneDeep(a[e].default)),this.ctrlSchema=f.cloneDeep({options:f.cloneDeep(fe),formItems:f.cloneDeep(a[e].builder)}),this.key++,this.ctrlKey++,this.activeIndex=`${t}[${this.builderSchema[t].length-1}]`,this.activeTab="ctrl"},removeOne(){f.unset(this.builderSchema,this.activeIndex),this.builderSchema=f.cloneDeep(Fe(this.builderSchema)),this.activeIndex="",this.ctrlOptions={},this.ctrlSchema={},this.key++,this.ctrlKey++},clicklabel(){const e=this.activeIndex,t=e.match(this.activeIndexReg);if(t){const l=f.cloneDeep(f.get(this.builderSchema,e));this.activeBrick=t[1],["normalButton","batchButton","rowButton"].indexOf(t[1])>-1&&(this.activeBrick="buttons");let i=this.builderSchema[t[1]][parseInt(t[2])].type;t[1]==="headers"&&i===void 0&&(i="span");const a=this.ctrlMap[this.activeBrick][i];if(!a){this.activeBrick,this.$message({type:"warning",message:"尚未支持此组件的UI编辑"});return}this.ctrlOptions=l,this.currentCtrlType=i,this.ctrlSchema=f.cloneDeep({options:f.cloneDeep(fe),formItems:f.cloneDeep(a.builder)}),this.ctrlKey++}},saveSchema(){const{filter:e,headers:t,rowButton:l,normalButton:i,batchButton:a}=this.currentBuilderSchema;this.$http.request({method:"POST",url:"/devtool/page_schema",data:{filter:e,headers:t,rowButton:l,normalButton:i,batchButton:a}}).then(({data:o})=>{o&&this.$message({type:"success",message:"保存成功, 请刷新页面查看效果"})})}}};function Ma(e,t,l,i,a,o){const n=le,r=re,d=W,u=w("v-table"),h=We,v=re,k=w("JsonView"),g=w("VButton"),F=xe,q=Ee,B=Ze,K=Ye,wt=w("v-form"),St=w("dev-layout");return s(),m(St,null,{"left-aside":p(()=>[c(d,{style:{width:"200px"}},{default:p(()=>[c(d,null,{default:p(()=>[c(n,{class:"title","data-id":22222},{default:p(()=>t[5]||(t[5]=[S("添加搜索条件")])),_:1}),c(n,{class:"ctrl"},{default:p(()=>[c(r,{class:"ctrl-btn",onClick:t[0]||(t[0]=C=>o.pushFilter("input"))},{default:p(()=>t[6]||(t[6]=[S("文本框")])),_:1})]),_:1}),c(n,{class:"ctrl"},{default:p(()=>[c(r,{class:"ctrl-btn",onClick:t[1]||(t[1]=C=>o.pushFilter("select"))},{default:p(()=>t[7]||(t[7]=[S("下拉框")])),_:1})]),_:1}),c(n,{class:"ctrl"},{default:p(()=>[c(r,{class:"ctrl-btn",onClick:t[2]||(t[2]=C=>o.pushFilter("date"))},{default:p(()=>t[8]||(t[8]=[S("日期")])),_:1})]),_:1})]),_:1}),c(d,null,{default:p(()=>[c(n,{class:"title"},{default:p(()=>t[9]||(t[9]=[S("添加列表项")])),_:1}),(s(!0),b(I,null,$(Object.keys(a.ctrlMap.headers),(C,M)=>(s(),m(n,{key:`column-${M}`,class:"ctrl"},{default:p(()=>[c(r,{class:"ctrl-btn",onClick:ce=>o.pushHeaders(a.ctrlMap.headers[C].type)},{default:p(()=>[S(O(a.ctrlMap.headers[C].name),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1}),c(d,null,{default:p(()=>[c(n,{class:"title"},{default:p(()=>t[10]||(t[10]=[S("添加行按钮")])),_:1}),(s(!0),b(I,null,$(Object.keys(a.ctrlMap.buttons),(C,M)=>(s(),m(n,{key:`column-${M}`,class:"ctrl"},{default:p(()=>[c(r,{class:"ctrl-btn",onClick:ce=>o.pushRowButton(a.ctrlMap.buttons[C].type)},{default:p(()=>[S(O(a.ctrlMap.buttons[C].name),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1}),c(d,null,{default:p(()=>[c(n,{class:"title"},{default:p(()=>t[11]||(t[11]=[S("添加常规按钮")])),_:1}),(s(!0),b(I,null,$(Object.keys(a.ctrlMap.buttons),(C,M)=>(s(),m(n,{key:`column-${M}`,class:"ctrl"},{default:p(()=>[c(r,{class:"ctrl-btn",onClick:ce=>o.pushNormalButton(a.ctrlMap.buttons[C].type)},{default:p(()=>[S(O(a.ctrlMap.buttons[C].name),1)]),_:2},1032,["onClick"])]),_:2},1024))),128)),c(n,{class:"ctrl"},{default:p(()=>[c(r,{class:"ctrl-btn"},{default:p(()=>t[12]||(t[12]=[S("按钮组")])),_:1})]),_:1})]),_:1}),c(d,null,{default:p(()=>[c(n,{class:"title"},{default:p(()=>t[13]||(t[13]=[S("添加批量按钮")])),_:1}),(s(!0),b(I,null,$(Object.keys(a.ctrlMap.buttons),(C,M)=>(s(),m(n,{key:`column-${M}`,class:"ctrl"},{default:p(()=>[c(r,{class:"ctrl-btn",onClick:ce=>o.pushBatchButton(a.ctrlMap.buttons[C].type)},{default:p(()=>[S(O(a.ctrlMap.buttons[C].name),1)]),_:2},1032,["onClick"])]),_:2},1024))),128)),c(n,{class:"ctrl"},{default:p(()=>[c(r,{class:"ctrl-btn"},{default:p(()=>t[14]||(t[14]=[S("按钮组")])),_:1})]),_:1})]),_:1})]),_:1})]),main:p(()=>[(s(),m(u,V({ref:"table",key:a.key,dev:!0},a.builderSchema),null,16)),c(h),c(v,{type:"primary",onClick:o.saveSchema},{default:p(()=>t[15]||(t[15]=[S("保存页面配置")])),_:1},8,["onClick"]),t[16]||(t[16]=S("    ")),c(g,{text:"PageSchema",type:"modal"},{default:p(()=>[c(k,{data:o.getSaveSchema},null,8,["data"])]),_:1})]),"right-aside":p(()=>[a.activeIndex?(s(),m(K,{key:0},{default:p(()=>[c(B,{label:"控件类型"},{default:p(()=>[c(q,{modelValue:a.currentCtrlType,"onUpdate:modelValue":t[3]||(t[3]=C=>a.currentCtrlType=C)},{default:p(()=>[(s(!0),b(I,null,$(o.types,(C,M)=>(s(),m(F,{key:M,label:C.label,value:C.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})):E("",!0),(s(),m(wt,V({key:a.ctrlKey,modelValue:a.ctrlOptions,"onUpdate:modelValue":t[4]||(t[4]=C=>a.ctrlOptions=C)},a.ctrlSchema),null,16,["modelValue"]))]),_:1})}const Na=T(ja,[["render",Ma],["__scopeId","data-v-e5209cb7"]]),qa={name:"PageEditor",components:{FormBuilder:va,TableBuilder:Na},setup(){const e=D(!1),t=D(1),l="rtl",i=de(),a=L(()=>_.state.app.pages[i.path]);return{show:e,key:t,direction:l,pageSchema:a}}};function Va(e,t,l,i,a,o){const n=w("VIcon"),r=w("form-builder"),d=w("table-builder"),u=Xe;return s(),b(I,null,[c(n,{name:"ra-set",onClick:t[0]||(t[0]=h=>i.show=!i.show)}),c(u,{modelValue:i.show,"onUpdate:modelValue":t[1]||(t[1]=h=>i.show=h),title:"页面设计",class:"my-drawer",direction:i.direction,size:"90%","destroy-on-close":"","append-to-body":""},{default:p(()=>[i.pageSchema.formItems!==void 0?(s(),m(r,{key:0,schema:i.pageSchema},null,8,["schema"])):E("",!0),i.pageSchema.headers!==void 0?(s(),m(d,{key:1,schema:i.pageSchema},null,8,["schema"])):E("",!0)]),_:1},8,["modelValue","direction"])],64)}const Ua=T(qa,[["render",Va]]),Ha={components:{Breadcrumb:Xl,Hamburger:Yl,VButton:Be,PageEditor:Ua},data(){return{showExportPop:!1,modulesList:this.getSetting("system_module"),showJsonSchema:!1,json:"",key:0,defaultAvatar:this.getSetting("defaultAvatar")}},computed:{...Ce(["sidebar","avatar","name","nickname","nav"]),hasNewMessage(){return this.$store.state.settings.hasNewMessage},moduleName(){return this.$store.state.app.moduleName},setting(){return this.$store.state.settings},user(){return this.$store.state.user},showPageJsonSchemaIcon(){return this.$store.state.settings.showPageJsonSchema||!1}},mounted(){He("el-submenu is-active");const e=this.getSetting("navBarNotice");e.length>0&&!this.getSetting("closeNavNotice")&&this.showNotice(e)&&this.$notify({title:"提示",message:e,dangerouslyUseHTMLString:!0,duration:0,onClose:this.closeNavBarNotice}),this.setting.envColor[this.user.env]&&xt({elRef:this.$refs.header.$el,waterMark:this.user.env,color:"skyblue",size:"20"})},methods:{toggleSideBar(){this.$store.dispatch("app/toggleSideBar")},async logout(){await this.$store.dispatch("user/logout"),location.reload(`${location.origin}/#/login?redirect=${this.$route.fullPath}`)},getSetting(e){return this.$store.state.settings[e]},async closeNavBarNotice(){await this.$store.commit("settings/updateSettings",{closeNavNotice:!0}),this.closeNotice(this.getSetting("navBarNotice"))},showPopover(){this.showExportPop=!0},showNotice(e){const t="dismiss:navbar_notice";return ie.exist(t)?ie.get(t)!==e:!0},closeNotice(e){ie.set("dismiss:navbar_notice",e)},gotoMenuEdit(){var e,t,l,i;(t=(e=this.$route)==null?void 0:e.meta)!=null&&t.pageId&&window.open(location.origin+location.pathname+"#/menu/"+((i=(l=this.$route)==null?void 0:l.meta)==null?void 0:i.pageId))}}},Fa={class:"right-content"},Ja={class:"right-item"},Ga={key:0,class:"right-item"},za={class:"right-item-button",style:{padding:"0"}},Ka={class:"user-info"},Xa=["src"],Wa={class:"user-name"};function Za(e,t,l,i,a,o){const n=w("hamburger"),r=w("breadcrumb"),d=le,u=w("VIcon"),h=w("PageEditor"),v=w("v-button"),k=jt,g=Mt,F=Nt,q=Xe,B=W;return s(),m(B,{ref:"header",class:"navbar",style:yl({background:o.setting.envColor[o.user.env]})},{default:p(()=>[c(d,{span:16},{default:p(()=>[c(n,{"is-active":e.sidebar.opened,class:"hamburger-container",onToggleClick:o.toggleSideBar},null,8,["is-active","onToggleClick"]),c(r,{class:"breadcrumb-container"})]),_:1}),c(d,{span:8},{default:p(()=>[y("div",Fa,[y("div",Ja,[c(u,{name:"ra-code",onClick:o.gotoMenuEdit},null,8,["onClick"])]),o.showPageJsonSchemaIcon?(s(),b("div",Ga,[c(h)])):E("",!0),y("div",za,[c(v,{buttons:e.nav},null,8,["buttons"])]),c(F,{class:"right-item",trigger:"click"},{dropdown:p(()=>[c(g,{class:"user-dropdown"},{default:p(()=>[c(k,{icon:"oms-icon-index",onClick:t[0]||(t[0]=K=>e.$router.push("/"))},{default:p(()=>t[2]||(t[2]=[S("首页")])),_:1}),c(k,{divided:"",icon:"el-icon-switch-button",onClick:o.logout},{default:p(()=>t[3]||(t[3]=[S("退出登录")])),_:1},8,["onClick"])]),_:1})]),default:p(()=>[y("div",Ka,[y("img",{src:e.avatar?e.avatar:a.defaultAvatar,class:"user-avatar",alt:"头像"},null,8,Xa),t[1]||(t[1]=S()),y("span",Wa,O(e.nickname||e.name),1)])]),_:1})])]),_:1}),a.showJsonSchema?(s(),m(q,{key:0,"with-header":!1,size:"50%"})):E("",!0)]),_:1},8,["style"])}const Ya=T(Ha,[["render",Za],["__scopeId","data-v-99b3c688"]]),Qa={name:"SidebarLogo",props:{collapse:{type:Boolean,required:!0}},computed:{title(){return this.$store.state.settings.title},logo(){return this.$store.state.settings.logo}}},ei=["src"],ti={key:1,class:"sidebar-title"},li=["src"],ai={class:"sidebar-title"};function ii(e,t,l,i,a,o){const n=w("router-link");return s(),b("div",{class:U(["sidebar-logo-container",{collapse:l.collapse}])},[c(ml,{name:"sidebarLogoFade"},{default:p(()=>[l.collapse?(s(),m(n,{key:"collapse",class:"sidebar-logo-link",to:"/"},{default:p(()=>[o.logo?(s(),b("img",{key:0,src:o.logo,class:"sidebar-logo"},null,8,ei)):(s(),b("h1",ti,O(o.title),1)),t[0]||(t[0]=y("div",null,"系统",-1))]),_:1})):(s(),m(n,{key:"expand",class:"sidebar-logo-link",to:"/"},{default:p(()=>[o.logo?(s(),b("img",{key:0,src:o.logo,class:"sidebar-logo"},null,8,li)):E("",!0),y("h1",ai,O(o.title),1)]),_:1}))]),_:1})],2)}const oi=T(Qa,[["render",ii],["__scopeId","data-v-49084925"]]),ni={props:{to:{type:String,required:!0},newTab:{type:Boolean,required:!1}},methods:{compType(e){return Re(e)||this.newTab?"a":"router-link"},linkProps(e){return Re(e)?{is:"a",href:e,target:"_blank",rel:"noopener"}:this.newTab?{is:"a",href:this.$router.resolve(e).href,target:"_blank",rel:"noopener"}:{is:"router-link",to:e}}}};function si(e,t,l,i,a,o){return s(),m(lt(o.compType(l.to)),H(Z(o.linkProps(l.to))),{default:p(()=>[ee(e.$slots,"default")]),_:3},16)}const ri=T(ni,[["render",si]]),pi={computed:{device(){return this.$store.state.app.device}},mounted(){this.fixBugIniOS()},methods:{fixBugIniOS(){const e=this.$refs.subMenu;if(e){const t=e.handleMouseleave;e.handleMouseleave=l=>{this.device!=="mobile"&&t(l)}}}}},di={class:"menu-content"},ci=N({__name:"MenuContent",props:{meta:{type:Object,default:()=>({icon:"",title:""})}},setup(e){return(t,l)=>{const i=w("VIcon");return s(),b(I,null,[c(i,{name:e.meta.icon||"ra-all"},null,8,["name"]),y("span",di,O(e.meta.title),1)],64)}}}),ui={name:"SidebarItem",components:{AppLink:ri,MenuContent:ci},mixins:[pi],props:{item:{type:Object,required:!0},isNest:{type:Boolean,default:!1},to:{type:String,default:""}},methods:{itemClick(){ie.remove("table_filter:"+this.$props.to)},getTo(e){try{return this.$router.resolve(e.redirect?e.redirect:e).fullPath}catch{return console.error("路由解析错误"),"/"}}}},mi={key:0,class:"menu-wrapper"};function hi(e,t,l,i,a,o){const n=w("menu-content"),r=Lt,d=w("app-link"),u=w("sidebar-item",!0),h=Dt;return l.item.hidden!==!1?(s(),b("div",mi,[l.item.meta&&l.item.meta.menuType===2?(s(),b(I,{key:0},[l.item.meta?(s(),m(d,{key:0,to:l.to,"new-tab":l.item.meta.newTab},{default:p(()=>[c(r,{index:l.to,class:U({"submenu-title-noDropdown":!l.isNest}),onClick:o.itemClick},{default:p(()=>[c(n,{meta:l.item.meta},null,8,["meta"])]),_:1},8,["index","class","onClick"])]),_:1},8,["to","new-tab"])):E("",!0)],64)):l.item.meta&&l.item.meta.menuType===1?(s(),m(h,{key:1,ref:"subMenu",index:l.to,class:U({"submenu-title-noDropdown":!l.isNest})},{title:p(()=>[l.item.redirect&&l.item.redirect!=="#"?(s(),m(d,{key:0,to:l.to},{default:p(()=>[c(n,{meta:l.item.meta},null,8,["meta"])]),_:1},8,["to"])):(s(),m(n,{key:1,meta:l.item.meta},null,8,["meta"]))]),default:p(()=>[(s(!0),b(I,null,$(l.item.children,v=>(s(),m(u,{key:v.path,"is-nest":!0,item:v,to:o.getTo(v),class:"nest-menu"},null,8,["item","to"]))),128))]),_:1},8,["index","class"])):E("",!0)])):E("",!0)}const fi=T(ui,[["render",hi]]);function ct(e){return e.filter(t=>{var l;return((l=t.meta)==null?void 0:l.menuType)===0?!1:(t.children&&(t.children=ct(t.children),t.children.length===0&&delete t.children),!0)})}const bi={data(){return{selected:""}},computed:{...Ce(["remoteRouter"]),filterRoutes(){let e=[];return this.remoteRouter.forEach(t=>{e=e.concat(f.cloneDeep(t.routes))}),ct(e)}},methods:{getJumpPath:function(e){let t=e;if(e.meta.menuType===1&&e.children&&e.children.length>0){for(let l=0;l<e.children.length;l++)if(e.children[l].path.indexOf("/:")===-1){t=e.children[l];break}}return this.$router.resolve(t.redirect?t.redirect:t).fullPath},onselected:function(e){this.$router.push(e),this.selected=""}}};function yi(e,t,l,i,a,o){const n=xe,r=Rt,d=Ee;return s(),m(d,{modelValue:a.selected,"onUpdate:modelValue":t[0]||(t[0]=u=>a.selected=u),filterable:"",placeholder:"搜索菜单...",class:"search-menu",onChange:o.onselected},{default:p(()=>[(s(!0),b(I,null,$(o.filterRoutes,u=>(s(),b(I,{key:u.path},[u.children!==void 0?(s(),b(I,{key:0},[u.meta.menuType!==0?(s(),m(r,{key:u.path+"-",label:u.meta.title},{default:p(()=>[(s(!0),b(I,null,$(u.children,(h,v)=>(s(),b(I,{key:h.path},[u.meta.menuType!==0?(s(),m(n,{key:0,label:(v===u.children.length-1?"└─":"├─")+h.meta.title,value:o.getJumpPath(h)},null,8,["label","value"])):E("",!0)],64))),128))]),_:2},1032,["label"])):E("",!0)],64)):(s(),m(n,{key:1,label:""+u.meta.title,value:o.getJumpPath(u)},null,8,["label","value"]))],64))),128))]),_:1},8,["modelValue","onChange"])}const vi=T(bi,[["render",yi],["__scopeId","data-v-8439744e"]]);var R=(e=>(e[e.custom=0]="custom",e[e.list=1]="list",e[e.form=2]="form",e[e.customSchema=3]="customSchema",e[e.localComp=4]="localComp",e[e.tree=5]="tree",e[e.report=6]="report",e[e.entity=7]="entity",e))(R||{}),P=(e=>(e[e.hidden=0]="hidden",e[e.dir=1]="dir",e[e.menu=2]="menu",e[e.page=3]="page",e))(P||{});const gi=N({components:{SidebarItem:fi,Logo:oi,SearchMenu:vi},computed:{...Ce(["sidebar","remoteRouter","customRouter"]),routes(){let e=[];return this.$router.options.routes.concat(this.customRouter||[]).forEach(t=>{t.path==="/"?e=e.concat(t.children||[]):e.push(t)}),f.cloneDeep([{label:"",routes:e},...this.remoteRouter])},activeMenu(){const e=this.$route.matched;for(let t=e.length-1;t>=0;t--){const l=e[t];if(l.meta.menuType===P.menu)return this.showActive(),this.$router.resolve(l.redirect?l.redirect:l).fullPath}return""},showLogo(){return this.$store.state.settings.sidebarLogo},variables(){return{menuBg:"#304156",menuText:"#bfcbd9",menuActiveText:"#409EFF"}},isCollapse(){return!this.sidebar.opened}},mounted(){this.showActive()},methods:{showActive(){He("is-active",200)},filterRoute(e){return e.filter(t=>[P.dir,P.menu].indexOf(t.meta.menuType)!==-1).map(t=>(t=Object.assign({},t),t.children&&(t.children=this.filterRoute(t.children)),t))}}});function ki(e,t,l,i,a,o){const n=w("logo"),r=w("search-menu"),d=w("sidebar-item"),u=qt,h=Vt;return s(),b("div",{class:U({"has-logo":e.showLogo})},[e.showLogo?(s(),m(n,{key:0,collapse:e.isCollapse},null,8,["collapse"])):E("",!0),c(h,{"wrap-class":"scrollbar-wrapper"},{default:p(()=>[e.isCollapse?E("",!0):(s(),m(r,{key:0})),c(u,{"default-active":e.activeMenu,collapse:e.isCollapse,"background-color":e.variables.menuBg,"text-color":e.variables.menuText,"unique-opened":!1,"active-text-color":e.variables.menuActiveText,"collapse-transition":!1,mode:"vertical"},{default:p(()=>[(s(!0),b(I,null,$(e.routes,(v,k)=>(s(),b(I,{key:k+"-module"},[(s(!0),b(I,null,$(e.filterRoute(v.routes),g=>(s(),m(d,{key:g.path,item:g,to:e.$router.resolve(g.redirect?g.redirect:g).fullPath},null,8,["item","to"]))),128))],64))),128))]),_:1},8,["default-active","collapse","background-color","text-color","active-text-color"])]),_:1})],2)}const _i=T(gi,[["render",ki],["__scopeId","data-v-d252f828"]]),wi={class:"app-main"},Si={__name:"AppMain",setup(e){const t=de(),l=[],i=D(0);return Wt(()=>{var a;(a=t.meta)!=null&&a.keepAlive&&l.indexOf(t.name)&&l.push(t.name),i.value++}),(a,o)=>{const n=w("router-view"),r=Ut;return s(),b("section",wi,[(s(),m(n,{key:a.$route.fullPath+x(i)})),c(r,{bottom:50})])}}},xi=T(Si,[["__scopeId","data-v-ca0f0d98"]]),Ei={class:"main-container"},Ii=992,Ti={__name:"index",setup(e){const t=Qe(),{body:l}=document,i=L(()=>t.state.app.sidebar),a=L(()=>t.state.app.device),o=L(()=>t.state.settings.fixedHeader),n=L(()=>({hideSidebar:!i.value.opened,openSidebar:i.value.opened,withoutAnimation:i.value.withoutAnimation,mobile:a.value==="mobile"})),r=()=>l.getBoundingClientRect().width-1<Ii;al(window,"resize",()=>u());const d=()=>{t.dispatch("app/closeSideBar",{withoutAnimation:!1})},u=()=>{if(!document.hidden){const h=r();t.dispatch("app/toggleDevice",h?"mobile":"desktop"),h&&t.dispatch("app/closeSideBar",{withoutAnimation:!0})}};return(h,v)=>(s(),b("div",{class:U([x(n),"app-wrapper"])},[x(a)==="mobile"&&x(i).opened?(s(),b("div",{key:0,class:"drawer-bg",onClick:d})):E("",!0),c(x(_i),{class:"sidebar-container"}),y("div",Ei,[y("div",{class:U({"fixed-header":x(o)})},[c(x(Ya))],2),c(x(xi))])],2))}},ut=T(Ti,[["__scopeId","data-v-4e09424c"]]),Ci={id:"login"},Bi={id:"form"},Oi={key:0,class:"captcha"},$i=["src"],Ai={class:"tips"},Pi={class:"sso"},Li=N({__name:"login",setup(e){const t=et(),l=de(),i=L(()=>_.state.settings.loginTips),a=L(()=>_.state.settings.captcha),o=L(()=>(_.state.app,_.state.app.baseURL)),n=D(0),r=()=>n.value++,d=L(()=>u.value.username.length>0&&u.value.password.length>=4&&(a.value?u.value.captcha.length===4:!0)),u=D({username:"",password:"",captcha:"",sing:""}),h=()=>{if(u.value.username===""||u.value.password===""||a.value&&u.value.captcha===""){ze.error("用户名, 密码, 验证码是必须的");return}a.value&&(u.value.sing=ol.MD5(`${u.value.username}${u.value.password}${u.value.captcha}`).toString()),_.dispatch("user/login",u.value).then(v=>{var k;t.push({path:((k=l.query)==null?void 0:k.redirect)||"/"})}).catch(v=>{n.value++})};return(v,k)=>(s(),b("div",Ci,[k[4]||(k[4]=y("h1",{id:"title"},"登录",-1)),y("form",Bi,[ne(y("input",{"onUpdate:modelValue":k[0]||(k[0]=g=>x(u).username=g),type:"text",placeholder:"用户名",class:"input"},null,512),[[me,x(u).username]]),ne(y("input",{"onUpdate:modelValue":k[1]||(k[1]=g=>x(u).password=g),type:"password",placeholder:"密码",class:"input"},null,512),[[me,x(u).password]]),a.value?(s(),b("div",Oi,[ne(y("input",{"onUpdate:modelValue":k[2]||(k[2]=g=>x(u).captcha=g),type:"text",placeholder:"验证码",class:"input-captcha"},null,512),[[me,x(u).captcha]]),y("img",{class:"captcha-img",src:o.value+"/user/captcha?ts="+x(n),title:"点击刷新",onClick:r},null,8,$i)])):E("",!0),y("div",{class:U({input:!0,button:!0,"no-ready":!d.value}),onClick:h},"登录",2),y("div",Ai,[y("div",null,O(i.value),1)]),y("div",Pi,[k[3]||(k[3]=y("div",{id:"sso-qrcode"},null,-1)),(s(!0),b(I,null,$(Object.keys([]),g=>(s(),b("div",{key:g},O(g),1))),128))])])]))}}),Di={name:"NotFoundPage"},Ri={class:"not-found"};function ji(e,t,l,i,a,o){return s(),b("div",Ri,t[0]||(t[0]=[y("svg",{width:"380px",height:"500px",viewBox:"0 0 837 1045",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:sketch":"http://www.bohemiancoding.com/sketch/ns"},[y("g",{id:"Page-1",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd","sketch:type":"MSPage"},[y("path",{id:"Polygon-1",d:"M353,9 L626.664028,170 L626.664028,487 L353,642 L79.3359724,487 L79.3359724,170 L353,9 Z",stroke:"#007FB2","stroke-width":"6","sketch:type":"MSShapeGroup"}),y("path",{id:"Polygon-2",d:"M78.5,529 L147,569.186414 L147,648.311216 L78.5,687 L10,648.311216 L10,569.186414 L78.5,529 Z",stroke:"#EF4A5B","stroke-width":"6","sketch:type":"MSShapeGroup"}),y("path",{id:"Polygon-3",d:"M773,186 L827,217.538705 L827,279.636651 L773,310 L719,279.636651 L719,217.538705 L773,186 Z",stroke:"#795D9C","stroke-width":"6","sketch:type":"MSShapeGroup"}),y("path",{id:"Polygon-4",d:"M639,529 L773,607.846761 L773,763.091627 L639,839 L505,763.091627 L505,607.846761 L639,529 Z",stroke:"#F2773F","stroke-width":"6","sketch:type":"MSShapeGroup"}),y("path",{id:"Polygon-5",d:"M281,801 L383,861.025276 L383,979.21169 L281,1037 L179,979.21169 L179,861.025276 L281,801 Z",stroke:"#36B455","stroke-width":"6","sketch:type":"MSShapeGroup"})])],-1),y("div",{class:"message-box"},[y("h1",null,"404"),y("p",null,"Page not found"),y("div",{class:"buttons-con"},[y("div",{class:"action-link-wrap"},[y("a",{href:"",class:"link-button"},"Go to Home Page")])])],-1)]))}const Mi=T(Di,[["render",ji],["__scopeId","data-v-26068803"]]),Ni=[{path:"/",component:ut,redirect:"/dashboard",name:"Root",meta:{menuType:1},children:[{path:"dashboard",name:"Dashboard",component:Fl,meta:{title:"Dashboard",icon:"el-icon-help",menuType:2,keepAlive:!0}}]},{path:"/login",component:Li,meta:{title:"用户登录",menuType:0},hidden:!0},{path:"/404",component:Mi,meta:{menuType:0},hidden:!0}],G=Kt({history:Xt(),routes:Ni});ve.configure({showSpinner:!1});function qi(e){e.beforeEach((t,l,i)=>{ve.start(),t.preHash=location.hash.replace("#",""),i()}),e.afterEach(t=>{t.matched.length>0&&_.commit("user/updateState",{key:"path",value:t.matched[t.matched.length-1].path.replace("(\\d+)","")}),ve.done()})}function Vi(){return _.state.user.isLodeRemoteRoutes}function mt(){return _.state.settings.whiteRoutes||[]}function Ui(){return _.state.user.token}const Hi={};function Fi(){return f.merge(_.state.settings.sso||{},Hi)}function Ji(){const e=Fi(),t=_.state.settings.activeSsoKey||"",l=e[t];if(l!==void 0)return l()}function Gi(e){e.beforeEach(async(t,l,i)=>{var a,o;if(mt().indexOf(t.path)!==-1){i();return}if(Ui()){(a=t.query)!=null&&a.redirect?i((o=t.query)==null?void 0:o.redirect):i();return}const n=t.query.redirect||t.path,r=Ji();if(!r){i(`/login?redirect=${n}`);return}const d=r.flag();if(d&&await _.dispatch("user/login",f.isObject(d)?d:{ticket:d})){i();return}r.jumpToLoginPage(i,`/login?redirect=${n}`)})}const zi={},Ki={class:"loading preloader"};function Xi(e,t){return s(),b("div",Ki,t[0]||(t[0]=[y("div",{class:"preloader-inner"},null,-1)]))}const ht=T(zi,[["render",Xi]]),Wi={name:"VNotice",props:{dataApi:{type:String,default:""},notice:{type:Object,default:()=>{}}},data(){return{noticeProps:{},hasNotice:!1}},mounted(){if(this.$props.dataApi,this.$props.dataApi){this.$http.get(this.$props.dataApi).then(({data:e})=>{this.noticeProps=e,this.hasNotice=!!e});return}else this.hasNotice=Object.keys(this.$props.notice).length>0,this.noticeProps=this.$props.notice}};function Zi(e,t,l,i,a,o){const n=Ie;return s(),b("div",null,[a.hasNotice?(s(),m(n,H(V({key:0},a.noticeProps)),null,16)):E("",!0)])}const ft=T(Wi,[["render",Zi]]),Yi=N({components:{VLoading:ht,VNotice:ft},props:{schemaHandler:{type:Function,default:function(e,t){return e}},schemaApi:{type:String,default:""}},data(){return{loading:!0,haveNotice:!1,notice:{},noticeApi:"",schema:{},owners:[],serviceOffLine:!1}},computed:{env(){return this.$store.state.user.env},setting(){return this.$store.state.settings}},beforeCreate(){const e=this.$route.path.split("/").filter(a=>a),t=e.length>1?e.slice(0,e.length-1).join("/"):e[0],l="/schema"+this.$route.meta.path,i={params:this.$route.params};this.$http.get(this.$props.schemaApi||l,i).then(({data:a})=>{this.loading=!1,X(a)&&(a.notice!==void 0&&(this.haveNotice=!0,Se(a.notice)?this.notice={title:a.notice}:X(a.notice)&&(this.notice=a.notice,this.noticeApi=a.notice.noticeApi),delete a.notice),this.owners=a.ownerNames||[],this.serviceOffLine=a.serviceOffLine||!1),this.schema=this.$props.schemaHandler(a,t),_.commit("app/SET_PAGE_JSON_SCHEMA",{page:this.$route.path,json:this.schema})})}}),Qi=["innerHTML"];function eo(e,t,l,i,a,o){const n=Ie,r=ft,d=ht;return s(),b(I,null,[e.owners.length>0?(s(),m(n,{key:0,title:`该页面功能对应开发: [ ${e.owners.join(", ")} ] 有问题可直接企微反馈`,type:"info",style:{margin:"0 0 20px 0"},closable:!1},null,8,["title"])):E("",!0),e.env==="prod"&&e.serviceOffLine?(s(),b("div",{key:1,class:"offline-notice",innerHTML:e.serviceOffLine===!0?e.setting.serviceOffLineNotice:e.serviceOffLine},null,8,Qi)):(s(),b(I,{key:2},[e.haveNotice?(s(),m(r,{key:0,notice:e.notice,style:{margin:"0 0 20px 0"},"data-api":e.noticeApi},null,8,["notice","data-api"])):E("",!0),e.loading?(s(),m(d,{key:1})):ee(e.$slots,"default",H(V({key:2},e.schema)),void 0,!0)],64))],64)}const ae=T(Yi,[["render",eo],["__scopeId","data-v-4965a709"]]),bt={__name:"table",setup(e){const t=(l,i)=>{if(l.orderBy){const o={prop:l.orderBy.field,order:l.orderBy.mod==="desc"?"descending":"ascending"};l.tableProps=f.merge(l.tableProps,{defaultSort:o})}const a=Object.keys(te.props);return Object.keys(l).forEach(o=>{a.indexOf(o)===-1&&delete l[o]}),l.listApi===void 0&&(l.listApi=`/${i}/list`),l};return(l,i)=>(s(),m(ae,{"schema-handler":t},{default:p(a=>[c(x(te),H(Z(a)),null,16)]),_:1}))}},_e={__name:"form",setup(e){const t=de(),l=et(),i=(r,d)=>{const u=Object.keys(J.props);return Object.keys(r).forEach(h=>{if(u.indexOf(h)===-1){delete r[h];return}/.*Api$/.test(h)&&(r[h]=oe(r[h],t.params))}),r.saveApi===void 0&&(t.params.id!==void 0?(r.saveApi=`/${d}/update/${t.params.id}`,r.getApi||(r.getApi=`/${d}/get/${t.params.id}`)):(delete r.getApi,r.saveApi=`/${d}/create`)),r=f.merge({saveApi:d+"/save",afterSubmit:"goback",afterReset:"goback",mod:t.params.id?"edit":"create"},r),r},a=D(0),o=()=>{_t.request({url:"/form_mutex",method:"get",params:{path:t.fullPath}}).then(r=>{r.data&&(clearInterval(a.value),Ke.alert(`${r.data}`,"操作提醒",{showClose:!1,showCancelButton:!0,confirmButtonText:"返回",cancelButtonText:"刷新",callback:d=>{d==="cancel"?location.reload():n()}}))})};at(()=>{t.params.id!==void 0&&_.state.settings.formMutex&&(o(),a.value=setInterval(o,2e3))}),sl(()=>{clearInterval(a.value)});function n(){var r,d;(r=t.query)!=null&&r.goback?l.push((d=t.query)==null?void 0:d.goback):history.state.back&&history.back()}return(r,d)=>(s(),m(ae,{"schema-handler":i},{default:p(u=>[c(x(J),H(Z(u)),null,16)]),_:1}))}},to=N({name:"VTree",components:{VForm:J},props:{treeApi:{type:String,default:"",require:!0},getApi:{type:String,default:"",require:!0},saveApi:{type:String,default:"",require:!0},createApi:{type:String,default:"",require:!0},deleteApi:{type:String,default:"",require:!0},formItems:{type:Array,default:()=>[]},treeProps:{type:Object,default:()=>{}},maxDepth:{type:Number,default:3},props:{type:Object,default:()=>{}}},data(){return{type:0,treeData:[],formData:{},localTreeProps:f.merge({"default-expand-all":!0,"expand-on-click-node":!1,props:{children:"children",label:"label"}},this.$props.treeProps),formkey:0,tablekey:0,menuOptions:{}}},computed:{formType(){return["","新建","编辑"][this.type]},formProps(){let e=oe(this.$props.saveApi,this.formData);return this.type===1&&(e=this.$props.createApi),{saveApi:e,getApi:this.$props.getApi,formItems:this.$props.formItems}}},created(){this.loadTree()},methods:{loadTree(){this.$http.request({method:"GET",url:this.$props.treeApi}).then(({data:e})=>{this.treeData=e})},onclick(e){this.type=2,this.formData=e,this.formkey++},append(e,t){var l,i;this.type=1;const a={pid:e.id,[((l=this.$props.props)==null?void 0:l.levelKey)??"level"]:t.level+1,...Bt((i=this.$props.props)==null?void 0:i.effectData,e)};e.children||(e.children=[]),this.formData=a,this.formkey++,e.children.push(a),this.treeData=[...this.treeData]},canAppend(e,t){return e[this.localTreeProps.props.label]?t.level<this.$props.maxDepth:!1},appendNew(){var e;this.type=1;const t={pid:0,[((e=this.$props.props)==null?void 0:e.levelKey)??"level"]:1};this.formData=t,this.formkey++,this.tablekey++,this.treeData=[...this.treeData,t]},remove(e){this.$http.request({method:"DELETE",url:oe(this.$props.deleteApi,e)}).then(({code:t})=>{t!==0?this.$message.error("操作失败"):this.loadTree()})},submit(){setTimeout(()=>{this.loadTree(),this.formData={},this.tablekey++,this.type=0},200)},allowDrap(e){return!0},allowDrop(e,t,l){return l==="inner"},handleDragEnd(e,t,l,i){const a=e.data;a.pid=t.data.id,this.$http.request({method:"POST",url:oe(this.$props.saveApi,a),data:a}).then(({code:o})=>{o!==0&&this.$message.error("操作失败")})}}}),lo={class:"card-header"},ao={class:"tree-action"},io={key:0},oo={key:1,style:{color:"#E6A23C"}},no={class:"card-header"};function so(e,t,l,i,a,o){const n=re,r=Gt,d=pe,u=le,h=w("v-form"),v=W;return s(),m(v,{class:"tree-box",gutter:20},{default:p(()=>[c(u,{span:8,class:"tree-tree"},{default:p(()=>[c(d,{shadow:"never"},{header:p(()=>[y("div",lo,[t[3]||(t[3]=y("span",null,"列表",-1)),c(n,{type:"text",onClick:t[0]||(t[0]=()=>e.appendNew())},{default:p(()=>t[2]||(t[2]=[S("添加")])),_:1})])]),default:p(()=>[(e.treeData||[]).length>0?(s(),m(r,V({key:0,style:{height:"100vh"},data:e.treeData,"node-key":"id"},e.localTreeProps,{draggable:"","allow-drag":e.allowDrap,"allow-drop":e.allowDrop,onNodeDragEnd:e.handleDragEnd}),{default:p(({node:k,data:g})=>[y("span",ao,[g[e.localTreeProps.props.label]?(s(),b("span",io,O(g[e.localTreeProps.props.label]),1)):(s(),b("span",oo,"请在右侧表单中修改 --> ")),y("span",null,[g[e.localTreeProps.props.label]?(s(),m(n,{key:0,class:"button",type:"text",onClick:()=>e.onclick(g)},{default:p(()=>t[4]||(t[4]=[S("编辑")])),_:2},1032,["onClick"])):E("",!0),e.canAppend(g,k)?(s(),m(n,{key:1,class:"button",type:"text",onClick:()=>e.append(g,k)},{default:p(()=>t[5]||(t[5]=[S("添加")])),_:2},1032,["onClick"])):E("",!0),g.children===void 0||g.children.length===0?(s(),m(n,{key:2,class:"button",type:"text",onClick:()=>e.remove(g)},{default:p(()=>t[6]||(t[6]=[S("删除")])),_:2},1032,["onClick"])):E("",!0)])])]),_:1},16,["data","allow-drag","allow-drop","onNodeDragEnd"])):E("",!0)]),_:1})]),_:1}),c(u,{span:16,class:"tree-form"},{default:p(()=>[e.type?(s(),m(d,{key:0,shadow:"never"},{header:p(()=>[y("div",no,[y("span",null,O(e.formType),1)])]),default:p(()=>[(s(),m(h,V({key:e.formkey,modelValue:e.formData,"onUpdate:modelValue":t[1]||(t[1]=k=>e.formData=k)},e.formProps,{onSubmit:e.submit}),null,16,["modelValue","onSubmit"]))]),_:1})):E("",!0)]),_:1})]),_:1})}const qe=T(to,[["render",so]]),ro={__name:"tree",setup(e){const t=(l,i)=>{const a=Object.keys(qe.props);return Object.keys(l).forEach(o=>{a.indexOf(o)===-1&&delete l[o]}),l};return(l,i)=>(s(),m(ae,{"schema-handler":t},{default:p(a=>[c(qe,H(Z(a)),null,16)]),_:1}))}},be={__name:"container",setup(e){const t=D(0);return Zt(()=>{t.value++}),(l,i)=>{const a=w("router-view");return s(),m(a)}}},po={title:{text:""},tooltip:{trigger:"axis"},grid:{left:"2%",right:"2%",bottom:"5%",containLabel:!0},toolbox:{feature:{saveAsImage:{}}},legend:{data:[]},xAxis:{type:"category"},yAxis:{type:"value"},series:[]};function co(e,t,l){if(l.length===0)return{};let i=f.merge({},po);if(i.title.text=e,Se(t)){const a=[],o=Object.keys(l[0]);let n=o[0],r=o.filter((u,h)=>h>0),d=t;if(t.indexOf(":")>-1){const u=t.split(":"),h=u[1].split(",");d=u[0],n=h[0],r=h.filter((v,k)=>k>0)}r.forEach(u=>{const h=[];l.forEach(v=>{h.push(v[u])}),i.series.push({name:u,type:d,smooth:!0,data:h}),i.legend.data.push(u)}),l.forEach(u=>{a.push(u[n])}),i.xAxis.data=a}return X(t)&&(i=f.merge(i,t)),i}const uo=N({name:"NumberPanel",props:{dataList:{type:Array,default:e=>[]}},data(){return{}}}),mo={class:"number-panel-title"},ho={class:"number"},fo={class:"name"};function bo(e,t,l,i,a,o){return s(!0),b(I,null,$(e.dataList,(n,r)=>(s(),b("span",{key:r},[y("div",mo,[(s(!0),b(I,null,$(Object.keys(n),(d,u)=>(s(),b("div",{key:u,class:"title-inner"},[y("p",ho,O(n[d]),1),y("p",fo,O(d),1)]))),128))])]))),128)}const yo=T(uo,[["render",bo],["__scopeId","data-v-cc0d8293"]]),vo={components:{Chart:tl,Md:il,Json:Oe,Table:te,Number:yo,Html:""},props:{option:{type:Object,default:()=>{}}},setup(e){const t=()=>e.option.chart==="num"?"number":e.option.type;return{compprops:l=>{const i=t();if(i==="number")return{dataList:l.data};if(i==="chart")return{options:co(l.id,l.chart,l.data)};if(i==="md")return{source:l.data};if(i==="table"){if(!Je(l.data))return{showPagination:!1};const a=[];return l.data[0]&&Object.keys(l.data[0]).forEach((o,n)=>{a.push({field:o,label:o})}),{headers:a,list:l.data,showPagination:!1}}return{}},comptype:t}}};function go(e,t,l,i,a,o){const n=pe,r=dl("resize");return ne((s(),m(n,{shadow:"never",class:"part"},{default:p(()=>[(s(),m(lt(i.comptype()),H(Z(i.compprops(l.option))),null,16))]),_:1})),[[r,!0]])}const ko=T(vo,[["render",go],["__scopeId","data-v-a5a65cc1"]]),_o=N({__name:"index",props:{filter:{type:Array,default:()=>[]},dataPart:{type:Array,default:()=>[]}},setup(e){const t=useRoute();at(()=>{});const l=e,i=D({});tt(()=>{var h;(h=l.filter)==null||h.forEach(v=>{v.default!==null&&(i.value[v.field]=v.default)})});const a={inline:!0,labelPosition:"right",labelWidth:"auto",submitButton:{text:"查询"},cancelButton:{text:"重置"}},o=D(1),n=D(l.filter),r=D(l.dataPart),d=L(()=>{let h=t.params.id;if(!h){const v=t.path.split("/");h=v[v.length-1]}return"/focusbi_report/view/"+h}),u=h=>{_t.get(d.value,{params:h}).then(({data:v})=>{n.value=v.filter,r.value=v.dataPart,o.value++})};return(h,v)=>{const k=pe,g=le,F=Ie,q=W;return s(),m(q,null,{default:p(()=>[x(n).length>0?(s(),m(g,{key:0,span:24},{default:p(()=>[c(k,{shadow:"never",class:"part-filter"},{default:p(()=>[c(x(J),{modelValue:x(i),"onUpdate:modelValue":v[0]||(v[0]=B=>fl(i)?i.value=B:null),"form-items":x(n),options:a,onSubmit:u},null,8,["modelValue","form-items"])]),_:1})]),_:1})):E("",!0),c(g,{span:24},{default:p(()=>[c(q,{gutter:20},{default:p(()=>[(s(!0),b(I,null,$(x(r),(B,K)=>(s(),m(g,{key:K,span:B.col||24},{default:p(()=>[B.errMsg?(s(),m(F,{key:1,title:B.id+" 片段执行出错",type:"error"},{default:p(()=>[S(O(B.errMsg),1)]),_:2},1032,["title"])):(s(),m(ko,{key:x(o),option:B},null,8,["option"]))]),_:2},1032,["span"]))),128))]),_:1})]),_:1})]),_:1})}}}),wo={__name:"report",setup(e){const t=useRoute(),l=L(()=>{let i=t.params.id;if(!i){const a=t.path.split("/");i=a[a.length-1]}return"/focusbi_report/view/"+i});return(i,a)=>(s(),m(ae,{"schema-api":x(l)},{default:p(o=>[c(_o,H(Z(o)),null,16)]),_:1},8,["schema-api"]))}},So=e=>c("div",null,[e.test]),xo={card:pe,form:J,table:te,test:So,row:W,col:le},Eo={card:{type:"card",props:{class:"render-card",shadow:"never"}},form:{type:"form",props:{afterReset:""}},table:{type:"table",props:{syncUrl:!1}}};function Io(e){const t=Object.assign({},e),l=t.type.split(".").reverse(),i=t.span||24;delete t.span;let a={...t,type:l[0]};for(let o=1;o<l.length;o++)a={type:l[o],children:[a]};return a.span=i,De([a])}function De(e){const t={type:"row",props:{gutter:20,class:"render-row"},children:[]};return e.forEach(l=>{var i,a;let o=Object.assign({},l);if(X((i=o.props)==null?void 0:i.style)){let d="";Object.keys((a=o.props)==null?void 0:a.style).forEach(u=>{var h;d+=u+":"+((h=o.props)==null?void 0:h.style[u])+";"}),o.props.style=d}const n={span:o.span??24,class:"render-col"};if(delete o.span,o.type.indexOf(".")>0){t.children.push({type:"col",props:n,children:Io(o)});return}o=f.merge({props:{}},Eo[o.type]||{},o);const r=yt(o.children);r.length&&(o.children=De(r)),t.children.push({type:"col",props:n,children:[o]})}),[t]}function yt(e){return Je(e)?e:X(e)?[e]:[]}let we={};const vt=e=>{const t=xo[e.type]||we[e.type]||e.type;return pl(t,e.props,{default:()=>yt(e.children).map(l=>vt(l))})},To=e=>(Object.keys(we).length===0&&(we=rl().appContext.components),De(Object.values(e.schema)).map(t=>vt(t))),Co={__name:"custom",setup(e){const t=D([]),l=(i,a)=>(t.value=bl(i),i);return(i,a)=>(s(),m(ae,{"schema-handler":l},{default:p(()=>[c(x(To),{schema:x(t)},null,8,["schema"])]),_:1}))}};let Q={};function Sn(e){Q=e}const Bo=e=>{const t=l=>{const i="./views/"+l+".vue";return Q&&Q[i]&&Q[i].default?Q[i].default:(console.error(`自定义组件不存在 ${e.name} ${e.view}`),be)};if(e.path==="#")return be;switch(e.page_type){case R.list:return bt;case R.form:return _e;case R.custom:case R.localComp:return t(e.view||"");case R.tree:return ro;case R.report:return wo;case R.customSchema:return Co}return be};function Oo(e){let t=e.path;return e.type===P.menu&&e.page_type===R.entity&&(t="#"),t.indexOf(":id")>-1&&t.indexOf(":id")+3===t.length&&(t=t.replace(":id",":id(\\d+)")),t==="#"?"/"+e.id+"_DIR_"+e.name:t[0]!=="/"?"/"+t:t}function $o(e){return(e.path+e.name).split("/").filter(t=>t).join("_")}const gt=e=>{const t=e.type!==P.page,l={path:Oo(e),name:e.id+"_"+$o(e)+"_"+e.path.replaceAll("/","_"),component:Bo(e),meta:{id:e.id,pageId:e.id,title:e.name,icon:e.icon,hidden:!t,path:e.path,menuType:e.type,keepAlive:!1},children:e.children?e.children.map(i=>gt(i)):[]};if(e.page_type===R.entity){const i=e.path+"/list",a=e.path+"/form",o=e.path+"/:id",n=[{path:i,name:e.name+"列表"+e.id,component:bt,meta:{id:e.id+99999,title:"列表",hidden:!0,menuType:P.hidden,keepAlive:!1,pageId:e.id,path:e.path}},{path:a,name:e.name+"新建"+e.id,component:_e,meta:{id:e.id+99999+1,title:"新建",hidden:!0,menuType:P.hidden,keepAlive:!1,pageId:e.id,path:e.path}},{path:o,name:e.name+"编辑"+e.id,component:_e,meta:{id:e.id+99999+2,title:"编辑",hidden:!0,menuType:P.hidden,keepAlive:!1,pageId:e.id,path:e.path}}];l.children=[...n,...l.children]}if(l.children&&l.children.length>0){let i=!0;if(l.children.forEach(a=>{a.meta&&!a.meta.hidden&&(i=!1)}),l.meta&&(l.meta.menuType=t?P.dir:P.hidden),i){l.meta&&(l.meta.menuType=P.menu);let a="/";for(let o=0;o<l.children.length;o++)if(l.children[o].path.indexOf("/:")===-1){a=l.children[o].path;break}l.redirect=a,l.path="/"+e.id+"_DIR"+l.redirect.replaceAll("/","_").toUpperCase()}}return l},Ao=e=>{const t=[];return e.forEach(l=>{const i={id:l.id,label:l.label,routes:[]};l.routes.forEach(a=>{i.routes.push(gt(a))}),t.push(i)}),t};function Po(e){e.beforeEach(async(t,l,i)=>{if(mt().indexOf(t.path)!==-1){i();return}if(Vi()){i();return}await _.dispatch("user/info");const a=await _.dispatch("user/loadRemoteRoutes"),o=Ao(a);o.forEach(n=>{n.routes.forEach(r=>{e.addRoute({path:"/",component:ut,children:[r]})})}),e.addRoute({name:"404",path:"/:pathMatch(.*)*",redirect:"/404",hidden:!0}),_.commit("user/updateRemoteRouter",o),await e.replace(t),i()})}function Lo(e){e.beforeEach(async(t,l,i)=>{var a;const o=[_.state.settings.title||""],n=t.matched.length;for(let r=n;r>n-3;r--){const d=t.matched[r-1];(a=d==null?void 0:d.meta)!=null&&a.title&&o.push(d.meta.title+"")}o.length>1&&(document.title=o.reverse().join("-")),i()}),e.afterEach(async(t,l,i)=>{Object.keys(t.meta).length>0&&await _.dispatch("app/setCurrentMeta",t.meta)})}function Do(e){Gi(e),qi(e),Po(e),Lo(e)}Do(G);function Ro(){return _.state.user.token}function jo(){return _.state.user.expired}function Ve(e){Ml({message:e,type:"error",duration:5*1e3,grouping:!0})}const Mo={onFulfilled:function(e){var t;e.headers=e.headers||{};const l=Ro();return l&&(e.headers["X-Token"]=l),(t=G.currentRoute.value.meta)!=null&&t.path&&(e.headers["X-Path"]=G.currentRoute.value.meta.path),e}},No={onFulfilled(e){var t,l,i,a,o,n,r;if(!(((t=e.config)==null?void 0:t.notHoldApiErr)!==void 0&&((l=e.config)==null?void 0:l.notHoldApiErr)===!0)&&e.data.code!==0){const u=e.data.message||`接口请求错误 ${e.config.method}::${(i=e.config.url)==null?void 0:i.split("?")[0]}`;if(e.data.code===401){if(jo())return;_.dispatch("user/SetExpired"),Me.alert("登录信息已过期或未登录, 是否跳转登录","操作提醒",{showClose:!1,confirmButtonText:"重新登录",showCancelButton:!0,cancelButtonText:"取消",callback:h=>{h==="confirm"&&(st(),location.href=location.origin+location.pathname+location.hash.replace("#","#/?redirect="),location.reload()),_.dispatch("user/SetExpired")}});return}else Ve(u);return Promise.reject(u)}let d=(o=(a=e.data)==null?void 0:a.data)==null?void 0:o._message_box;return d!==void 0&&(Se(d)&&(d={message:(r=(n=e.data)==null?void 0:n.data)==null?void 0:r._message_box}),Me({title:"提示",type:"success",grouping:!0,...d})),e.data},onRejected(e){var t;return Te.isCancel(e)?Promise.reject(""):(Ve(`${e.message} ${e.config.method}::${(t=e.config.url)==null?void 0:t.split("?")[0]}`),Promise.reject(e))}},qo=[{request:ql,response:Vl},{request:Mo,response:No}];function kt(e={}){const t=$e.axios||{},l=f.merge(t,e||{}),i=Te.create({...l});return qo.forEach(a=>{i.interceptors.request.use(a.request.onFulfilled,a.request.onRejected),i.interceptors.response.use(a.response.onFulfilled,a.response.onRejected)}),i}const _t=kt(),Vo={beforeMount(e,t){e.clickOutsideEvent=function(l){e===l.target||e.contains(l.target)||t.value(l,e)},document.body.addEventListener("click",e.clickOutsideEvent)},unmounted(e){document.body.removeEventListener("click",e.clickOutsideEvent)}},z=ll(),Uo={mounted:(e,t)=>{e!==null&&(t.value,e.oncontextmenu=l=>{l.preventDefault(),l.stopPropagation(),l.cancelBubble=!0,t.value&&z.emit("right-click",{event:l,data:t.value})})}},Ho={mounted(e){}};function Ue(e,t){let l=e[`offset${t}`],i=e.offsetParent;for(;i;)l+=i[`offset${t}`],i=i.offsetParent;return l}const Fo={mounted:(e,t)=>{if(e===null||!t.value.dev)return;let l=e;if(t.value.parent)for(let d=0;d<t.value.parent;d++)l.parentElement&&(l=l.parentElement);l.classList.add("devtool-hover");const i=document.createElement("i");i.className="devtool-item-wrapper",l.onmouseover=()=>{i.style.height=l.offsetHeight+30+"px",i.style.width=l.offsetWidth+30+"px",i.style.top=Ue(l,"Top")-15+"px",i.style.left=Ue(l,"Left")-15+"px"};const a=document.createElement("span");a.className="dev-action-edit",a.title="编辑";const o=document.createElement("i");o.className="iconfont ra-editor1",a.appendChild(o),a.onclick=d=>{z.emit("dev-action",{event:d,data:{type:"edit",devId:t.value.devId}})},i.appendChild(a);const n=document.createElement("span");n.className="dev-action-del",n.title="删除";const r=document.createElement("i");r.className="iconfont ra-cut",n.appendChild(r),n.onclick=d=>{z.emit("dev-action",{event:d,data:{type:"del",devId:t.value.devId}})},i.appendChild(n),l.insertBefore(i,l.firstChild)}},Jo=Object.freeze(Object.defineProperty({__proto__:null,devtool:Fo,outClick:Vo,resize:Ho,rightClick:Uo},Symbol.toStringTag,{value:"Module"}));let ye;function xn(e){const t=f.merge($e,e),l=cl(vl),i=Yo(t),a=t.plugins||[];a.unshift(i),a.forEach(o=>{Zo(l,o)}),t!=null&&t.mock&&Cl(),ye=kt(t.axios),_.dispatch("setHttp",ye).then(),_.dispatch("settings/updateSettings",e==null?void 0:e.settings).then(),_.dispatch("app/setBaseAPI",t==null?void 0:t.axios.baseURL).then(),l.config.globalProperties.$http=ye,l.config.globalProperties.$router=G,window.App=l,window.OmsOptions=t,el(()=>({"X-Token":Pe()})),G.isReady().then(()=>l.mount("#app"))}function Go(e,t={}){Object.keys(t).forEach(l=>{e.component(l,t[l])})}function zo(e=[]){e.forEach(t=>{G.addRoute(t)}),_.commit("user/setCustomRoutes",e)}function Ko(e,t){t.forEach(l=>{X(l)&&(l=[l]),e.use(...l)})}function Xo(e,t={}){Object.keys(t).forEach(l=>{e.directive(l,t[l])})}function Wo(e={}){const t=["app","settings","user"];Object.keys(e).forEach(l=>{if(t.indexOf(l)!==-1){console.warn(`storeModule name [${l}] is use by base, please change it!`);return}_.registerModule(l,e[l])})}function Zo(e,t){Go(e,t.components||{}),zo(t.routes||[]),Ko(e,t.use||[]),Xo(e,t.directives||{}),Wo(t.storeModules||{}),ot(t.mockApis||[])}function Yo(e){var t;return{components:{VIcon:Qt},directives:Jo,use:[_,G,[$t,{locale:Ge,...(t=e.settings)==null?void 0:t.ElementPlus}]]}}export{xn as a,wn as d,Sn as h,ut as y};
