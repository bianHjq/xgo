import"./vue-D1V_xUgO.js";import{A as He,X as Tt,f as oe,D as Ct,p as Bt,_ as W,z as Ot,K as $t,E as we,a as Fe,P as Re,w as se,Y as At,b as Ge}from"./okiss-utils-BRUUlOco.js";import{_ as ue}from"./mockjs-CTz19t_U.js";import{e as Pt,l as f}from"./lodash-Dj6doGg4.js";import{n as Je,i as Lt,E as Ke,a as ze,b as Dt,c as Rt,d as We,e as jt,f as Mt,g as xe,h as Nt,j as Ee,k as Xe,l as pe,m as Ze,o as Ye,p as le,q as X,r as qt,s as Vt,t as Ut,u as Ht,v as Ft,w as Gt,x as Jt,y as Kt,z as zt,A as Ie,B as de,C as Wt}from"./element-plus-Zm8lZR6G.js";import{a as Te}from"./axios-BimPEqV4.js";import{a as j}from"./js-cookie-Cz0CWeBA.js";import{c as Xt,m as Ce,u as Qe}from"./vuex-DAdqDM8i.js";import"./dayjs-DZPVkzsk.js";import{c as Zt,a as Yt,u as et,b as ae,o as Qt,d as el}from"./vue-router-DmVufKp2.js";import{c as tl}from"./path-to-regexp-YwZaBUfe.js";import{W as Be,j as ll,q as al,K as G,Y as Oe,G as te,u as il}from"./okiss-vbtf-CT-ObyRg.js";/* empty css                      */import{A as ol}from"./mitt-CFsvvMtH.js";import{j as sl}from"./vueuse-core-DH4i1tOW.js";import{R as nl}from"./vue3-markdown-it-BdoRd0_m.js";import{a as rl}from"./crypto-js-DFuDHw7_.js";import{k as ve}from"./nprogress-0hbLWlTz.js";import{h as N,c as L,j as n,k as b,l as y,s as ne,v as E,F as I,I as $,f as tt,p as pl,L as _,n as m,y as c,x as w,q as p,m as V,R as lt,S as at,r as ee,O as Z,t as it,o as ot,z as dl,g as cl,K as ul,P as ml}from"./vue-runtime-core-PAxl9zI8.js";import{f as hl,e as me,a as fl,T as bl}from"./vue-runtime-dom-B3ryxYgL.js";import{r as D,u as x,b as yl,i as vl,e as gl}from"./vue-reactivity-D0wsZnqi.js";import{n as U,t as O,f as kl,j as H}from"./vue-shared-vVMwlSE8.js";String.prototype.format||(String.prototype.format=function(){const e=arguments;return this.replace(/{(\d+)}/g,function(t,l){return typeof e[l]<"u"?e[l]:t})});const _l=N({__name:"App",setup(e){var t,l,i,a;return tt(()=>{var o;const s=document.getElementById("preloader");s!==null&&(document.body.removeChild(s),(o=document.getElementById("preloader"))==null||o.remove(),Ot("test-icon","//at.alicdn.com/t/font_2246548_zclaqxwmzq8.css"),$t(`.iconfont {
      font-size: 19px;
      font-style: normal;
      -webkit-font-smoothing: antialiased;
      font-family: iconfont !important;
    }`))}),(l=(t=window==null?void 0:window.OmsOptions)==null?void 0:t.form)!=null&&l.vsPath&&pl("vsPath",(a=(i=window==null?void 0:window.OmsOptions)==null?void 0:i.form)==null?void 0:a.vsPath),(o,s)=>{const r=_("router-view");return n(),m(r)}}});var Y=(e=>(e.GET="get",e.POST="post",e.DELETE="delete",e.FETCH="fetch",e.OPTION="option",e.PUT="put",e))(Y||{});const Sl={saveApi:"/save",afterSubmit:"",afterReset:"goback",options:{column:3,submitButton:{text:"提交"},cancelButton:{text:"取消",on:{click:"() => console.error(33333333)"}}},formItems:[{type:"radio",field:"radio",label:"单选框",info:'表单控件支持提示信息, 可写html <a class="el-link el-link--primary is-underline" target="_blank" href="http://github.com/daodao97">文档</a>',options:[{value:1,label:"选项1"},{value:2,label:"选项2"}],value:1,col:{span:12}},{type:"input",field:"input",label:"输入框",value:5,props:{maxlength:10,suffixIcon:"el-icon-date",slots:{prepend:"前缀"},showCopy:!0,prefixIcon:"el-icon-search"},rules:[{required:!0,message:"该项为必填项"}],depend:{field:"radio",value:1},computed:[{when:"aaa",set:{checkbox:{value:[1]}}},{when:"bbb",set:{checkbox:{value:[2,3]}}}],info:"当前控件依赖 单选框 的值, 仅在 选项1 下显示",col:{span:12}},{type:"number",field:"number",label:"数字",props:{step:2},computed:{when:4,set:{range_number:{label:"数字区间2"}}},col:{span:12},value:4},{type:"number-range",field:"range_number",label:"数字区间",col:{span:12}},{type:"checkbox",field:"checkbox",label:"复选框",value:[],options:[{value:1,label:"复选框1"},{value:2,label:"复选框2"},{value:3,label:"复选框3"}],info:"动态计算, 当 输入框 字段的值 为 aaa 时, 复选框1将被选中, 为 bbb 时, 复选框2,3 将被选中",col:{span:8}},{type:"date",field:"date",label:"日期",props:{disabled:!0},info:"禁用控件",col:{span:8}},{type:"date",field:"date_range",label:"日期范围",value:"",props:{type:"daterange",rangeSeparator:"~",startPlaceholder:"开始日期",endPlaceholder:"结束日期"},col:{span:8}},{type:"time",field:"time",label:"时间"},{type:"time",field:"time_range",label:"时间范围",props:{isRange:!0}},{type:"datetime",field:"datetime",label:"日期时间"},{type:"datetime",field:"datetime_range",label:"日期时间范围",props:{type:"datetimerange"}},{type:"select",field:"select",label:"下拉框",options:[{value:1,label:"选项1"},{value:2,label:"选项2"},{value:3,label:"选项3"},{value:4,label:"选项4"}],props:{selectApi:"/user/select"}},{type:"switch",field:"switch",label:"开关"},{type:"slider",field:"slider",label:"滑块"},{type:"upload",field:"upload",label:"上传",value:"http://qupinapptest.oss-cn-beijing.aliyuncs.com/1/202002/d81d3c9dc7c3df7590d333f783a97995.jpeg",props:{}},{type:"upload",field:"upload_multiple",label:"上传多张",props:{limit:3}},{type:"transfer",field:"transfer",label:"穿梭框",options:[{value:1,label:"备选项1"},{value:2,label:"备选项2"},{value:3,label:"备选项3"}],value:[]},{type:"color",field:"color",label:"颜色"},{type:"rate",field:"rate",label:"评分",value:3},{type:"sub-form",field:"sub_form",label:"多项子表单",props:{repeat:!0,formItems:[{type:"input",field:"sub_input",label:"输入框",rules:[{required:!0,message:"子表单的校验将在上层表单校验通过后执行"}],info:"input 输入框支持 mask",props:{mask:"99-9999999"}},{type:"input",field:"sub_input_1",label:"输入框1"}]}},{type:"sub-form",field:"sub_form_not_repeat",label:"子表单",props:{options:{inline:!0},formItems:[{type:"input",field:"sub_input",label:"输入框",rules:[{required:!0,message:"子表单的校验将在上层表单校验通过后执行"}]},{type:"input",field:"sub_input_1",label:"输入框1"}]}},{type:"icon-select",field:"icon",label:"图标"},{type:"json",field:"json",label:"json",value:'{"a":1}'},{type:"rule",field:"rule",label:"rule",value:[],props:{factorOptions:[{label:"A",value:"A"},{label:"B",value:"B"},{label:"C",value:"C"}],symbolOptions:[{label:"大于",value:">"},{label:"等于",value:"="},{label:"小于",value:"<"}]}},{type:"template",field:"p3",label:"自定义",comp:{inject:["formData"],template:'<div>{{ msg }}<br/>当前的表单数据是:<pre>{{JSON.stringify(formData, null, 2)}}</pre><el-button @click="onclick">click</el-button></div>',data:{msg:"this is custom data"},methods:{onclick:"() => { console.log(this)}"}},info:"在通用表单控件无法满足需求时, 可以编写 `template` 模板组件"}]},je=[{type:"jump",text:"跳转",target:"http://github.com/daodao97"},{type:"api",text:"请求接口",target:"/test_api",extra:{method:"POST",url:"/test_api"},props:{type:"warning"}},{type:"table",text:"表格",extra:{infoApi:"/student/list_info",listApi:"/student/list"},props:{type:"info"}},[{type:"jump",text:"跳转",target:"http://github.com/daodao97"},{type:"api",text:"请求接口",extra:{method:"POST",url:"/test_api"}}],{type:"form",text:"表单",extra:{infoApi:"/form",saveApi:"/save"},props:{type:"success"}}],wl={exportAble:!0,filter:[{field:"name",type:"input",label:"姓名"},{field:"sex",type:"select",label:"性别",options:[{value:1,label:"男"},{value:0,label:"女"}]}],headers:[{field:"name",label:"姓名",info:"表头提示"},{field:"sex",type:"enum",label:"性别",options:[{value:1,label:"男"},{value:0,label:"女"}],state:{1:"info",0:"warning"},props:{sortable:!0}},{field:"github",type:"link",label:"主页"},{field:"html",type:"html",label:"HTML"},{field:"image",type:"image",label:"头像"},{field:"json",type:"json",label:"信息"},{field:"richText",type:"rich-text",label:"信息"}],batchButton:je,rowButton:[{type:"jump",text:"编辑",target:"/user/{id}"},{type:"form",extra:{infoApi:"/user/{id}",saveApi:"/user/{id}"},props:{icon:"el-icon-edit",type:"success"}},{type:"api",extra:{method:"POST",url:"/student/{id}"},props:{icon:"el-icon-delete",type:"danger"}}],normalButton:[...Pt.cloneDeep(je),{type:"jump",target:"/user/form",props:{icon:"el-icon-plus",type:"primary"}}],selectedNotice:"当前共勾选: {selectedCount} 条",listApi:"/user/list"},xl={code:0,data:{"list|0-100":[{"id|0-1000":1,name:"@cname","sex|0-1":1,"score|0-100":60,link:"http://github.com/daodao97",image:"http://qupinapptest.oss-cn-beijing.aliyuncs.com/1/202002/d81d3c9dc7c3df7590d333f783a97995.jpeg",html:"<S>显示删除线1</S>",json:{slogan:"左手代码右手诗"},richText:"在一段文本中<突出|black|yellow>显示某些<文字|#ffffff|#000000>"}],page:{"count|1-10":2,"page|1-5":2}}},El={afterSubmit:"",afterReset:"goback",formItems:[{type:"input",label:"span12-1",col:{span:12}},{type:"input",label:"span12-1",col:{span:12}},{type:"input",label:"span6-1",col:{span:6}},{type:"input",label:"span6-1",col:{span:6}},{type:"input",label:"span"}]},Il={afterSubmit:"",afterReset:"",formItems:[{type:"input",label:"span12-1",col:{span:12}},{type:"input",label:"span12-1",col:{span:12}},{type:"input",label:"span6-1",section:"表单片段1",col:{span:6}},{type:"input",label:"span6-1",col:{span:6}},{section:"表单片段2",type:"input",label:"span"}]},Tl={form:Sl,table:wl,listMock:xl,layoutForm:El,layoutSection:Il},Cl=[{method:Y.POST,url:"/login",response(e){return{code:0,data:{name:"daodao97",token:"xxxxxxx"}}}},{method:Y.GET,url:"/user/info",response(e){return{code:0,data:{role_ids:[1],resource:[[0,20,"formItems","radio"],[0,1,2]]}}}},{url:"/user/routes",method:Y.GET,response:e=>({code:0,data:[{id:0,label:"",routes:[]}]})},{url:"/user/list",method:Y.GET,response:e=>Tl.listMock}],Bl=[...Cl],Ol={baseURL:"/api",withCredentials:!0,cacheEnable:!0},st={title:"oms",fixedHeader:!1,sidebarLogo:!0,logo:"http://assest.daodao.run/logo.png",closeNavNotice:!1,navBarNotice:"",hasNewMessage:!0,showPageJsonSchema:!1,loginTips:"",sso:{},ElementPlus:{size:"default",zIndex:3e3,locale:Je},nav:[],whiteRoutes:["/login"],tokenExpire:7*24*60*60*1e3,defaultAvatar:"http://assest.daodao.run/avatar.jpg",envColor:{uat:"gray",pre:"green"},serviceOffLineNotice:"当前页面功能正在维护, 请稍后再试~~~",formMutex:!0,captcha:!0},$e={axios:Ol,settings:st,plugins:[],mock:!1},ge={};function nt(e){e.forEach(t=>{const l=rt(t);ge[`${t.method}::${l}`]=t})}nt(Bl);function rt(e){var t;let l=e.url,i=e.baseURL||((t=$e.axios)==null?void 0:t.baseURL);return i||(i=""),typeof l=="string"?(l=("/"+i+l).split("/").filter(a=>a).join("/"),l+="(|\\?.*)$",new RegExp(l)):l}function $l(){Object.keys(ge).forEach(e=>{const t=ge[e],l=rt(t);ue.mock(l,t.method,function(i){const{url:a,type:o,body:s}=i,r=Ct(a),d=s?JSON.parse(s):{},u=t.response({query:r,data:d}),h=ue.mock(u);return Bt(a,{type:o,query:r,data:d,response:h}),ue.mock(h)})})}const Ae="oms:token";function Pe(){return j.get(Ae)||""}function Al(e){const t=new Date(new Date().getTime()+(k.state.settings.tokenExpire||864e5));return j.set(Ae,e,{expires:t})}function pt(){return j.remove(Ae)}const Pl={name:"",nickname:"",avatar:"",token:Pe(),customRouter:[],remoteRouter:[],menuRoutes:[],isLodeRemoteRoutes:!1,resource:{},roleIds:[],path:"",env:"",expired:!1},Ll={namespaced:!0,state:Pl,mutations:{updateToken(e,t){e.token=t,Al(t)},removeToken(e){e.token="",pt()},updateRemoteRouter(e,t){e.remoteRouter=t,e.isLodeRemoteRoutes=!0},setCustomRoutes(e,t){e.customRouter=e.customRouter.concat(t)},updateState(e,{key:t,value:l}){e[t]=l},resetUser(e){Object.assign({name:"",nickname:"",avatar:"",token:Pe(),customRouter:[],remoteRouter:[],menuRoutes:[],isLodeRemoteRoutes:!1,resource:{},roleIds:[],path:"",env:"",expired:!1})},SET_EXPIRED:e=>{e.expired=!e.expired}},actions:{login({commit:e,state:t,rootState:l},i){return new Promise((a,o)=>{l.http?l.http.request({url:"/user/login",method:"POST",data:i}).then(s=>{var r;e("updateToken",(r=s.data)==null?void 0:r.token),a(!0)}).catch(s=>{o(s)}):o("http client not init")})},logout({commit:e}){e("removeToken"),e("resetUser")},info({commit:e,rootState:t}){return new Promise((l,i)=>{t.http?t.http.request({url:"/user/info",method:"GET"}).then(a=>{var o,s,r,d,u,h;const v=((o=a.data)==null?void 0:o.role_ids)||[];e("updateState",{key:"name",value:(s=a.data)==null?void 0:s.name}),e("updateState",{key:"nickname",value:(r=a.data)==null?void 0:r.nickname}),e("updateState",{key:"roleIds",value:v}),e("updateState",{key:"env",value:(d=a.data)==null?void 0:d.env});const S=((u=a.data)==null?void 0:u.website)||{};e("settings/updateSettings",S,{root:!0}),!j.get("username")&&j.set("username",(h=a.data)==null?void 0:h.name),l(!0)}).catch(a=>{i(a)}):i("http client not init")})},loadRemoteRoutes({state:e,rootState:t}){return new Promise((l,i)=>{var a;(a=t.http)==null||a.request({url:"/user/routes",method:"get"}).then(o=>{if(o.code===0){const s=o.data||[];l(s)}else i("error")}).catch(o=>{i(o)})})},SetExpired({commit:e}){e("SET_EXPIRED")}}},Dl=f.cloneDeep(st),Rl={namespaced:!0,state:Dl,mutations:{updateSettings(e,t){e=f.merge(e,t)}},actions:{updateSettings({commit:e,state:t},l){e("updateSettings",l)}}},jl={sidebar:{opened:j.get("sidebarStatus")?!!j.get("sidebarStatus"):!0,withoutAnimation:!1},device:"desktop",pages:{},currentRouteMeta:{},builderSchema:{},baseURL:""},Ml={namespaced:!0,state:jl,mutations:{TOGGLE_SIDEBAR:e=>{e.sidebar.opened=!e.sidebar.opened,e.sidebar.withoutAnimation=!1,e.sidebar.opened?j.set("sidebarStatus","1"):j.set("sidebarStatus","0")},CLOSE_SIDEBAR:(e,t)=>{j.set("sidebarStatus","0"),e.sidebar.opened=!1,e.sidebar.withoutAnimation=t},TOGGLE_DEVICE:(e,t)=>{e.device=t},SET_PAGE_JSON_SCHEMA:(e,{page:t,json:l})=>{e.pages[t]=l},SET_CURRENT_META:(e,t)=>{e.currentRouteMeta=t},SET_BUILDER_SCHEMA:(e,t)=>{e.builderSchema=t},SET_BASE_API:(e,t)=>{e.baseURL=t}},actions:{toggleSideBar({commit:e}){e("TOGGLE_SIDEBAR")},closeSideBar({commit:e},{withoutAnimation:t}){e("CLOSE_SIDEBAR",t)},toggleDevice({commit:e},t){e("TOGGLE_DEVICE",t)},setPageJsonSchema({commit:e},t){e("SET_PAGE_JSON_SCHEMA",t)},setCurrentMeta({commit:e},t){e("SET_CURRENT_META",t)},setBuilderSchema({commit:e},t){e("SET_BUILDER_SCHEMA",t)},setBaseAPI({commit:e},t){e("SET_BASE_API",t)}}},Nl={currentCellItem:{}},ql={namespaced:!0,state:Nl,mutations:{SET_CURRENT_CELLITEM:(e,t)=>{e.currentCellItem=t}},actions:{setCurrentCellItem({commit:e},t){e("SET_CURRENT_CELLITEM",t)}}},k=Xt({state:void 0,getters:{http:e=>e.http,sidebar:e=>e.app.sidebar,device:e=>e.app.device,token:e=>e.user.token,avatar:e=>e.user.avatar,name:e=>e.user.name,nickname:e=>e.user.nickname,remoteRouter:e=>e.user.remoteRouter,customRouter:e=>e.user.customRouter,nav:e=>e.settings.nav,builderSchema:e=>e.app.builderSchema,currentCellItem:e=>e.builderSchema.currentCellItem},mutations:{setHttp(e,t){e.http=t}},actions:{setHttp({commit:e,state:t},l){e("setHttp",l)}},modules:{user:Ll,settings:Rl,app:Ml,builderSchema:ql}}),Vl=Ke,Me=ze,Ul=Te.CancelToken,re={taskList:{},cacheList:new Map,uniqueId(e){return`${location.href}|${e.method}|${e.url}|`},addTask(e,t){const l=this.uniqueId(e);this.taskList[l]=t},delTask(e){const t=this.uniqueId(e),l=this.taskList[t];l&&l(e)},pending(e){const t=this.uniqueId(e);return!!this.taskList[t]},cache(e){const t=this.uniqueId(e),l=this.cacheList.get(t);if(l){if(l.expirationTime<new Date().getTime()){this.delCache(e);return}return l.response,l.response}},addCache(e,t){const l=this.uniqueId(e),i=e.cacheTime||0;i&&this.cacheList.set(l,{response:t,expirationTime:new Date().getTime()+i})},delCache(e){const t=this.uniqueId(e);return this.cacheList.delete(t)}},Hl={onFulfilled:function(e){return e.cacheEnable===!1||(re.pending(e)&&re.delTask(e),e.cancelToken=new Ul(t=>{re.addTask(e,t)})),e},onRejected(e){return Promise.reject(e)}},Fl={onFulfilled:function(e){return e.config.cacheEnable===!1||e.config.method==="get"&&Object.keys(e.data).length>0&&re.addCache(e.config,e.data),e},onRejected(e){return Promise.reject(e)}},dt={};function Ls(e,t){dt[e]=t}function Gl(e){return dt[e]}const Jl=N({name:"Dashboard",setup(){const e=Qe(),t=Gl("dashboard");if(t)return()=>c("span",null,[c(t,null,null)]);const l=L(()=>e.getters.name);return()=>c("div",{class:"dashboard-container"},[c("div",{class:"dashboard-text"},[w("Hi "),l.value,w(" 😄")])])}}),T=(e,t)=>{const l=e.__vccOpts||e;for(const[i,a]of t)l[i]=a;return l},Kl=T(Jl,[["__scopeId","data-v-3122b6c7"]]),zl={data(){return{levelList:null}},watch:{$route(){this.getBreadcrumb()}},created(){this.getBreadcrumb()},methods:{getBreadcrumb(){let e=this.$route.matched.filter(l=>l.meta&&l.meta.title);const t=e[0];this.isDashboard(t)||(e=[{path:"/dashboard",meta:{title:"Dashboard"}}].concat(e)),this.levelList=e.filter(l=>l.meta&&l.meta.title&&l.meta.breadcrumb!==!1)},isDashboard(e){const t=e&&e.name;return t?t.trim().toLocaleLowerCase()==="Dashboard".toLocaleLowerCase():!1},pathCompile(e){const{params:t}=this.$route;return tl(e)(t)},handleLink(e){const{redirect:t,path:l}=e;if(t){this.$router.push(t);return}this.$router.push(this.pathCompile(l))}}},Wl={key:0,class:"no-redirect"},Xl=["onClick"];function Zl(e,t,l,i,a,o){const s=Dt,r=Rt;return n(),m(r,{class:"app-breadcrumb",separator:"/"},{default:p(()=>[c(fl,{name:"breadcrumb"},{default:p(()=>[(n(!0),b(I,null,$(a.levelList,(d,u)=>(n(),m(s,{key:d.path},{default:p(()=>[d.path.indexOf("/DIR_")===0&&d.redirect===void 0||u===a.levelList.length-1?(n(),b("span",Wl,O(d.meta.title),1)):(n(),b("a",{key:1,onClick:h=>o.handleLink(d)},O(d.meta.title),9,Xl))]),_:2},1024))),128))]),_:1})]),_:1})}const Yl=T(zl,[["render",Zl],["__scopeId","data-v-fa74804e"]]),Ql={name:"Hamburger",props:{isActive:{type:Boolean,default:!1}},emits:["toggle-click"],methods:{toggleClick(){this.$emit("toggle-click")}}};function ea(e,t,l,i,a,o){const s=_("v-icon");return n(),b("div",{style:{padding:"0 15px"},onClick:t[0]||(t[0]=(...r)=>o.toggleClick&&o.toggleClick(...r))},[c(s,{class:U({"is-active":l.isActive}),name:"ra-leftalignment"},null,8,["class"])])}const ta=T(Ql,[["render",ea]]),la={};function aa(e,t){const l=X,i=Jt,a=Kt,o=zt;return n(),m(o,{style:{width:"100%",height:"100%"}},{default:p(()=>[c(l,{class:"aside"},{default:p(()=>[ee(e.$slots,"left-aside",{},void 0,!0)]),_:3}),c(i,{class:"main",style:{margin:"0 10px"}},{default:p(()=>[ee(e.$slots,"main",{},void 0,!0)]),_:3}),c(a,{class:"aside",width:"350px",style:{padding:"20px"}},{default:p(()=>[ee(e.$slots,"right-aside",{},void 0,!0)]),_:3})]),_:3})}const ct=T(la,[["render",aa],["__scopeId","data-v-7c3d697b"]]),ia={type:"input",name:"文本框",default:{type:"input",label:"label",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"sub-form",field:"props",label:"属性",props:{options:{labelPosition:"top"},formItems:[{type:"number",field:"maxlength",label:"最大字符数"},{type:"icon-select",field:"prefixIcon",label:"前置ICON"},{type:"icon-select",field:"suffixIcon",label:"后置ICON"},{type:"switch",field:"showCopy",label:"复制"},{type:"switch",field:"disabled",label:"禁用"},{type:"switch",field:"showWordLimit",label:"显示限制词数"},{type:"input",field:"mask",label:"mask",info:'<a href="https://github.com/RobinHerbots/Inputmask" target="_blank" class="el-link el-link--primary">文档</a>'}]}}]},oa={type:"number",name:"数字",default:{type:"number",label:"label",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"sub-form",field:"props",label:"属性",props:{options:{labelPosition:"top"},formItems:[{type:"number",field:"min",label:"最小值"},{type:"number",field:"man",label:"最大值"}]}}]},sa={type:"number-range",name:"数字区间",default:{type:"number-range",label:"label",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"sub-form",field:"props",props:{options:{labelPosition:"top"},formItems:[{type:"input",field:"unit",label:"单位"},{type:"switch",field:"disabled",label:"禁用"}]}}]},na={type:"select",name:"下拉框",default:{type:"select",label:"label",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"radio",field:"optionType",label:"备选项类型",value:0,options:[{value:0,label:"local"},{value:1,label:"remote"}]},{type:"sub-form",field:"options",label:"备选项",props:{repeat:!0,options:{labelPosition:"top"},formItems:[{type:"input",field:"value",label:"value"},{type:"input",field:"label",label:"label"}]},depend:{field:"optionType",value:0}},{type:"sub-form",field:"props",label:"属性",props:{options:{labelPosition:"top"},formItems:[{type:"input",field:"selectApi",label:"备选项接口",depend:{field:".optionType",value:1}},{type:"switch",field:"multiple",label:"多选"},{type:"number",field:"multipleLimit",label:"最大选中数",depend:{field:"multiple",value:!0}},{type:"switch",field:"allowCreate",label:"允许创建"},{type:"switch",field:"filterable",label:"允许过滤"}]}}],trans(e){const t=f.cloneDeep(e);return e.optionType===0?t.props&&t.props.selectApi!==void 0&&delete t.props.selectApi:e.optionType===1&&t.options&&delete t.options,delete t.optionType,t}},ra={type:"radio",name:"单选框",default:{type:"radio",label:"label",field:"field_name",options:[]},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"sub-form",field:"options",label:"备选项",props:{formItems:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"value",label:"字段值"}],repeat:!0}},{type:"input",field:"default",label:"默认值"}]},pa={type:"switch",name:"开关",default:{type:"switch",label:"label",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"sub-form",field:"props",props:{options:{labelPosition:"top"},formItems:[{type:"input",field:"activeText",label:"打开时的文字描述"},{type:"input",field:"inactiveText",label:"关闭时的文字描述"},{type:"color",field:"activeColor",label:"打开时的背景色"},{type:"color",field:"inactiveColor",label:"关闭时的背景色"},{type:"switch",field:"disabled",label:"禁用"}]}}]},da={type:"code",name:"Code",default:{type:"code",label:"label",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"}]},ca={type:"json",name:"json",default:{type:"json",label:"label",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"}]},ua={type:"upload",name:"上传",default:{type:"upload",label:"label",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"}]},ma={type:"template",name:"自定义组件",default:{type:"template",label:"label",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"}]},ha={type:"icon-select",name:"图标选择器",default:{type:"icon-select",label:"label",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"}]},fa={type:"sub-form",name:"子表单",default:{type:"sub-form",label:"label",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"sub-form",field:"props",label:"属性",props:{options:{labelPosition:"top"},formItems:[{type:"switch",field:"repeat",label:"可重复"},{type:"sub-form",field:"form-items",label:"子表单控件",props:{options:{labelPosition:"top"},repeat:!0,formItems:[{type:"input",field:"label",label:"label"},{type:"select",field:"type",label:"类型",options:[{value:"input",label:"文本框"}]}]}},{type:"switch",field:"disabled",label:"禁用"}]}}]},ba={type:"checkbox",name:"复选框",default:{type:"checkbox",label:"label",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"sub-form",field:"props",props:{options:{labelPosition:"top"},formItems:[{type:"number",field:"max",label:"最大选中数"},{type:"number",field:"min",label:"最小选中数"},{type:"switch",field:"disabled",label:"禁用"}]}}]},ut={};function A(e){ut[e.type]=e}A(ia);A(na);A(oa);A(sa);A(pa);A(fa);A(ra);A(ba);A(da);A(ca);A(ua);A(ha);A(ma);const ke=ut,ya={options:{labelPosition:"top",submitButton:!1,cancelButton:!1},formItems:[{type:"input",field:"saveApi",label:"保存接口"},{type:"switch",field:"inline",label:"行布局"},{type:"radio",field:"labelPosition",label:"label位置",options:[{value:"right",label:"右"},{value:"left",label:"左"},{value:"top",label:"上"}]},{type:"input",field:"labelWidth",label:"label宽度",value:"100px"},{type:"switch",field:"showSubmitButton",label:"显示提交按钮",value:!0},{type:"sub-form",field:"submitButton",label:"提交按钮",props:{options:{labelPosition:"top"},formItems:[{type:"input",field:"text",label:"文案",value:"提交"},{type:"select",field:"type",label:"按钮类型",options:[{value:"primary",label:"primary"}]}]}},{type:"switch",field:"showCancelButton",label:"显示取消按钮",value:!0},{type:"sub-form",field:"cancelButton",label:"取消按钮",props:{options:{labelPosition:"top"},formItems:[{type:"input",field:"text",label:"文案",value:"取消"},{type:"select",field:"type",label:"按钮类型",options:[{value:"primary",label:"primary"}]}]}}]},he={labelPosition:"top",submitButton:!1,cancelButton:!1},Le=[];Object.keys(ke).forEach(e=>{Le.push({value:e,label:ke[e].name})});const va={options:{submitButton:!1,cancelButton:!1},formItems:[{type:"sub-form",field:"columns",props:{repeat:!0,formItems:[{type:"input",field:"field",label:"字段key"},{type:"select",field:"type",label:"类型",options:f.cloneDeep(Le)},{type:"input",field:"label",label:"字段label"}]}}]},ga={components:{DevLayout:ct,VForm:G,VButton:Be,JsonView:Oe},props:{schema:{type:Object,default:e=>{}}},data(){return{sqlOptions:{},sqlSchema:va,baseSchema:ya,activeTab:"base",builderSchema:Object.assign({},this.$props.schema,{options:{submitButton:!1,cancelButton:!1}}),baseOptions:{},key:0,ctrlKey:0,activeCtrl:void 0,ctrlOptions:{},ctrlSchema:{},ctrlName:"",activeIndex:void 0,ctrlMap:ke,activeIndexReg:/(formItems)?\[(\d+)\]/,tableStruct:"",activeName:"1",currentCtrlType:"input",types:f.cloneDeep(Le)}},computed:{getSaveSchema(){return{formItems:this.builderSchema.formItems}}},watch:{baseOptions:{deep:!0,immediate:!0,handler(e){const t=f.cloneDeep(e);e.showSubmitButton===!1&&(t.submitButton=!1),e.cancelSubmitButton===!1&&(t.cancelButton=!1),delete t.showSubmitButton,delete t.showCancelButton,Object.keys(t).length>0&&(this.builderSchema=f.merge(this.builderSchema,{options:t}),this.key++)}},ctrlOptions:{deep:!0,handler(e){const t=f.get(this.builderSchema,this.activeIndex);if(!t)return;const l=t?t.type:"",i=this.ctrlMap[l],a=i.trans?i.trans(e):e;if(a&&Object.keys(a).length>0){if(a.type=l,this.activeIndex.indexOf("[")>-1){const[o,s,r]=this.activeIndex.match(/(\w+)\[(\d+)\]/);this.builderSchema[s][r]={...a}}else this.builderSchema[this.activeIndex]=a;this.key++}}},currentCtrlType:{handler(e){const t=this.ctrlMap[e];this.ctrlSchema=f.cloneDeep({options:f.cloneDeep(he),formItems:f.cloneDeep(t.builder)});const l=f.get(this.builderSchema,this.activeIndex);this.ctrlOptions=f.cloneDeep(l),this.ctrlOptions.type=e,this.ctrlKey++,this.key++}}},beforeCreate(){K.on("dev-action",({event:e,data:t})=>{this.onDevAction(t.type,t.devId)})},unmounted(){K.off("dev-action")},methods:{onDevAction(e,t){this.activeIndex="formItems"+t,e==="edit"&&(this.activeTab="ctrl",this.clicklabel()),e==="del"&&(this.activeTab="base",this.removeOne()),this.ctrlKey++},push(e){const t="formItems";this.ctrlOptions={},this.builderSchema[t]=this.builderSchema[t]||[];const l=this.ctrlMap[e];this.activeCtrl=l,this.builderSchema[t].push(f.cloneDeep(l.default)),this.ctrlSchema=f.cloneDeep({options:f.cloneDeep(he),formItems:f.cloneDeep(l.builder)}),this.ctrlKey++,this.key++,this.activeIndex=`${t}[${this.builderSchema[t].length-1}]`,this.activeTab="ctrl"},removeOne(){f.unset(this.builderSchema,this.activeIndex),this.builderSchema=f.cloneDeep(Fe(this.builderSchema)),this.activeIndex="",this.ctrlOptions={},this.ctrlSchema={},this.key++,this.ctrlKey++},clicklabel(){const e=this.activeIndex;if(e.match(this.activeIndexReg)){const t=f.cloneDeep(f.get(this.builderSchema,e)),l=t.type,i=this.ctrlMap[l];if(!i){this.$message({type:"warning",message:"尚未支持该组件的UI编辑"});return}this.currentCtrlType=l,this.ctrlOptions=t,this.ctrlSchema=f.cloneDeep({options:f.cloneDeep(he),formItems:f.cloneDeep(i.builder)}),this.ctrlKey++}},saveSchema(){this.$http.request({method:"POST",url:"/devtool/page_schema",data:{formItems:this.builderSchema.formItems}}).then(({data:e})=>{e&&this.$message({type:"success",message:"保存成功, 请刷新页面查看效果"})})}}};function ka(e,t,l,i,a,o){const s=_("v-form"),r=Xe,d=pe,u=_("JsonView"),h=_("VButton"),v=xe,S=Ee,g=Ze,F=Ye,q=_("dev-layout");return n(),m(q,null,{main:p(()=>[a.builderSchema.formItems?(n(),m(s,V({ref:"form",key:a.key,dev:!0},a.builderSchema),null,16)):E("",!0),c(r),c(d,{type:"primary",onClick:o.saveSchema},{default:p(()=>[w("保存页面配置")]),_:1},8,["onClick"]),w("    "),c(h,{text:"PageSchema",type:"modal"},{default:p(()=>[c(u,{data:o.getSaveSchema},null,8,["data"])]),_:1})]),"right-aside":p(()=>[a.activeIndex?(n(),m(F,{key:0},{default:p(()=>[c(g,{label:"控件类型"},{default:p(()=>[c(S,{modelValue:a.currentCtrlType,"onUpdate:modelValue":t[0]||(t[0]=B=>a.currentCtrlType=B)},{default:p(()=>[(n(!0),b(I,null,$(a.types,(B,z)=>(n(),m(v,{key:z,label:B.label,value:B.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})):E("",!0),(n(),m(s,V({key:a.ctrlKey,modelValue:a.ctrlOptions,"onUpdate:modelValue":t[1]||(t[1]=B=>a.ctrlOptions=B)},a.ctrlSchema),null,16,["modelValue"]))]),_:1})}const _a=T(ga,[["render",ka],["__scopeId","data-v-875f0171"]]),Sa={type:"input",name:"文本框",default:{type:"input",label:"label",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"sub-form",field:"props",label:"属性",props:{options:{labelPosition:"top"},formItems:[{type:"number",field:"maxlength",label:"最大字符数"},{type:"switch",field:"showWordLimit",label:"显示限制词数"},{type:"input",field:"mask",label:"mask",info:'<a href="https://github.com/RobinHerbots/Inputmask" target="_blank" class="el-link el-link--primary">文档</a>'}]}}]},wa={type:"select",name:"下拉框",default:{type:"select",label:"label",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"radio",field:"optionType",label:"备选项类型",value:0,options:[{value:0,label:"local"},{value:1,label:"remote"}]},{type:"sub-form",field:"options",label:"备选项",props:{repeat:!0,options:{labelPosition:"top"},formItems:[{type:"input",field:"value",label:"value"},{type:"input",field:"label",label:"label"}]},depend:{field:"optionType",value:0}},{type:"sub-form",field:"props",label:"属性",props:{options:{labelPosition:"top"},formItems:[{type:"input",field:"selectApi",label:"备选项接口",depend:{field:".optionType",value:1}},{type:"switch",field:"multiple",label:"多选"},{type:"number",field:"multipleLimit",label:"最大选中数",depend:{field:"multiple",value:!0}},{type:"switch",field:"filterable",label:"允许过滤"}]}}],trans(e){const t=f.cloneDeep(e);return e.optionType===0?t.props&&t.props.selectApi!==void 0&&delete t.props.selectApi:e.optionType===1&&t.options&&delete t.options,delete t.optionType,t}},xa={type:"date",name:"日期",default:{type:"date",label:"时间",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"}]},Ne={options:{labelPosition:"top",submitButton:!1,cancelButton:!1},formItems:[{type:"switch",field:"showFilter",label:"搜索条件",value:!0},{type:"switch",field:"showPagination",label:"页码",value:!0},{type:"switch",field:"exportAble",label:"导出按钮"}]},fe={labelPosition:"top",submitButton:!1,cancelButton:!1},Ea={type:"span",name:"文本",default:{type:"span",label:"表头",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"input",field:"info",label:"提示"},{type:"switch",field:"sortable",label:"排序"}]},Ia={type:"enum",name:"标签",default:{type:"enum",label:"表头",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"input",field:"info",label:"提示"},{type:"sub-form",field:"options",label:"映射",props:{options:{labelPosition:"top"},formItems:[{type:"input",field:"value",label:"value"},{type:"input",field:"label",label:"label"}]},value:[]}],trans(e){return e.options=e.options||[],e.label||(e.label="表头"),e}},Ta={type:"html",name:"HTML",default:{type:"html",label:"表头",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"input",field:"info",label:"提示"}]},Ca={type:"icon",name:"图标",default:{type:"icon",label:"表头",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"input",field:"info",label:"提示"}]},Ba={type:"image",name:"图片",default:{type:"image",label:"表头",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"input",field:"info",label:"提示"}]},Oa={type:"json",name:"JSON",default:{type:"json",label:"表头",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"input",field:"info",label:"提示"}]},$a={type:"link",name:"链接",default:{type:"link",label:"表头",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"input",field:"info",label:"提示"}]},Aa={type:"rich",name:"富文本",default:{type:"rich",label:"表头",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"input",field:"info",label:"提示"}]},Pa={type:"tpl",name:"模板",default:{type:"tpl",label:"表头",field:"field_name"},builder:[{type:"input",field:"label",label:"字段名"},{type:"input",field:"field",label:"字段key"},{type:"input",field:"info",label:"提示"},{type:"input",field:"tpl",label:"模板",info:"例如 <code>姓名: {name} 年龄:{age}</code>"}]},La={span:Ea,enum:Ia,html:Ta,icon:Ca,image:Ba,json:Oa,link:$a,rich:Aa,tpl:Pa},Da={type:"jump",name:"跳转",default:{type:"jump",target:"",text:"按钮"},builder:[{type:"input",field:"target",label:"跳转地址",info:"可以是本地路由, 也可以是url"},{type:"input",field:"text",label:"文案"},{type:"sub-form",field:"props",label:"属性",props:{options:{labelPosition:"top"},formItems:[{type:"icon-select",field:"icon",label:"图标"},{type:"select",field:"type",label:"类型",options:[{value:"primary",label:"primary"},{value:"info",label:"info"}]}]}}]},Ra={type:"api",name:"接口请求",default:{type:"api",target:"",text:"请求"},builder:[{type:"input",field:"target",label:"API地址",info:"此处填写接口path即可"},{type:"input",field:"text",label:"文案"},{type:"sub-form",field:"props",label:"属性",props:{options:{labelPosition:"top"},formItems:[{type:"input",field:"text",label:"文案"},{type:"icon-select",field:"icon",label:"图标"},{type:"select",field:"type",label:"类型",options:[{value:"primary",label:"primary"},{value:"info",label:"info"}]},{type:"input",field:"api",label:"API地址",info:"此处填写接口path即可"},{type:"select",field:"method",label:"请求类型",options:[{value:"GET",label:"GET"},{value:"POST",label:"POST"},{value:"DELETE",label:"DELETE"},{value:"PUT",label:"PUT"}]}]}}]},ja={type:"form",name:"弹框表单",default:{type:"form",target:"",text:"弹框表单"},builder:[{type:"input",field:"text",label:"文案"},{type:"radio",field:"container",label:"模式",options:[{value:"dialog",label:"模态框"},{value:"drawer",label:"抽屉"}],value:"dialog"},{type:"radio",field:"schema_type",label:"表单类型",options:[{value:0,label:"本地"},{value:1,label:"远程"}],value:1},{type:"input",field:"infoApi",label:"formSchema接口",depend:{field:"schema_type",value:1}},{type:"json",field:"form-items",label:"表单控件"},{type:"input",field:"saveApi",label:"保存接口"}]},Ma={type:"table",name:"弹框列表",default:{type:"form",target:"",text:"弹框表单"},builder:[{type:"input",field:"text",label:"文案"},{type:"radio",field:"container",label:"模式",options:[{value:"dialog",label:"模态框"},{value:"drawer",label:"抽屉"}],value:"dialog"},{type:"radio",field:"schema_type",label:"表单类型",options:[{value:0,label:"本地"},{value:1,label:"远程"}],value:1},{type:"input",field:"infoApi",label:"formSchema接口",depend:{field:"schema_type",value:1}},{type:"json",field:"form-items",label:"表单控件"},{type:"input",field:"saveApi",label:"保存接口"}]},Na={jump:Da,api:Ra,form:ja,table:Ma},qa={components:{JsonView:Oe,DevLayout:ct,VTable:te,VForm:G,VButton:Be},props:{schema:{type:Object,default:e=>{}}},data(){const e=yl(this.$props.schema);return delete e.listApi,e.list=[{}],{baseSchema:Ne,activeTab:"base",builderSchema:Object.assign({},Ne,e),baseOptions:{},key:0,ctrlKey:0,activeCtrl:void 0,activeBrick:void 0,ctrlOptions:{},ctrlSchema:{},ctrlName:"",activeIndex:void 0,ctrlMap:{filter:{input:Sa,select:wa,date:xa},headers:La,buttons:Na},activeIndexReg:/(filter|headers|normalButton|batchButton|rowButton)?\[(\d+)\]/,currentCtrlType:"input"}},computed:{types(){const e=[],t=this.ctrlMap[this.activeBrick];return Object.keys(t).forEach(l=>{e.push({value:l,label:t[l].name})}),e},getSaveSchema(){return{filter:this.builderSchema.filter,headers:this.builderSchema.headers,rowButton:this.builderSchema.rowButton,normalButton:this.builderSchema.normalButton,batchButton:this.builderSchema.batchButton}},currentBuilderSchema(){return this.$store.state.app.builderSchema}},watch:{baseOptions:{deep:!0,immediate:!0,handler(e){this.builderSchema=f.merge(this.builderSchema,e),this.key++,this.updateBuilderSchema()}},ctrlOptions:{deep:!0,handler(e){const t=this.activeIndex.match(this.activeIndexReg);if(!t)return;let l=this.builderSchema[t[1]][parseInt(t[2])].type;t[1]==="headers"&&l===void 0&&(l="span");const i=this.ctrlMap[this.activeBrick][l];if(!i)return;const a=i.trans?i.trans(e):e;if(a&&Object.keys(a).length>0){if(a.type=l,this.activeIndex.indexOf("[")>-1){const[o,s,r]=this.activeIndex.match(/(\w+)\[(\d+)\]/);this.builderSchema[s][r]={...a}}else this.builderSchema[this.activeIndex]=a;this.key++}this.updateBuilderSchema()}},currentCtrlType:{handler(e){const t=this.ctrlMap[this.activeBrick][e];this.ctrlSchema=f.cloneDeep({options:f.cloneDeep(fe),formItems:f.cloneDeep(t.builder)});const l=f.get(this.builderSchema,this.activeIndex);l.type=e;const i=f.cloneDeep(l);this.ctrlOptions=i,i.text&&(this.ctrlOptions.text=i.text,this.ctrlOptions.props=i.props||{}),this.ctrlKey++,this.key++,this.updateBuilderSchema()}}},beforeCreate(){K.on("dev-action",({event:e,data:t})=>{this.onDevAction(t.type,t.devId)})},unmounted(){K.off("dev-action")},methods:{updateBuilderSchema(){this.$store.dispatch("app/setBuilderSchema",this.builderSchema)},onDevAction(e,t){this.activeIndex=t,e==="edit"&&(this.activeTab="ctrl",this.clicklabel()),e==="del"&&(this.activeTab="base",this.removeOne()),this.ctrlKey++},pushFilter(e){this.push(e,"filter","filter","filter")},pushHeaders(e){this.push(e,"headers","headers","headers")},pushNormalButton(e){this.push(e,"normalButton","buttons","buttons")},pushBatchButton(e){this.push(e,"batchButton","buttons","buttons")},pushRowButton(e){this.push(e,"rowButton","buttons","buttons")},push(e,t,l,i){const a=this.ctrlMap[l];if(!a[e]){this.$message({type:"warning",message:"尚未支持此组件的UI编辑"});return}this.activeCtrl=a[e],this.activeBrick=i,this.ctrlOptions={},this.builderSchema[t]=this.builderSchema[t]||[],this.builderSchema[t].push(f.cloneDeep(a[e].default)),this.ctrlSchema=f.cloneDeep({options:f.cloneDeep(fe),formItems:f.cloneDeep(a[e].builder)}),this.key++,this.ctrlKey++,this.activeIndex=`${t}[${this.builderSchema[t].length-1}]`,this.activeTab="ctrl"},removeOne(){f.unset(this.builderSchema,this.activeIndex),this.builderSchema=f.cloneDeep(Fe(this.builderSchema)),this.activeIndex="",this.ctrlOptions={},this.ctrlSchema={},this.key++,this.ctrlKey++},clicklabel(){const e=this.activeIndex,t=e.match(this.activeIndexReg);if(t){const l=f.cloneDeep(f.get(this.builderSchema,e));this.activeBrick=t[1],["normalButton","batchButton","rowButton"].indexOf(t[1])>-1&&(this.activeBrick="buttons");let i=this.builderSchema[t[1]][parseInt(t[2])].type;t[1]==="headers"&&i===void 0&&(i="span");const a=this.ctrlMap[this.activeBrick][i];if(!a){this.activeBrick,this.$message({type:"warning",message:"尚未支持此组件的UI编辑"});return}this.ctrlOptions=l,this.currentCtrlType=i,this.ctrlSchema=f.cloneDeep({options:f.cloneDeep(fe),formItems:f.cloneDeep(a.builder)}),this.ctrlKey++}},saveSchema(){const{filter:e,headers:t,rowButton:l,normalButton:i,batchButton:a}=this.currentBuilderSchema;this.$http.request({method:"POST",url:"/devtool/page_schema",data:{filter:e,headers:t,rowButton:l,normalButton:i,batchButton:a}}).then(({data:o})=>{o&&this.$message({type:"success",message:"保存成功, 请刷新页面查看效果"})})}}};function Va(e,t,l,i,a,o){const s=le,r=pe,d=X,u=_("v-table"),h=Xe,v=pe,S=_("JsonView"),g=_("VButton"),F=xe,q=Ee,B=Ze,z=Ye,Et=_("v-form"),It=_("dev-layout");return n(),m(It,null,{"left-aside":p(()=>[c(d,{style:{width:"200px"}},{default:p(()=>[c(d,null,{default:p(()=>[c(s,{class:"title","data-id":22222},{default:p(()=>[w("添加搜索条件")]),_:1}),c(s,{class:"ctrl"},{default:p(()=>[c(r,{class:"ctrl-btn",onClick:t[0]||(t[0]=C=>o.pushFilter("input"))},{default:p(()=>[w("文本框")]),_:1})]),_:1}),c(s,{class:"ctrl"},{default:p(()=>[c(r,{class:"ctrl-btn",onClick:t[1]||(t[1]=C=>o.pushFilter("select"))},{default:p(()=>[w("下拉框")]),_:1})]),_:1}),c(s,{class:"ctrl"},{default:p(()=>[c(r,{class:"ctrl-btn",onClick:t[2]||(t[2]=C=>o.pushFilter("date"))},{default:p(()=>[w("日期")]),_:1})]),_:1})]),_:1}),c(d,null,{default:p(()=>[c(s,{class:"title"},{default:p(()=>[w("添加列表项")]),_:1}),(n(!0),b(I,null,$(Object.keys(a.ctrlMap.headers),(C,M)=>(n(),m(s,{key:`column-${M}`,class:"ctrl"},{default:p(()=>[c(r,{class:"ctrl-btn",onClick:ce=>o.pushHeaders(a.ctrlMap.headers[C].type)},{default:p(()=>[w(O(a.ctrlMap.headers[C].name),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1}),c(d,null,{default:p(()=>[c(s,{class:"title"},{default:p(()=>[w("添加行按钮")]),_:1}),(n(!0),b(I,null,$(Object.keys(a.ctrlMap.buttons),(C,M)=>(n(),m(s,{key:`column-${M}`,class:"ctrl"},{default:p(()=>[c(r,{class:"ctrl-btn",onClick:ce=>o.pushRowButton(a.ctrlMap.buttons[C].type)},{default:p(()=>[w(O(a.ctrlMap.buttons[C].name),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1}),c(d,null,{default:p(()=>[c(s,{class:"title"},{default:p(()=>[w("添加常规按钮")]),_:1}),(n(!0),b(I,null,$(Object.keys(a.ctrlMap.buttons),(C,M)=>(n(),m(s,{key:`column-${M}`,class:"ctrl"},{default:p(()=>[c(r,{class:"ctrl-btn",onClick:ce=>o.pushNormalButton(a.ctrlMap.buttons[C].type)},{default:p(()=>[w(O(a.ctrlMap.buttons[C].name),1)]),_:2},1032,["onClick"])]),_:2},1024))),128)),c(s,{class:"ctrl"},{default:p(()=>[c(r,{class:"ctrl-btn"},{default:p(()=>[w("按钮组")]),_:1})]),_:1})]),_:1}),c(d,null,{default:p(()=>[c(s,{class:"title"},{default:p(()=>[w("添加批量按钮")]),_:1}),(n(!0),b(I,null,$(Object.keys(a.ctrlMap.buttons),(C,M)=>(n(),m(s,{key:`column-${M}`,class:"ctrl"},{default:p(()=>[c(r,{class:"ctrl-btn",onClick:ce=>o.pushBatchButton(a.ctrlMap.buttons[C].type)},{default:p(()=>[w(O(a.ctrlMap.buttons[C].name),1)]),_:2},1032,["onClick"])]),_:2},1024))),128)),c(s,{class:"ctrl"},{default:p(()=>[c(r,{class:"ctrl-btn"},{default:p(()=>[w("按钮组")]),_:1})]),_:1})]),_:1})]),_:1})]),main:p(()=>[(n(),m(u,V({ref:"table",key:a.key,dev:!0},a.builderSchema),null,16)),c(h),c(v,{type:"primary",onClick:o.saveSchema},{default:p(()=>[w("保存页面配置")]),_:1},8,["onClick"]),w("    "),c(g,{text:"PageSchema",type:"modal"},{default:p(()=>[c(S,{data:o.getSaveSchema},null,8,["data"])]),_:1})]),"right-aside":p(()=>[a.activeIndex?(n(),m(z,{key:0},{default:p(()=>[c(B,{label:"控件类型"},{default:p(()=>[c(q,{modelValue:a.currentCtrlType,"onUpdate:modelValue":t[3]||(t[3]=C=>a.currentCtrlType=C)},{default:p(()=>[(n(!0),b(I,null,$(o.types,(C,M)=>(n(),m(F,{key:M,label:C.label,value:C.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})):E("",!0),(n(),m(Et,V({key:a.ctrlKey,modelValue:a.ctrlOptions,"onUpdate:modelValue":t[4]||(t[4]=C=>a.ctrlOptions=C)},a.ctrlSchema),null,16,["modelValue"]))]),_:1})}const Ua=T(qa,[["render",Va],["__scopeId","data-v-e5209cb7"]]),Ha={name:"PageEditor",components:{FormBuilder:_a,TableBuilder:Ua},setup(){const e=D(!1),t=D(1),l="rtl",i=ae(),a=L(()=>k.state.app.pages[i.path]);return{show:e,key:t,direction:l,pageSchema:a}}};function Fa(e,t,l,i,a,o){const s=_("VIcon"),r=_("form-builder"),d=_("table-builder"),u=We;return n(),b(I,null,[c(s,{name:"ra-set",onClick:t[0]||(t[0]=h=>i.show=!i.show)}),c(u,{modelValue:i.show,"onUpdate:modelValue":t[1]||(t[1]=h=>i.show=h),title:"页面设计",class:"my-drawer",direction:i.direction,size:"90%","destroy-on-close":"","append-to-body":""},{default:p(()=>[i.pageSchema.formItems!==void 0?(n(),m(r,{key:0,schema:i.pageSchema},null,8,["schema"])):E("",!0),i.pageSchema.headers!==void 0?(n(),m(d,{key:1,schema:i.pageSchema},null,8,["schema"])):E("",!0)]),_:1},8,["modelValue","direction"])],64)}const Ga=T(Ha,[["render",Fa]]),Ja={components:{Breadcrumb:Yl,Hamburger:ta,VButton:Be,PageEditor:Ga},data(){return{showExportPop:!1,modulesList:this.getSetting("system_module"),showJsonSchema:!1,json:"",key:0,defaultAvatar:this.getSetting("defaultAvatar")}},computed:{...Ce(["sidebar","avatar","name","nickname","nav"]),hasNewMessage(){return this.$store.state.settings.hasNewMessage},moduleName(){return this.$store.state.app.moduleName},setting(){return this.$store.state.settings},user(){return this.$store.state.user},showPageJsonSchemaIcon(){return this.$store.state.settings.showPageJsonSchema||!1}},mounted(){He("el-submenu is-active");const e=this.getSetting("navBarNotice");e.length>0&&!this.getSetting("closeNavNotice")&&this.showNotice(e)&&this.$notify({title:"提示",message:e,dangerouslyUseHTMLString:!0,duration:0,onClose:this.closeNavBarNotice}),this.setting.envColor[this.user.env]&&Tt({elRef:this.$refs.header.$el,waterMark:this.user.env,color:"skyblue",size:"20"})},methods:{toggleSideBar(){this.$store.dispatch("app/toggleSideBar")},async logout(){await this.$store.dispatch("user/logout"),location.reload(`${location.origin}/#/login?redirect=${this.$route.fullPath}`)},getSetting(e){return this.$store.state.settings[e]},async closeNavBarNotice(){await this.$store.commit("settings/updateSettings",{closeNavNotice:!0}),this.closeNotice(this.getSetting("navBarNotice"))},showPopover(){this.showExportPop=!0},showNotice(e){const t="dismiss:navbar_notice";return oe.exist(t)?oe.get(t)!==e:!0},closeNotice(e){oe.set("dismiss:navbar_notice",e)},gotoMenuEdit(){var e,t,l,i;(t=(e=this.$route)==null?void 0:e.meta)!=null&&t.pageId&&window.open(location.origin+location.pathname+"#/menu/"+((i=(l=this.$route)==null?void 0:l.meta)==null?void 0:i.pageId))}}},Ka={class:"right-content"},za={class:"right-item"},Wa={key:0,class:"right-item"},Xa={class:"right-item-button",style:{padding:"0"}},Za={class:"user-info"},Ya=["src"],Qa={class:"user-name"};function ei(e,t,l,i,a,o){const s=_("hamburger"),r=_("breadcrumb"),d=le,u=_("VIcon"),h=_("PageEditor"),v=_("v-button"),S=qt,g=Vt,F=Ut,q=We,B=X;return n(),m(B,{ref:"header",class:"navbar",style:kl({background:o.setting.envColor[o.user.env]})},{default:p(()=>[c(d,{span:16},{default:p(()=>[c(s,{"is-active":e.sidebar.opened,class:"hamburger-container",onToggleClick:o.toggleSideBar},null,8,["is-active","onToggleClick"]),c(r,{class:"breadcrumb-container"})]),_:1}),c(d,{span:8},{default:p(()=>[y("div",Ka,[y("div",za,[c(u,{name:"ra-code",onClick:o.gotoMenuEdit},null,8,["onClick"])]),o.showPageJsonSchemaIcon?(n(),b("div",Wa,[c(h)])):E("",!0),y("div",Xa,[c(v,{buttons:e.nav},null,8,["buttons"])]),c(F,{class:"right-item",trigger:"click"},{dropdown:p(()=>[c(g,{class:"user-dropdown"},{default:p(()=>[c(S,{icon:"oms-icon-index",onClick:t[0]||(t[0]=z=>e.$router.push("/"))},{default:p(()=>[w("首页")]),_:1}),c(S,{divided:"",icon:"el-icon-switch-button",onClick:o.logout},{default:p(()=>[w("退出登录")]),_:1},8,["onClick"])]),_:1})]),default:p(()=>[y("div",Za,[y("img",{src:e.avatar?e.avatar:a.defaultAvatar,class:"user-avatar",alt:"头像"},null,8,Ya),w(),y("span",Qa,O(e.nickname||e.name),1)])]),_:1})])]),_:1}),a.showJsonSchema?(n(),m(q,{key:0,"with-header":!1,size:"50%"})):E("",!0)]),_:1},8,["style"])}const ti=T(Ja,[["render",ei],["__scopeId","data-v-99b3c688"]]),li={name:"SidebarLogo",props:{collapse:{type:Boolean,required:!0}},computed:{title(){return this.$store.state.settings.title},logo(){return this.$store.state.settings.logo}}},ai=e=>(lt("data-v-49084925"),e=e(),at(),e),ii=["src"],oi={key:1,class:"sidebar-title"},si=ai(()=>y("div",null,"系统",-1)),ni=["src"],ri={class:"sidebar-title"};function pi(e,t,l,i,a,o){const s=_("router-link");return n(),b("div",{class:U(["sidebar-logo-container",{collapse:l.collapse}])},[c(bl,{name:"sidebarLogoFade"},{default:p(()=>[l.collapse?(n(),m(s,{key:"collapse",class:"sidebar-logo-link",to:"/"},{default:p(()=>[o.logo?(n(),b("img",{key:0,src:o.logo,class:"sidebar-logo"},null,8,ii)):(n(),b("h1",oi,O(o.title),1)),si]),_:1})):(n(),m(s,{key:"expand",class:"sidebar-logo-link",to:"/"},{default:p(()=>[o.logo?(n(),b("img",{key:0,src:o.logo,class:"sidebar-logo"},null,8,ni)):E("",!0),y("h1",ri,O(o.title),1)]),_:1}))]),_:1})],2)}const di=T(li,[["render",pi],["__scopeId","data-v-49084925"]]),ci={props:{to:{type:String,required:!0},newTab:{type:Boolean,required:!1}},methods:{compType(e){return Re(e)||this.newTab?"a":"router-link"},linkProps(e){return Re(e)?{is:"a",href:e,target:"_blank",rel:"noopener"}:this.newTab?{is:"a",href:this.$router.resolve(e).href,target:"_blank",rel:"noopener"}:{is:"router-link",to:e}}}};function ui(e,t,l,i,a,o){return n(),m(it(o.compType(l.to)),H(Z(o.linkProps(l.to))),{default:p(()=>[ee(e.$slots,"default")]),_:3},16)}const mi=T(ci,[["render",ui]]),hi={computed:{device(){return this.$store.state.app.device}},mounted(){this.fixBugIniOS()},methods:{fixBugIniOS(){const e=this.$refs.subMenu;if(e){const t=e.handleMouseleave;e.handleMouseleave=l=>{this.device!=="mobile"&&t(l)}}}}},fi={class:"menu-content"},bi=N({__name:"MenuContent",props:{meta:{type:Object,default:()=>({icon:"",title:""})}},setup(e){return(t,l)=>{const i=_("VIcon");return n(),b(I,null,[c(i,{name:e.meta.icon||"ra-all"},null,8,["name"]),y("span",fi,O(e.meta.title),1)],64)}}}),yi={name:"SidebarItem",components:{AppLink:mi,MenuContent:bi},mixins:[hi],props:{item:{type:Object,required:!0},isNest:{type:Boolean,default:!1},to:{type:String,default:""}},methods:{itemClick(){oe.remove("table_filter:"+this.$props.to)},getTo(e){try{return this.$router.resolve(e.redirect?e.redirect:e).fullPath}catch{return console.error("路由解析错误"),"/"}}}},vi={key:0,class:"menu-wrapper"};function gi(e,t,l,i,a,o){const s=_("menu-content"),r=jt,d=_("app-link"),u=_("sidebar-item",!0),h=Mt;return l.item.hidden!==!1?(n(),b("div",vi,[l.item.meta&&l.item.meta.menuType===2?(n(),b(I,{key:0},[l.item.meta?(n(),m(d,{key:0,to:l.to,"new-tab":l.item.meta.newTab},{default:p(()=>[c(r,{index:l.to,class:U({"submenu-title-noDropdown":!l.isNest}),onClick:o.itemClick},{default:p(()=>[c(s,{meta:l.item.meta},null,8,["meta"])]),_:1},8,["index","class","onClick"])]),_:1},8,["to","new-tab"])):E("",!0)],64)):l.item.meta&&l.item.meta.menuType===1?(n(),m(h,{key:1,ref:"subMenu",index:l.to,class:U({"submenu-title-noDropdown":!l.isNest})},{title:p(()=>[l.item.redirect&&l.item.redirect!=="#"?(n(),m(d,{key:0,to:l.to},{default:p(()=>[c(s,{meta:l.item.meta},null,8,["meta"])]),_:1},8,["to"])):(n(),m(s,{key:1,meta:l.item.meta},null,8,["meta"]))]),default:p(()=>[(n(!0),b(I,null,$(l.item.children,v=>(n(),m(u,{key:v.path,"is-nest":!0,item:v,to:o.getTo(v),class:"nest-menu"},null,8,["item","to"]))),128))]),_:1},8,["index","class"])):E("",!0)])):E("",!0)}const ki=T(yi,[["render",gi]]);function mt(e){return e.filter(t=>{var l;return((l=t.meta)==null?void 0:l.menuType)===0?!1:(t.children&&(t.children=mt(t.children),t.children.length===0&&delete t.children),!0)})}const _i={data(){return{selected:""}},computed:{...Ce(["remoteRouter"]),filterRoutes(){let e=[];return this.remoteRouter.forEach(t=>{e=e.concat(f.cloneDeep(t.routes))}),mt(e)}},methods:{getJumpPath:function(e){let t=e;if(e.meta.menuType===1&&e.children&&e.children.length>0){for(let l=0;l<e.children.length;l++)if(e.children[l].path.indexOf("/:")===-1){t=e.children[l];break}}return this.$router.resolve(t.redirect?t.redirect:t).fullPath},onselected:function(e){this.$router.push(e),this.selected=""}}};function Si(e,t,l,i,a,o){const s=xe,r=Nt,d=Ee;return n(),m(d,{modelValue:a.selected,"onUpdate:modelValue":t[0]||(t[0]=u=>a.selected=u),filterable:"",placeholder:"搜索菜单...",class:"search-menu",onChange:o.onselected},{default:p(()=>[(n(!0),b(I,null,$(o.filterRoutes,u=>(n(),b(I,{key:u.path},[u.children!==void 0?(n(),b(I,{key:0},[u.meta.menuType!==0?(n(),m(r,{key:u.path+"-",label:u.meta.title},{default:p(()=>[(n(!0),b(I,null,$(u.children,(h,v)=>(n(),b(I,{key:h.path},[u.meta.menuType!==0?(n(),m(s,{key:0,label:(v===u.children.length-1?"└─":"├─")+h.meta.title,value:o.getJumpPath(h)},null,8,["label","value"])):E("",!0)],64))),128))]),_:2},1032,["label"])):E("",!0)],64)):(n(),m(s,{key:1,label:""+u.meta.title,value:o.getJumpPath(u)},null,8,["label","value"]))],64))),128))]),_:1},8,["modelValue","onChange"])}const wi=T(_i,[["render",Si],["__scopeId","data-v-38301044"]]);var R=(e=>(e[e.custom=0]="custom",e[e.list=1]="list",e[e.form=2]="form",e[e.customSchema=3]="customSchema",e[e.localComp=4]="localComp",e[e.tree=5]="tree",e[e.report=6]="report",e[e.entity=7]="entity",e))(R||{}),P=(e=>(e[e.hidden=0]="hidden",e[e.dir=1]="dir",e[e.menu=2]="menu",e[e.page=3]="page",e))(P||{});const xi=N({components:{SidebarItem:ki,Logo:di,SearchMenu:wi},computed:{...Ce(["sidebar","remoteRouter","customRouter"]),routes(){let e=[];return this.$router.options.routes.concat(this.customRouter||[]).forEach(t=>{t.path==="/"?e=e.concat(t.children||[]):e.push(t)}),f.cloneDeep([{label:"",routes:e},...this.remoteRouter])},activeMenu(){const e=this.$route.matched;for(let t=e.length-1;t>=0;t--){const l=e[t];if(l.meta.menuType===P.menu)return this.showActive(),this.$router.resolve(l.redirect?l.redirect:l).fullPath}return""},showLogo(){return this.$store.state.settings.sidebarLogo},variables(){return{menuBg:"#304156",menuText:"#bfcbd9",menuActiveText:"#409EFF"}},isCollapse(){return!this.sidebar.opened}},mounted(){this.showActive()},methods:{showActive(){He("is-active",200)},filterRoute(e){return e.filter(t=>[P.dir,P.menu].indexOf(t.meta.menuType)!==-1).map(t=>(t=Object.assign({},t),t.children&&(t.children=this.filterRoute(t.children)),t))}}});function Ei(e,t,l,i,a,o){const s=_("logo"),r=_("search-menu"),d=_("sidebar-item"),u=Ht,h=Ft;return n(),b("div",{class:U({"has-logo":e.showLogo})},[e.showLogo?(n(),m(s,{key:0,collapse:e.isCollapse},null,8,["collapse"])):E("",!0),c(h,{"wrap-class":"scrollbar-wrapper"},{default:p(()=>[e.isCollapse?E("",!0):(n(),m(r,{key:0})),c(u,{"default-active":e.activeMenu,collapse:e.isCollapse,"background-color":e.variables.menuBg,"text-color":e.variables.menuText,"unique-opened":!1,"active-text-color":e.variables.menuActiveText,"collapse-transition":!1,mode:"vertical"},{default:p(()=>[(n(!0),b(I,null,$(e.routes,(v,S)=>(n(),b(I,{key:S+"-module"},[(n(!0),b(I,null,$(e.filterRoute(v.routes),g=>(n(),m(d,{key:g.path,item:g,to:e.$router.resolve(g.redirect?g.redirect:g).fullPath},null,8,["item","to"]))),128))],64))),128))]),_:1},8,["default-active","collapse","background-color","text-color","active-text-color"])]),_:1})],2)}const Ii=T(xi,[["render",Ei],["__scopeId","data-v-d252f828"]]),Ti={class:"app-main"},Ci={__name:"AppMain",setup(e){const t=ae(),l=[],i=D(0);return Qt(()=>{var a;(a=t.meta)!=null&&a.keepAlive&&l.indexOf(t.name)&&l.push(t.name),i.value++}),(a,o)=>{const s=_("router-view"),r=Gt;return n(),b("section",Ti,[(n(),m(s,{key:a.$route.fullPath+x(i)})),c(r,{bottom:50})])}}},Bi=T(Ci,[["__scopeId","data-v-ca0f0d98"]]),Oi={class:"main-container"},$i=992,Ai={__name:"index",setup(e){const t=Qe(),{body:l}=document,i=L(()=>t.state.app.sidebar),a=L(()=>t.state.app.device),o=L(()=>t.state.settings.fixedHeader),s=L(()=>({hideSidebar:!i.value.opened,openSidebar:i.value.opened,withoutAnimation:i.value.withoutAnimation,mobile:a.value==="mobile"})),r=()=>l.getBoundingClientRect().width-1<$i;sl(window,"resize",()=>u());const d=()=>{t.dispatch("app/closeSideBar",{withoutAnimation:!1})},u=()=>{if(!document.hidden){const h=r();t.dispatch("app/toggleDevice",h?"mobile":"desktop"),h&&t.dispatch("app/closeSideBar",{withoutAnimation:!0})}};return(h,v)=>(n(),b("div",{class:U([x(s),"app-wrapper"])},[x(a)==="mobile"&&x(i).opened?(n(),b("div",{key:0,class:"drawer-bg",onClick:d})):E("",!0),c(x(Ii),{class:"sidebar-container"}),y("div",Oi,[y("div",{class:U({"fixed-header":x(o)})},[c(x(ti))],2),c(x(Bi))])],2))}},ht=T(Ai,[["__scopeId","data-v-957442cd"]]),Pi={id:"login"},Li=y("h1",{id:"title"},"登录",-1),Di={id:"form"},Ri={key:0,class:"captcha"},ji=["src"],Mi={class:"tips"},Ni={class:"sso"},qi=y("div",{id:"sso-qrcode"},null,-1),Vi=N({__name:"login",setup(e){const t=et(),l=ae(),i=L(()=>k.state.settings.loginTips),a=L(()=>k.state.settings.captcha),o=L(()=>(k.state.app,k.state.app.baseURL)),s=D(0),r=()=>s.value++,d=L(()=>u.value.username.length>0&&u.value.password.length>=4&&(a.value?u.value.captcha.length===4:!0)),u=D({username:"",password:"",captcha:"",sing:""}),h=()=>{if(u.value.username===""||u.value.password===""||a.value&&u.value.captcha===""){Ke.error("用户名, 密码, 验证码是必须的");return}a.value&&(u.value.sing=rl.MD5(`${u.value.username}${u.value.password}${u.value.captcha}`).toString()),k.dispatch("user/login",u.value).then(v=>{var S;t.push({path:((S=l.query)==null?void 0:S.redirect)||"/"})}).catch(v=>{s.value++})};return(v,S)=>(n(),b("div",Pi,[Li,y("form",Di,[ne(y("input",{"onUpdate:modelValue":S[0]||(S[0]=g=>x(u).username=g),type:"text",placeholder:"用户名",class:"input"},null,512),[[me,x(u).username]]),ne(y("input",{"onUpdate:modelValue":S[1]||(S[1]=g=>x(u).password=g),type:"password",placeholder:"密码",class:"input"},null,512),[[me,x(u).password]]),a.value?(n(),b("div",Ri,[ne(y("input",{"onUpdate:modelValue":S[2]||(S[2]=g=>x(u).captcha=g),type:"text",placeholder:"验证码",class:"input-captcha"},null,512),[[me,x(u).captcha]]),y("img",{class:"captcha-img",src:o.value+"/user/captcha?ts="+x(s),title:"点击刷新",onClick:r},null,8,ji)])):E("",!0),y("div",{class:U({input:!0,button:!0,"no-ready":!d.value}),onClick:h},"登录",2),y("div",Mi,[y("div",null,O(i.value),1)]),y("div",Ni,[qi,(n(!0),b(I,null,$(Object.keys([]),g=>(n(),b("div",{key:g},O(g),1))),128))])])]))}}),Ui={name:"NotFoundPage"},ft=e=>(lt("data-v-26068803"),e=e(),at(),e),Hi={class:"not-found"},Fi=ft(()=>y("svg",{width:"380px",height:"500px",viewBox:"0 0 837 1045",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:sketch":"http://www.bohemiancoding.com/sketch/ns"},[y("g",{id:"Page-1",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd","sketch:type":"MSPage"},[y("path",{id:"Polygon-1",d:"M353,9 L626.664028,170 L626.664028,487 L353,642 L79.3359724,487 L79.3359724,170 L353,9 Z",stroke:"#007FB2","stroke-width":"6","sketch:type":"MSShapeGroup"}),y("path",{id:"Polygon-2",d:"M78.5,529 L147,569.186414 L147,648.311216 L78.5,687 L10,648.311216 L10,569.186414 L78.5,529 Z",stroke:"#EF4A5B","stroke-width":"6","sketch:type":"MSShapeGroup"}),y("path",{id:"Polygon-3",d:"M773,186 L827,217.538705 L827,279.636651 L773,310 L719,279.636651 L719,217.538705 L773,186 Z",stroke:"#795D9C","stroke-width":"6","sketch:type":"MSShapeGroup"}),y("path",{id:"Polygon-4",d:"M639,529 L773,607.846761 L773,763.091627 L639,839 L505,763.091627 L505,607.846761 L639,529 Z",stroke:"#F2773F","stroke-width":"6","sketch:type":"MSShapeGroup"}),y("path",{id:"Polygon-5",d:"M281,801 L383,861.025276 L383,979.21169 L281,1037 L179,979.21169 L179,861.025276 L281,801 Z",stroke:"#36B455","stroke-width":"6","sketch:type":"MSShapeGroup"})])],-1)),Gi=ft(()=>y("div",{class:"message-box"},[y("h1",null,"404"),y("p",null,"Page not found"),y("div",{class:"buttons-con"},[y("div",{class:"action-link-wrap"},[y("a",{href:"",class:"link-button"},"Go to Home Page")])])],-1)),Ji=[Fi,Gi];function Ki(e,t,l,i,a,o){return n(),b("div",Hi,Ji)}const zi=T(Ui,[["render",Ki],["__scopeId","data-v-26068803"]]),Wi=[{path:"/",component:ht,redirect:"/dashboard",name:"Root",meta:{menuType:1},children:[{path:"dashboard",name:"Dashboard",component:Kl,meta:{title:"Dashboard",icon:"el-icon-help",menuType:2,keepAlive:!0}}]},{path:"/login",component:Vi,meta:{title:"用户登录",menuType:0},hidden:!0},{path:"/404",component:zi,meta:{menuType:0},hidden:!0}],J=Zt({history:Yt(),routes:Wi});ve.configure({showSpinner:!1});function Xi(e){e.beforeEach((t,l,i)=>{ve.start(),t.preHash=location.hash.replace("#",""),i()}),e.afterEach(t=>{t.matched.length>0&&k.commit("user/updateState",{key:"path",value:t.matched[t.matched.length-1].path.replace("(\\d+)","")}),ve.done()})}function Zi(){return k.state.user.isLodeRemoteRoutes}function bt(){return k.state.settings.whiteRoutes||[]}function Yi(){return k.state.user.token}const Qi={};function eo(){return f.merge(k.state.settings.sso||{},Qi)}function to(){const e=eo(),t=k.state.settings.activeSsoKey||"",l=e[t];if(l!==void 0)return l()}function lo(e){e.beforeEach(async(t,l,i)=>{var a,o;if(bt().indexOf(t.path)!==-1){i();return}if(Yi()){(a=t.query)!=null&&a.redirect?i((o=t.query)==null?void 0:o.redirect):i();return}const s=t.query.redirect||t.path,r=to();if(!r){i(`/login?redirect=${s}`);return}const d=r.flag();if(d&&await k.dispatch("user/login",f.isObject(d)?d:{ticket:d})){i();return}r.jumpToLoginPage(i,`/login?redirect=${s}`)})}const ao={},io={class:"loading preloader"},oo=y("div",{class:"preloader-inner"},null,-1),so=[oo];function no(e,t){return n(),b("div",io,so)}const yt=T(ao,[["render",no]]),ro={name:"VNotice",props:{dataApi:{type:String,default:""},notice:{type:Object,default:()=>{}}},data(){return{noticeProps:{},hasNotice:!1}},mounted(){if(this.$props.dataApi,this.$props.dataApi){this.$http.get(this.$props.dataApi).then(({data:e})=>{this.noticeProps=e,this.hasNotice=!!e});return}else this.hasNotice=Object.keys(this.$props.notice).length>0,this.noticeProps=this.$props.notice}};function po(e,t,l,i,a,o){const s=Ie;return n(),b("div",null,[a.hasNotice?(n(),m(s,H(V({key:0},a.noticeProps)),null,16)):E("",!0)])}const vt=T(ro,[["render",po]]),co=N({components:{VLoading:yt,VNotice:vt},props:{schemaHandler:{type:Function,default:function(e,t){return e}},schemaApi:{type:String,default:""}},data(){return{loading:!0,haveNotice:!1,notice:{},noticeApi:"",schema:{},owners:[],serviceOffLine:!1}},computed:{env(){return this.$store.state.user.env},setting(){return this.$store.state.settings}},beforeCreate(){const e=this.$route.path.split("/").filter(a=>a),t=e.length>1?e.slice(0,e.length-1).join("/"):e[0],l="/schema"+this.$route.meta.path,i={params:this.$route.params};this.$http.get(this.$props.schemaApi||l,i).then(({data:a})=>{this.loading=!1,W(a)&&(a.notice!==void 0&&(this.haveNotice=!0,we(a.notice)?this.notice={title:a.notice}:W(a.notice)&&(this.notice=a.notice,this.noticeApi=a.notice.noticeApi),delete a.notice),this.owners=a.ownerNames||[],this.serviceOffLine=a.serviceOffLine||!1),this.schema=this.$props.schemaHandler(a,t),k.commit("app/SET_PAGE_JSON_SCHEMA",{page:this.$route.path,json:this.schema})})}}),uo=["innerHTML"];function mo(e,t,l,i,a,o){const s=Ie,r=vt,d=yt;return n(),b(I,null,[e.owners.length>0?(n(),m(s,{key:0,title:`该页面功能对应开发: [ ${e.owners.join(", ")} ] 有问题可直接企微反馈`,type:"info",style:{margin:"0 0 20px 0"},closable:!1},null,8,["title"])):E("",!0),e.env==="prod"&&e.serviceOffLine?(n(),b("div",{key:1,class:"offline-notice",innerHTML:e.serviceOffLine===!0?e.setting.serviceOffLineNotice:e.serviceOffLine},null,8,uo)):(n(),b(I,{key:2},[e.haveNotice?(n(),m(r,{key:0,notice:e.notice,style:{margin:"0 0 20px 0"},"data-api":e.noticeApi},null,8,["notice","data-api"])):E("",!0),e.loading?(n(),m(d,{key:1})):ee(e.$slots,"default",H(V({key:2},e.schema)),void 0,!0)],64))],64)}const ie=T(co,[["render",mo],["__scopeId","data-v-4965a709"]]),gt={__name:"table",setup(e){const t=(l,i)=>{if(l.orderBy){const o={prop:l.orderBy.field,order:l.orderBy.mod==="desc"?"descending":"ascending"};l.tableProps=f.merge(l.tableProps,{defaultSort:o})}const a=Object.keys(te.props);return Object.keys(l).forEach(o=>{a.indexOf(o)===-1&&delete l[o]}),l.listApi===void 0&&(l.listApi=`/${i}/list`),l};return(l,i)=>(n(),m(ie,{"schema-handler":t},{default:p(a=>[c(x(te),H(Z(a)),null,16)]),_:1}))}},_e={__name:"form",setup(e){const t=ae(),l=et(),i=(r,d)=>{const u=Object.keys(G.props);return Object.keys(r).forEach(h=>{if(u.indexOf(h)===-1){delete r[h];return}/.*Api$/.test(h)&&(r[h]=se(r[h],t.params))}),r.saveApi===void 0&&(t.params.id!==void 0?(r.saveApi=`/${d}/update/${t.params.id}`,r.getApi||(r.getApi=`/${d}/get/${t.params.id}`)):(delete r.getApi,r.saveApi=`/${d}/create`)),r=f.merge({saveApi:d+"/save",afterSubmit:"goback",afterReset:"goback",mod:t.params.id?"edit":"create"},r),r},a=D(0),o=()=>{xt.request({url:"/form_mutex",method:"get",params:{path:t.fullPath}}).then(r=>{r.data&&(clearInterval(a.value),ze.alert(`${r.data}`,"操作提醒",{showClose:!1,showCancelButton:!0,confirmButtonText:"返回",cancelButtonText:"刷新",callback:d=>{d==="cancel"?location.reload():s()}}))})};ot(()=>{t.params.id!==void 0&&k.state.settings.formMutex&&(o(),a.value=setInterval(o,2e3))}),dl(()=>{clearInterval(a.value)});function s(){var r,d;(r=t.query)!=null&&r.goback?l.push((d=t.query)==null?void 0:d.goback):history.state.back&&history.back()}return(r,d)=>(n(),m(ie,{"schema-handler":i},{default:p(u=>[c(x(G),H(Z(u)),null,16)]),_:1}))}},ho=N({name:"VTree",components:{VForm:G},props:{treeApi:{type:String,default:"",require:!0},getApi:{type:String,default:"",require:!0},saveApi:{type:String,default:"",require:!0},createApi:{type:String,default:"",require:!0},deleteApi:{type:String,default:"",require:!0},formItems:{type:Array,default:()=>[]},treeProps:{type:Object,default:()=>{}},maxDepth:{type:Number,default:3},props:{type:Object,default:()=>{}}},data(){return{type:0,treeData:[],formData:{},localTreeProps:f.merge({"default-expand-all":!0,"expand-on-click-node":!1,props:{children:"children",label:"label"}},this.$props.treeProps),formkey:0,tablekey:0,menuOptions:{}}},computed:{formType(){return["","新建","编辑"][this.type]},formProps(){let e=se(this.$props.saveApi,this.formData);return this.type===1&&(e=this.$props.createApi),{saveApi:e,getApi:this.$props.getApi,formItems:this.$props.formItems}}},created(){this.loadTree()},methods:{loadTree(){this.$http.request({method:"GET",url:this.$props.treeApi}).then(({data:e})=>{this.treeData=e})},onclick(e){this.type=2,this.formData=e,this.formkey++},append(e,t){var l,i;this.type=1;const a={pid:e.id,[((l=this.$props.props)==null?void 0:l.levelKey)??"level"]:t.level+1,...At((i=this.$props.props)==null?void 0:i.effectData,e)};e.children||(e.children=[]),this.formData=a,this.formkey++,e.children.push(a),this.treeData=[...this.treeData]},canAppend(e,t){return e[this.localTreeProps.props.label]?t.level<this.$props.maxDepth:!1},appendNew(){var e;this.type=1;const t={pid:0,[((e=this.$props.props)==null?void 0:e.levelKey)??"level"]:1};this.formData=t,this.formkey++,this.tablekey++,this.treeData=[...this.treeData,t]},remove(e){this.$http.request({method:"DELETE",url:se(this.$props.deleteApi,e)}).then(({code:t})=>{t!==0?this.$message.error("操作失败"):this.loadTree()})},submit(){setTimeout(()=>{this.loadTree(),this.formData={},this.tablekey++,this.type=0},200)},allowDrap(e){return!0},allowDrop(e,t,l){return l==="inner"},handleDragEnd(e,t,l,i){const a=e.data;a.pid=t.data.id,this.$http.request({method:"POST",url:se(this.$props.saveApi,a),data:a}).then(({code:o})=>{o!==0&&this.$message.error("操作失败")})}}}),fo={class:"card-header"},bo=y("span",null,"列表",-1),yo={class:"tree-action"},vo={key:0},go={key:1,style:{color:"#E6A23C"}},ko={class:"card-header"};function _o(e,t,l,i,a,o){const s=pe,r=Wt,d=de,u=le,h=_("v-form"),v=X;return n(),m(v,{class:"tree-box",gutter:20},{default:p(()=>[c(u,{span:8,class:"tree-tree"},{default:p(()=>[c(d,{shadow:"never"},{header:p(()=>[y("div",fo,[bo,c(s,{type:"text",onClick:t[0]||(t[0]=()=>e.appendNew())},{default:p(()=>[w("添加")]),_:1})])]),default:p(()=>[(e.treeData||[]).length>0?(n(),m(r,V({key:0,style:{height:"100vh"},data:e.treeData,"node-key":"id"},e.localTreeProps,{draggable:"","allow-drag":e.allowDrap,"allow-drop":e.allowDrop,onNodeDragEnd:e.handleDragEnd}),{default:p(({node:S,data:g})=>[y("span",yo,[g[e.localTreeProps.props.label]?(n(),b("span",vo,O(g[e.localTreeProps.props.label]),1)):(n(),b("span",go,"请在右侧表单中修改 --> ")),y("span",null,[g[e.localTreeProps.props.label]?(n(),m(s,{key:0,class:"button",type:"text",onClick:()=>e.onclick(g)},{default:p(()=>[w("编辑")]),_:2},1032,["onClick"])):E("",!0),e.canAppend(g,S)?(n(),m(s,{key:1,class:"button",type:"text",onClick:()=>e.append(g,S)},{default:p(()=>[w("添加")]),_:2},1032,["onClick"])):E("",!0),g.children===void 0||g.children.length===0?(n(),m(s,{key:2,class:"button",type:"text",onClick:()=>e.remove(g)},{default:p(()=>[w("删除")]),_:2},1032,["onClick"])):E("",!0)])])]),_:1},16,["data","allow-drag","allow-drop","onNodeDragEnd"])):E("",!0)]),_:1})]),_:1}),c(u,{span:16,class:"tree-form"},{default:p(()=>[e.type?(n(),m(d,{key:0,shadow:"never"},{header:p(()=>[y("div",ko,[y("span",null,O(e.formType),1)])]),default:p(()=>[(n(),m(h,V({key:e.formkey,modelValue:e.formData,"onUpdate:modelValue":t[1]||(t[1]=S=>e.formData=S)},e.formProps,{onSubmit:e.submit}),null,16,["modelValue","onSubmit"]))]),_:1})):E("",!0)]),_:1})]),_:1})}const qe=T(ho,[["render",_o]]),So={__name:"tree",setup(e){const t=(l,i)=>{const a=Object.keys(qe.props);return Object.keys(l).forEach(o=>{a.indexOf(o)===-1&&delete l[o]}),l};return(l,i)=>(n(),m(ie,{"schema-handler":t},{default:p(a=>[c(qe,H(Z(a)),null,16)]),_:1}))}},be={__name:"container",setup(e){const t=D(0);return el(()=>{t.value++}),(l,i)=>{const a=_("router-view");return n(),m(a)}}},wo={title:{text:""},tooltip:{trigger:"axis"},grid:{left:"2%",right:"2%",bottom:"5%",containLabel:!0},toolbox:{feature:{saveAsImage:{}}},legend:{data:[]},xAxis:{type:"category"},yAxis:{type:"value"},series:[]};function xo(e,t,l){if(l.length===0)return{};let i=f.merge({},wo);if(i.title.text=e,we(t)){const a=[],o=Object.keys(l[0]);let s=o[0],r=o.filter((u,h)=>h>0),d=t;if(t.indexOf(":")>-1){const u=t.split(":"),h=u[1].split(",");d=u[0],s=h[0],r=h.filter((v,S)=>S>0)}r.forEach(u=>{const h=[];l.forEach(v=>{h.push(v[u])}),i.series.push({name:u,type:d,smooth:!0,data:h}),i.legend.data.push(u)}),l.forEach(u=>{a.push(u[s])}),i.xAxis.data=a}return W(t)&&(i=f.merge(i,t)),i}const Eo=N({name:"NumberPanel",props:{dataList:{type:Array,default:e=>[]}},data(){return{}}}),Io={class:"number-panel-title"},To={class:"number"},Co={class:"name"};function Bo(e,t,l,i,a,o){return n(!0),b(I,null,$(e.dataList,(s,r)=>(n(),b("span",{key:r},[y("div",Io,[(n(!0),b(I,null,$(Object.keys(s),(d,u)=>(n(),b("div",{key:u,class:"title-inner"},[y("p",To,O(s[d]),1),y("p",Co,O(d),1)]))),128))])]))),128)}const Oo=T(Eo,[["render",Bo],["__scopeId","data-v-cc0d8293"]]),$o={components:{Chart:il,Md:nl,Json:Oe,Table:te,Number:Oo,Html:""},props:{option:{type:Object,default:()=>{}}},setup(e){const t=()=>e.option.chart==="num"?"number":e.option.type;return{compprops:l=>{const i=t();if(i==="number")return{dataList:l.data};if(i==="chart")return{options:xo(l.id,l.chart,l.data)};if(i==="md")return{source:l.data};if(i==="table"){if(!Ge(l.data))return{showPagination:!1};const a=[];return l.data[0]&&Object.keys(l.data[0]).forEach((o,s)=>{a.push({field:o,label:o})}),{headers:a,list:l.data,showPagination:!1}}return{}},comptype:t}}};function Ao(e,t,l,i,a,o){const s=de,r=ml("resize");return ne((n(),m(s,{shadow:"never",class:"part"},{default:p(()=>[(n(),m(it(i.comptype()),H(Z(i.compprops(l.option))),null,16))]),_:1})),[[r,!0]])}const Po=T($o,[["render",Ao],["__scopeId","data-v-a5a65cc1"]]),Lo=N({__name:"index",props:{filter:{type:Array,default:()=>[]},dataPart:{type:Array,default:()=>[]}},setup(e){const t=e,l=ae();ot(()=>{});const i=D({});tt(()=>{var h;(h=t.filter)==null||h.forEach(v=>{v.default!==null&&(i.value[v.field]=v.default)})});const a={inline:!0,labelPosition:"right",labelWidth:"auto",submitButton:{text:"查询"},cancelButton:{text:"重置"}},o=D(1),s=D(t.filter),r=D(t.dataPart),d=L(()=>{let h=l.params.id;if(!h){const v=l.path.split("/");h=v[v.length-1]}return"/focusbi_report/view/"+h}),u=h=>{xt.get(d.value,{params:h}).then(({data:v})=>{s.value=v.filter,r.value=v.dataPart,o.value++})};return(h,v)=>{const S=de,g=le,F=Ie,q=X;return n(),m(q,null,{default:p(()=>[x(s).length>0?(n(),m(g,{key:0,span:24},{default:p(()=>[c(S,{shadow:"never",class:"part-filter"},{default:p(()=>[c(x(G),{modelValue:x(i),"onUpdate:modelValue":v[0]||(v[0]=B=>vl(i)?i.value=B:null),"form-items":x(s),options:a,onSubmit:u},null,8,["modelValue","form-items"])]),_:1})]),_:1})):E("",!0),c(g,{span:24},{default:p(()=>[c(q,{gutter:20},{default:p(()=>[(n(!0),b(I,null,$(x(r),(B,z)=>(n(),m(g,{key:z,span:B.col||24},{default:p(()=>[B.errMsg?(n(),m(F,{key:1,title:B.id+" 片段执行出错",type:"error"},{default:p(()=>[w(O(B.errMsg),1)]),_:2},1032,["title"])):(n(),m(Po,{key:x(o),option:B},null,8,["option"]))]),_:2},1032,["span"]))),128))]),_:1})]),_:1})]),_:1})}}}),Do={__name:"report",setup(e){const t=useRoute(),l=L(()=>{let i=t.params.id;if(!i){const a=t.path.split("/");i=a[a.length-1]}return"/focusbi_report/view/"+i});return(i,a)=>(n(),m(ie,{"schema-api":x(l)},{default:p(o=>[c(Lo,H(Z(o)),null,16)]),_:1},8,["schema-api"]))}},Ro=e=>c("div",null,[e.test]),jo={card:de,form:G,table:te,test:Ro,row:X,col:le},Mo={card:{type:"card",props:{class:"render-card",shadow:"never"}},form:{type:"form",props:{afterReset:""}},table:{type:"table",props:{syncUrl:!1}}};function No(e){const t=Object.assign({},e),l=t.type.split(".").reverse(),i=t.span||24;delete t.span;let a={...t,type:l[0]};for(let o=1;o<l.length;o++)a={type:l[o],children:[a]};return a.span=i,De([a])}function De(e){const t={type:"row",props:{gutter:20,class:"render-row"},children:[]};return e.forEach(l=>{var i,a;let o=Object.assign({},l);if(W((i=o.props)==null?void 0:i.style)){let d="";Object.keys((a=o.props)==null?void 0:a.style).forEach(u=>{var h;d+=u+":"+((h=o.props)==null?void 0:h.style[u])+";"}),o.props.style=d}const s={span:o.span??24,class:"render-col"};if(delete o.span,o.type.indexOf(".")>0){t.children.push({type:"col",props:s,children:No(o)});return}o=f.merge({props:{}},Mo[o.type]||{},o);const r=kt(o.children);r.length&&(o.children=De(r)),t.children.push({type:"col",props:s,children:[o]})}),[t]}function kt(e){return Ge(e)?e:W(e)?[e]:[]}let Se={};const _t=e=>{const t=jo[e.type]||Se[e.type]||e.type;return ul(t,e.props,{default:()=>kt(e.children).map(l=>_t(l))})},qo=e=>(Object.keys(Se).length===0&&(Se=cl().appContext.components),De(Object.values(e.schema)).map(t=>_t(t))),Vo={__name:"custom",setup(e){const t=D([]),l=(i,a)=>(t.value=gl(i),i);return(i,a)=>(n(),m(ie,{"schema-handler":l},{default:p(()=>[c(x(qo),{schema:x(t)},null,8,["schema"])]),_:1}))}};let Q={};function Ds(e){Q=e}const Uo=e=>{const t=l=>{const i="./views/"+l+".vue";return Q&&Q[i]&&Q[i].default?Q[i].default:(console.error(`自定义组件不存在 ${e.name} ${e.view}`),be)};if(e.path==="#")return be;switch(e.page_type){case R.list:return gt;case R.form:return _e;case R.custom:case R.localComp:return t(e.view||"");case R.tree:return So;case R.report:return Do;case R.customSchema:return Vo}return be};function Ho(e){let t=e.path;return e.type===P.menu&&e.page_type===R.entity&&(t="#"),t.indexOf(":id")>-1&&t.indexOf(":id")+3===t.length&&(t=t.replace(":id",":id(\\d+)")),t==="#"?"/"+e.id+"_DIR_"+e.name:t[0]!=="/"?"/"+t:t}function Fo(e){return(e.path+e.name).split("/").filter(t=>t).join("_")}const St=e=>{const t=e.type!==P.page,l={path:Ho(e),name:e.id+"_"+Fo(e)+"_"+e.path.replaceAll("/","_"),component:Uo(e),meta:{id:e.id,pageId:e.id,title:e.name,icon:e.icon,hidden:!t,path:e.path,menuType:e.type,keepAlive:!1},children:e.children?e.children.map(i=>St(i)):[]};if(e.page_type===R.entity){const i=e.path+"/list",a=e.path+"/form",o=e.path+"/:id",s=[{path:i,name:e.name+"列表"+e.id,component:gt,meta:{id:e.id+99999,title:"列表",hidden:!0,menuType:P.hidden,keepAlive:!1,pageId:e.id,path:e.path}},{path:a,name:e.name+"新建"+e.id,component:_e,meta:{id:e.id+99999+1,title:"新建",hidden:!0,menuType:P.hidden,keepAlive:!1,pageId:e.id,path:e.path}},{path:o,name:e.name+"编辑"+e.id,component:_e,meta:{id:e.id+99999+2,title:"编辑",hidden:!0,menuType:P.hidden,keepAlive:!1,pageId:e.id,path:e.path}}];l.children=[...s,...l.children]}if(l.children&&l.children.length>0){let i=!0;if(l.children.forEach(a=>{a.meta&&!a.meta.hidden&&(i=!1)}),l.meta&&(l.meta.menuType=t?P.dir:P.hidden),i){l.meta&&(l.meta.menuType=P.menu);let a="/";for(let o=0;o<l.children.length;o++)if(l.children[o].path.indexOf("/:")===-1){a=l.children[o].path;break}l.redirect=a,l.path="/"+e.id+"_DIR"+l.redirect.replaceAll("/","_").toUpperCase()}}return l},Go=e=>{const t=[];return e.forEach(l=>{const i={id:l.id,label:l.label,routes:[]};l.routes.forEach(a=>{i.routes.push(St(a))}),t.push(i)}),t};function Jo(e){e.beforeEach(async(t,l,i)=>{if(bt().indexOf(t.path)!==-1){i();return}if(Zi()){i();return}await k.dispatch("user/info");const a=await k.dispatch("user/loadRemoteRoutes"),o=Go(a);o.forEach(s=>{s.routes.forEach(r=>{e.addRoute({path:"/",component:ht,children:[r]})})}),e.addRoute({name:"404",path:"/:pathMatch(.*)*",redirect:"/404",hidden:!0}),k.commit("user/updateRemoteRouter",o),await e.replace(t),i()})}function Ko(e){e.beforeEach(async(t,l,i)=>{var a;const o=[k.state.settings.title||""],s=t.matched.length;for(let r=s;r>s-3;r--){const d=t.matched[r-1];(a=d==null?void 0:d.meta)!=null&&a.title&&o.push(d.meta.title+"")}o.length>1&&(document.title=o.reverse().join("-")),i()}),e.afterEach(async(t,l,i)=>{Object.keys(t.meta).length>0&&await k.dispatch("app/setCurrentMeta",t.meta)})}function zo(e){lo(e),Xi(e),Jo(e),Ko(e)}zo(J);function Wo(){return k.state.user.token}function Xo(){return k.state.user.expired}function Ve(e){Vl({message:e,type:"error",duration:5*1e3,grouping:!0})}const Zo={onFulfilled:function(e){var t;e.headers=e.headers||{};const l=Wo();return l&&(e.headers["X-Token"]=l),(t=J.currentRoute.value.meta)!=null&&t.path&&(e.headers["X-Path"]=J.currentRoute.value.meta.path),e}},Yo={onFulfilled(e){var t,l,i,a,o,s,r;if(!(((t=e.config)==null?void 0:t.notHoldApiErr)!==void 0&&((l=e.config)==null?void 0:l.notHoldApiErr)===!0)&&e.data.code!==0){const u=e.data.message||`接口请求错误 ${e.config.method}::${(i=e.config.url)==null?void 0:i.split("?")[0]}`;if(e.data.code===401){if(Xo())return;k.dispatch("user/SetExpired"),Me.alert("登录信息已过期或未登录, 是否跳转登录","操作提醒",{showClose:!1,confirmButtonText:"重新登录",showCancelButton:!0,cancelButtonText:"取消",callback:h=>{h==="confirm"&&(pt(),location.href=location.origin+location.pathname+location.hash.replace("#","#/?redirect="),location.reload()),k.dispatch("user/SetExpired")}});return}else Ve(u);return Promise.reject(u)}let d=(o=(a=e.data)==null?void 0:a.data)==null?void 0:o._message_box;return d!==void 0&&(we(d)&&(d={message:(r=(s=e.data)==null?void 0:s.data)==null?void 0:r._message_box}),Me({title:"提示",type:"success",grouping:!0,...d})),e.data},onRejected(e){var t;return Te.isCancel(e)?Promise.reject(""):(Ve(`${e.message} ${e.config.method}::${(t=e.config.url)==null?void 0:t.split("?")[0]}`),Promise.reject(e))}},Qo=[{request:Hl,response:Fl},{request:Zo,response:Yo}];function wt(e={}){const t=$e.axios||{},l=f.merge(t,e||{}),i=Te.create({...l});return Qo.forEach(a=>{i.interceptors.request.use(a.request.onFulfilled,a.request.onRejected),i.interceptors.response.use(a.response.onFulfilled,a.response.onRejected)}),i}const xt=wt(),es={beforeMount(e,t){e.clickOutsideEvent=function(l){e===l.target||e.contains(l.target)||t.value(l,e)},document.body.addEventListener("click",e.clickOutsideEvent)},unmounted(e){document.body.removeEventListener("click",e.clickOutsideEvent)}},K=ol(),ts={mounted:(e,t)=>{e!==null&&(t.value,e.oncontextmenu=l=>{l.preventDefault(),l.stopPropagation(),l.cancelBubble=!0,t.value&&K.emit("right-click",{event:l,data:t.value})})}},ls={mounted(e){}};function Ue(e,t){let l=e[`offset${t}`],i=e.offsetParent;for(;i;)l+=i[`offset${t}`],i=i.offsetParent;return l}const as={mounted:(e,t)=>{if(e===null||!t.value.dev)return;let l=e;if(t.value.parent)for(let d=0;d<t.value.parent;d++)l.parentElement&&(l=l.parentElement);l.classList.add("devtool-hover");const i=document.createElement("i");i.className="devtool-item-wrapper",l.onmouseover=()=>{i.style.height=l.offsetHeight+30+"px",i.style.width=l.offsetWidth+30+"px",i.style.top=Ue(l,"Top")-15+"px",i.style.left=Ue(l,"Left")-15+"px"};const a=document.createElement("span");a.className="dev-action-edit",a.title="编辑";const o=document.createElement("i");o.className="iconfont ra-editor1",a.appendChild(o),a.onclick=d=>{K.emit("dev-action",{event:d,data:{type:"edit",devId:t.value.devId}})},i.appendChild(a);const s=document.createElement("span");s.className="dev-action-del",s.title="删除";const r=document.createElement("i");r.className="iconfont ra-cut",s.appendChild(r),s.onclick=d=>{K.emit("dev-action",{event:d,data:{type:"del",devId:t.value.devId}})},i.appendChild(s),l.insertBefore(i,l.firstChild)}},is=Object.freeze(Object.defineProperty({__proto__:null,devtool:as,outClick:es,resize:ls,rightClick:ts},Symbol.toStringTag,{value:"Module"}));let ye;function Rs(e){const t=f.merge($e,e),l=hl(_l),i=cs(t),a=t.plugins||[];a.unshift(i),a.forEach(o=>{ds(l,o)}),t!=null&&t.mock&&$l(),ye=wt(t.axios),k.dispatch("setHttp",ye).then(),k.dispatch("settings/updateSettings",e==null?void 0:e.settings).then(),k.dispatch("app/setBaseAPI",t==null?void 0:t.axios.baseURL).then(),l.config.globalProperties.$http=ye,l.config.globalProperties.$router=J,window.App=l,window.OmsOptions=t,al(()=>({"X-Token":Pe()})),J.isReady().then(()=>l.mount("#app"))}function os(e,t={}){Object.keys(t).forEach(l=>{e.component(l,t[l])})}function ss(e=[]){e.forEach(t=>{J.addRoute(t)}),k.commit("user/setCustomRoutes",e)}function ns(e,t){t.forEach(l=>{W(l)&&(l=[l]),e.use(...l)})}function rs(e,t={}){Object.keys(t).forEach(l=>{e.directive(l,t[l])})}function ps(e={}){const t=["app","settings","user"];Object.keys(e).forEach(l=>{if(t.indexOf(l)!==-1){console.warn(`storeModule name [${l}] is use by base, please change it!`);return}k.registerModule(l,e[l])})}function ds(e,t){os(e,t.components||{}),ss(t.routes||[]),ns(e,t.use||[]),rs(e,t.directives||{}),ps(t.storeModules||{}),nt(t.mockApis||[])}function cs(e){var t;return{components:{VIcon:ll},directives:is,use:[k,J,[Lt,{locale:Je,...(t=e.settings)==null?void 0:t.ElementPlus}]]}}export{Rs as B,Ds as C,Ls as E,ht as v};
